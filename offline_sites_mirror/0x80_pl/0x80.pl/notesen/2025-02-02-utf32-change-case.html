<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<!-- Mirrored from 0x80.pl/notesen/2025-02-02-utf32-change-case.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 16 Feb 2025 16:43:15 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.21.2: https://docutils.sourceforge.io/" />
<meta name="author" content="Wojciech Muła" />
<title>Change case of UTF-32-encoded strings</title>
<link rel="stylesheet" href="style.css" type="text/css" />
</head>
<body><script src="../switch_theme.js" type="text/javascript"></script>
<div class="document" id="change-case-of-utf-32-encoded-strings">
<h1 class="title">Change case of UTF-32-encoded strings</h1>
<table class="docinfo" frame="void" rules="none">
<col class="docinfo-name" />
<col class="docinfo-content" />
<tbody valign="top">
<tr><th class="docinfo-name">Author:</th>
<td>Wojciech Muła</td></tr>
<tr class="added-on field"><th class="docinfo-name">Added on:</th><td class="field-body">2025-02-02</td>
</tr>
</tbody>
</table>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="toc-entry-1">Introduction</a></li>
<li><a class="reference internal" href="#solutions-overview" id="toc-entry-2">Solutions overview</a><ul>
<li><a class="reference internal" href="#rely-on-a-compiler" id="toc-entry-3">Rely on a compiler</a></li>
<li><a class="reference internal" href="#perfect-hashing-function" id="toc-entry-4">Perfect hashing function</a></li>
<li><a class="reference internal" href="#use-lookup-tables" id="toc-entry-5">Use lookup tables</a></li>
</ul>
</li>
<li><a class="reference internal" href="#multi-character-conversions-results" id="toc-entry-6">Multi-character conversions results</a></li>
<li><a class="reference internal" href="#vectorization" id="toc-entry-7">Vectorization</a><ul>
<li><a class="reference internal" href="#possible-improvement" id="toc-entry-8">Possible improvement?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementations" id="toc-entry-9">Implementations</a><ul>
<li><a class="reference internal" href="#solution-1-huge-lookup-tables" id="toc-entry-10">Solution 1 &mdash; huge lookup tables</a></li>
<li><a class="reference internal" href="#solution-2-compressed-lookup-table-variant-1" id="toc-entry-11">Solution 2 &mdash; compressed lookup table (variant #1)</a></li>
<li><a class="reference internal" href="#solution-3-compressed-lookup-tables-variant-2" id="toc-entry-12">Solution 3 &mdash; compressed lookup tables (variant #2)</a></li>
<li><a class="reference internal" href="#solution-4-compressed-lookup-tables-with-diffs-variant-3" id="toc-entry-13">Solution 4 &mdash; compressed lookup tables with diffs (variant #3)</a></li>
<li><a class="reference internal" href="#vectorization-of-variant-3" id="toc-entry-14">Vectorization of variant #3</a></li>
</ul>
</li>
<li><a class="reference internal" href="#experiments" id="toc-entry-15">Experiments</a><ul>
<li><a class="reference internal" href="#ryzen-7" id="toc-entry-16">Ryzen 7</a></li>
<li><a class="reference internal" href="#ice-lake" id="toc-entry-17">Ice Lake</a></li>
</ul>
</li>
<li><a class="reference internal" href="#conclusions" id="toc-entry-18">Conclusions</a></li>
<li><a class="reference internal" href="#source-code" id="toc-entry-19">Source code</a></li>
<li><a class="reference internal" href="#appendixes" id="toc-entry-20">Appendixes</a><ul>
<li><a class="reference internal" href="#a-codepoints-of-letters-having-different-cases" id="toc-entry-21">A &mdash; Codepoints of letters having different cases</a></li>
<li><a class="reference internal" href="#b-lowercase-letters-placement" id="toc-entry-22">B &mdash; Lowercase letters placement</a></li>
<li><a class="reference internal" href="#c-uppercase-letters-placement" id="toc-entry-23">C &mdash; Uppercase letters placement</a></li>
<li><a class="reference internal" href="#d-compressed-tables-variant-1" id="toc-entry-24">D &mdash; Compressed tables &mdash; variant 1</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h1>Introduction</h1>
<p>Changing letters case is something that appear handy in many situations, for
instance input normalization, parsing, and other text-related tasks.</p>
<p>When we are dealing with ASCII, such conversion is straightforward. We check
if a character code lies in the range 'a' .. 'z' (or 'A' .. 'Z') and when its
true, we toggle the 5th bit (0x20).</p>
<p>But in the case of <a class="reference external" href="https://home.unicode.org/">Unicode-encoded</a> strings it is not that simple. There are
many code points having upper- or lowercase counterparts, and they are not
placed in any regular way in the Unicode code space. Although we may identify
shorter or longer ranges of such codes, similarly to Latin letters in ASCII,
this does not help much. See <a class="reference internal" href="#appendix-a">appendixes A</a>, <a class="reference internal" href="#appendix-b">B</a> and <a class="reference internal" href="#appendix-c">C</a>, where we visualize
how these characters are located.</p>
<p>Additionally, there are cases where an uppercase or lowercase version of the given
character is not a single character, but a string. These strings are short, have
two or three Unicode points. For example the uppercase of &quot;Latin small ligature ffi&quot;
(ﬃ) is a three-character string &quot;FFI&quot;.</p>
<table border="1" class="col2right col3right col4right col5right docutils">
<caption>How many characters are subject of case change (Unicode 15.0.0)</caption>
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">&nbsp;</th>
<th class="head">1 code point</th>
<th class="head">2 code points</th>
<th class="head">3 code points</th>
<th class="head">total</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>uppercase</td>
<td>1423</td>
<td>86</td>
<td>16</td>
<td>1525</td>
</tr>
<tr><td>lowercase</td>
<td>1432</td>
<td>1</td>
<td>0</td>
<td>1433</td>
</tr>
</tbody>
</table>
<table border="1" class="col2right col3right col4right col5right docutils">
<caption>How many characters are subject of case change (Unicode 13.0.0)</caption>
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">&nbsp;</th>
<th class="head">1 code point</th>
<th class="head">2 code points</th>
<th class="head">3 code points</th>
<th class="head">total</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>uppercase</td>
<td>1383</td>
<td>86</td>
<td>16</td>
<td>1485</td>
</tr>
<tr><td>lowercase</td>
<td>1392</td>
<td>1</td>
<td>0</td>
<td>1393</td>
</tr>
</tbody>
</table>
<p>There is one thing that makes our task easier: while the Unicode codes span the range
<tt class="docutils literal"><span class="pre">0..0x10ffff</span></tt>, we can check that only characters up to <tt class="docutils literal">0x1ffff</tt> <strong>may</strong> have
different codes due to case change.</p>
<p>The outline of case change algorithm for UTF-32 encoded strings can be written as
follows.</p>
<pre class="code cpp literal-block">
<span class="kt">void</span><span class="w"> </span><span class="nf">utf32_uppercase</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="o">*</span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="o">*</span><span class="n">output</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="c1">// fetch the character code
</span><span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">src_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w">

        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">has_uppercase_variant</span><span class="p">(</span><span class="n">src_code</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">uppercase_letters_count</span><span class="p">(</span><span class="n">src_code</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="c1">// the majority: single character
</span><span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="w">
                    </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uppercase</span><span class="p">(</span><span class="n">src_code</span><span class="p">);</span><span class="w">
                    </span><span class="k">break</span><span class="p">;</span><span class="w">

                </span><span class="c1">// rare cases: strings
</span><span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span><span class="w">
                    </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uppercase</span><span class="p">(</span><span class="n">src_code</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span><span class="w">
                    </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uppercase</span><span class="p">(</span><span class="n">src_code</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span><span class="w">
                    </span><span class="k">break</span><span class="p">;</span><span class="w">

                </span><span class="k">case</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span><span class="w">
                    </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uppercase</span><span class="p">(</span><span class="n">src_code</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span><span class="w">
                    </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uppercase</span><span class="p">(</span><span class="n">src_code</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span><span class="w">
                    </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uppercase</span><span class="p">(</span><span class="n">src_code</span><span class="p">)[</span><span class="mi">2</span><span class="p">];</span><span class="w">
                    </span><span class="k">break</span><span class="p">;</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="c1">// no upper
</span><span class="w">            </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">src_code</span><span class="p">;</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span>
</pre>
</div>
<div class="section" id="solutions-overview">
<h1>Solutions overview</h1>
<p>There are different ways to implement this algorithm, we list a selection of them.</p>
<div class="section" id="rely-on-a-compiler">
<span id="switch"></span><h2>Rely on a compiler</h2>
<p>We may auto-generate a huge switch statement and let the compiler do all the
hard job. It's not naive approach, as compilers are getting better and
better. Refer to a great presentation <a class="reference external" href="https://www.youtube.com/watch?v=nfy51jenN3M">Hans Wennborg: C++ switch statements
under the hood in LLVM</a>.</p>
</div>
<div class="section" id="perfect-hashing-function">
<h2>Perfect hashing function</h2>
<p>Perfect hashing functions are really great (see <a class="reference external" href="2023-04-30-lookup-in-strings.html">Modern perfect hashing for strings</a>),
although they do not fit well to this particular problem. Lookup in
a hash table requires two steps:</p>
<ul class="simple">
<li>Calculate the value of our perfect hash function &mdash; this yields the
index to the hash table,</li>
<li>Fetch the entry from the table &mdash; the entry contains the
key (a character code) and a value (an upper- or lowercase code).
We need to check if the input value equals to the key and only
then there's a hit.</li>
</ul>
<pre class="code cpp literal-block">
<span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">src_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w">

</span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">perfect_hash_function</span><span class="p">(</span><span class="n">src_code</span><span class="p">);</span><span class="w">
</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">hash_table</span><span class="p">[</span><span class="n">h</span><span class="p">].</span><span class="n">src_code</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">src_code</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hash_table</span><span class="p">[</span><span class="n">h</span><span class="p">].</span><span class="n">dst_code</span><span class="p">;</span><span class="w">
</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">src_code</span><span class="p">;</span><span class="w"> </span><span class="c1">// no changes to the character
</span><span class="p">}</span>
</pre>
<p>The first problem is finding a <strong>cheap</strong> perfect hash function, as we have
to evaluate it for every character. We tried to find something like
<tt class="docutils literal">((character code * M) &gt;&gt; N) &amp; mask</tt>, where <tt class="docutils literal">M</tt>, <tt class="docutils literal">N</tt> and <tt class="docutils literal">mask</tt>
are compile time constants. The best hash function returned value
~8100. This means hash table size would be approx 126kB, while we can
reduce auxiliary table sizes to ~26kB using simpler techniques.</p>
<p>The second problem is related to vectorization &mdash; fetching table
entries require using <a class="reference external" href="https://hjlebbink.github.io/x86doc/html/VPGATHERDD_VPGATHERQD.html">VPGATHERDD</a>. Our input are vectors of 4-byte
character codes, but the size of hash table entry is 8 bytes. Thus we would
need to issue gather instruction twice: either to fetch separately two
halves of entries, or fetch 8-byte entries for characters at odd/even
indices of the input.</p>
</div>
<div class="section" id="use-lookup-tables">
<h2>Use lookup tables</h2>
<p>Lookup tables addressed directly by the character code seems to be the
best option.</p>
<ol class="arabic">
<li><p class="first">An obvious solution is to have tables of size 0x1ffff, that is 131'072
entries. Than the lookup costs us only check the range and a single
memory fetch.</p>
<pre class="code cpp literal-block">
<span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">src_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w">
</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">src_code</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mh">0x1'ffff</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lookup</span><span class="p">[</span><span class="n">src_code</span><span class="p">];</span><span class="w">
</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">src_code</span><span class="p">;</span><span class="w">
</span><span class="p">}</span>
</pre>
<p>The drawback is size of a single table: 131'072 * 4 bytes = 524'288 bytes.
512kB exceeds usual sizes of L1 cache and cache misses may kill performance.
Of course, we can come up with scenarios where this is not a problem.
For example, if we're dealing with texts written in one language, we
effectively will use only a small portion of the tables. But when we
cannot assume anything about the text source, having 1MB of auxiliary
tables does not seem to be a right solution. Also, when case changing
is only a part of bigger system, huge lookup tables might be a problem.</p>
</li>
<li><p class="first">It is possible to <strong>compress</strong> lookup tables. We know that only a small
fraction of codes are being altered during case changing, thus we can rule
out a huge number of character codes. We split a character code into higher
and lower parts. The higher order bits are used to distinguish between
ranges of codes having none or some characters to change. If the characters
from the given range are not changed, we simply do not save that range.</p>
<p>The lower part of character code is used as a local offset within the
selected range.</p>
<p>A simplified algorithm is shown below.</p>
<pre class="code cpp literal-block">
<span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">src_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w">
</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">src_code</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mh">0x1'ffff</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">some_predefined_const</span><span class="p">;</span><span class="w">
    </span><span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">hi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">src_code</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w">
    </span><span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">lo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">src_code</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">((</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w">

    </span><span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">group_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">first_level_lookup</span><span class="p">[</span><span class="n">hi</span><span class="p">];</span><span class="w">
    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">group_id</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="c1">// `group_id + lo` may be a bit different expression, but generally
</span><span class="w">        </span><span class="c1">// we combine somehow the lower bits with the `group_id`.
</span><span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">dst_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">second_level_lookup</span><span class="p">[</span><span class="n">group_id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">lo</span><span class="p">];</span><span class="w">
        </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dst_code</span><span class="p">;</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">src_code</span><span class="p">;</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">src_code</span><span class="p">;</span><span class="w">
</span><span class="p">}</span>
</pre>
<p>This solution also requires two lookups, so we are having exactly the same
problem as in the case of perfect hashing function &mdash; two gathers. Not ideally,
but compression allows us to shave significant portions of lookup tables
when compared to the naive solution.</p>
</li>
<li><p class="first">We said that a lookup table (single or compressed) is addressed by character
codes, but what is stored in the table?</p>
<p>We may store there UTF-32 uppercase or lowercase codes directly. However, we
may also store there already encoded UTF-8 characters, when the UTF-8
is desired encoding.</p>
<p>Another option is storing <strong>symmetrical differences</strong> (xor) between the
source and destination codes. For uppercase we have 139 distinct differences,
for lowercase 124. That is significantly fewer than the actual number
of codes (1525 and 1433, respectively).</p>
<p>The conversion that uses differences requires just additional xor operation.
And  as we learn later on, this allows some nice tricks, including replacing
one of memory gathers with an in-register shuffle (yes, <a class="reference external" href="https://hjlebbink.github.io/x86doc/html/PSHUFB.html">PSHUFB</a>!).</p>
<pre class="code cpp literal-block">
<span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">src_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w">
</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">src_code</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mh">0x1'ffff</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">src_code</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="n">lookup</span><span class="p">[</span><span class="n">src_code</span><span class="p">];</span><span class="w">
</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">src_code</span><span class="p">;</span><span class="w">
</span><span class="p">}</span>
</pre>
</li>
</ol>
</div>
</div>
<div class="section" id="multi-character-conversions-results">
<span id="multichar"></span><h1>Multi-character conversions results</h1>
<p>We completely skip the problem of multi-character conversion results, assuming
that tables would store either 4-byte values (for plain and compressed lookup tables)
or 8-byte entries (for hash tables).</p>
<p>Since these multi-character strings appear relative rare, we propose to handle
them separately. For these cases we store code <tt class="docutils literal">0x8000_0000</tt> &mdash; that is: a
<strong>negative value</strong>, easy to detect. If a negative number is the result of
conversion, we are switching to the slowest path.</p>
<p>The slowest path may be done in different ways. When the lookup step yields a character
code (not differences) then we may encode in the negative number more information.
We need a separate auxiliary table that keep all resulting strings; just for remind,
strings have two or three characters. Our negative number keeps also the length
and the exact offset to the auxiliary table, as follows:</p>
<ul class="simple">
<li><tt class="docutils literal">0x8000_0000</tt> + offset for 2-byte strings,</li>
<li><tt class="docutils literal">0xc000_0000</tt> + offset for 3-byte strings.</li>
</ul>
<p>The expression <tt class="docutils literal">code &gt;&gt; 30</tt> yields the length, and <tt class="docutils literal">code &amp; 0xff</tt> the offset.
A single byte for offset is enough, as the total length of the auxiliary table
is <span class="math">86 &sdot; 2 + 16 &sdot; 3 = 220</span>.</p>
<p>A scalar conversion can be written as:</p>
<pre class="code cpp literal-block">
<span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">src_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w">
</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">src_code</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mh">0x1'ffff</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">dst_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lookup</span><span class="p">[</span><span class="n">src_code</span><span class="p">];</span><span class="w">
    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kt">int32_t</span><span class="p">(</span><span class="n">dst_code</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dst_code</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">30</span><span class="p">;</span><span class="w">
        </span><span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">ofs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dst_code</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x1ff</span><span class="p">;</span><span class="w">

        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">len</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="k">case</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span><span class="w">
                </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replacements</span><span class="p">[</span><span class="n">ofs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">0</span><span class="p">];</span><span class="w">
                </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replacements</span><span class="p">[</span><span class="n">ofs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span><span class="w">
                </span><span class="k">break</span><span class="p">;</span><span class="w">
            </span><span class="k">case</span><span class="w"> </span><span class="mi">3</span><span class="p">:</span><span class="w">
                </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replacements</span><span class="p">[</span><span class="n">ofs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">0</span><span class="p">];</span><span class="w">
                </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replacements</span><span class="p">[</span><span class="n">ofs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span><span class="w">
                </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replacements</span><span class="p">[</span><span class="n">ofs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">];</span><span class="w">
                </span><span class="k">break</span><span class="p">;</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">src_code</span><span class="p">;</span><span class="w">
</span><span class="p">}</span>
</pre>
</div>
<div class="section" id="vectorization">
<h1>Vectorization</h1>
<p>If we go for lookup tables or perfectly-hashed tables, we need to use the
gather instruction. This instruction is available only in AVX and AVX-512
extensions of the Intel ISAs.</p>
<ul class="simple">
<li>The AVX2 version of gather fetches data for all vector elements.</li>
<li>The AVX-512 version of gather uses mask, and it does not issue memory
fetches for inactive elements, so presumably might be faster in certain
scenarios.</li>
</ul>
<p>A common optimization, which is present almost everywhere in vectorized code
of <a class="reference external" href="https://github.com/simdutf/simdutf">simdutf project</a>, is checking whether a SIMD register contains only ASCII
characters.  This check is inexpensive, we need to test if all character codes are
less than 128. When it is true, we choose a fast path &mdash; the fast path for
changing case requires only two comparisons and conditional xor.</p>
<p>However, when at least one character is outside the ASCII range, we are forced
to use a slower path.</p>
<div class="section" id="possible-improvement">
<h2>Possible improvement?</h2>
<p>When we hit the slow path, we might want to check whether <strong>any of the
characters</strong> from SIMD registers would change. When nothing would change,
we simply could copy the register contents to the output.</p>
<p>As the pictures in <a class="reference internal" href="#appendix-b">Appendix B</a> and <a class="reference internal" href="#appendix-c">C</a> suggest, there are many ranges of
characters that are not altered during case changing. We may use <strong>higher order
bits</strong> of code points to identify these ranges and avoid the slow path.
Unfortunately, it doesn't work well in real world scenarios.</p>
<p>We used exactly the same datasets as the simdutf project: the Wikipedia article
about <a class="reference external" href="http://en.wikipedia.org/wiki/Mars_(planet)">the Mars</a> in various languages.  The languages are:
Arabic, Chinese, Czech, English, Esperanto, French, German, Greek, Hebrew,
Hindi, Japanese, Korean, Persian, Portuguese, Russian, Thai, Turkish and
Vietnamese.</p>
<p>In our evaluation we process 8-character blocks of the input (eight UTF-32
characters fit in an AVX2 register). A block is first checked for ASCII
characters. If there are some non-ASCII characters, we perform either
uppercase of lowercase transformation on the block.</p>
<p>The following table summarizes the experiment. The column &quot;ASCII&quot; says what
fraction of the input blocks went through the fast path. The last two columns:
&quot;changed case&quot; and &quot;not changed&quot; show the slow path outcome &mdash; the fraction of
blocks that were changed or not.  As we can observe, in the case of European
languages the majority of blocks is getting changed, while in Asian languages
almost nothing got modified.</p>
<p>This results make the discussed optimization pointless.</p>
<table border="1" class="col1center col2right col3right col4right col5right col6right docutils">
<colgroup>
<col width="18%" />
<col width="18%" />
<col width="12%" />
<col width="11%" />
<col width="21%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">dataset</th>
<th class="head">block size</th>
<th class="head">blocks</th>
<th class="head">ASCII</th>
<th class="head">changed case</th>
<th class="head">not changed</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>arabic</td>
<td>8</td>
<td>28774</td>
<td>50.5%</td>
<td>3.1%</td>
<td>96.9%</td>
</tr>
<tr><td>chinese</td>
<td>8</td>
<td>9101</td>
<td>58.1%</td>
<td>11.2%</td>
<td>88.8%</td>
</tr>
<tr><td>czech</td>
<td>8</td>
<td>11363</td>
<td>63.3%</td>
<td>96.4%</td>
<td>3.6%</td>
</tr>
<tr><td>english</td>
<td>8</td>
<td>22422</td>
<td>98.0%</td>
<td>63.0%</td>
<td>37.0%</td>
</tr>
<tr><td>esperanto</td>
<td>8</td>
<td>7180</td>
<td>89.7%</td>
<td>92.0%</td>
<td>8.0%</td>
</tr>
<tr><td>french</td>
<td>8</td>
<td>32883</td>
<td>79.4%</td>
<td>92.7%</td>
<td>7.3%</td>
</tr>
<tr><td>german</td>
<td>8</td>
<td>16907</td>
<td>88.7%</td>
<td>86.7%</td>
<td>13.3%</td>
</tr>
<tr><td>greek</td>
<td>8</td>
<td>9364</td>
<td>40.6%</td>
<td>98.1%</td>
<td>1.9%</td>
</tr>
<tr><td>hebrew</td>
<td>8</td>
<td>8747</td>
<td>29.0%</td>
<td>5.1%</td>
<td>94.9%</td>
</tr>
<tr><td>hindi</td>
<td>8</td>
<td>13881</td>
<td>39.0%</td>
<td>6.0%</td>
<td>94.0%</td>
</tr>
<tr><td>japanese</td>
<td>8</td>
<td>6257</td>
<td>52.3%</td>
<td>11.9%</td>
<td>88.1%</td>
</tr>
<tr><td>korean</td>
<td>8</td>
<td>5032</td>
<td>57.6%</td>
<td>13.6%</td>
<td>86.4%</td>
</tr>
<tr><td>persan</td>
<td>8</td>
<td>7397</td>
<td>50.4%</td>
<td>7.8%</td>
<td>92.2%</td>
</tr>
<tr><td>portuguese</td>
<td>8</td>
<td>19966</td>
<td>82.9%</td>
<td>91.7%</td>
<td>8.3%</td>
</tr>
<tr><td>russian</td>
<td>8</td>
<td>24145</td>
<td>30.2%</td>
<td>95.0%</td>
<td>5.0%</td>
</tr>
<tr><td>thai</td>
<td>8</td>
<td>20747</td>
<td>44.0%</td>
<td>5.9%</td>
<td>94.1%</td>
</tr>
<tr><td>turkish</td>
<td>8</td>
<td>14747</td>
<td>66.9%</td>
<td>98.4%</td>
<td>1.6%</td>
</tr>
<tr><td>vietnamese</td>
<td>8</td>
<td>20975</td>
<td>44.6%</td>
<td>98.3%</td>
<td>1.7%</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="implementations">
<h1>Implementations</h1>
<div class="section" id="solution-1-huge-lookup-tables">
<span id="plain-lookup"></span><h2>Solution 1 &mdash; huge lookup tables</h2>
<p>This is the first approach &mdash; use single, 512kB tables. To handle multi-character
strings we used auxiliary lookup table, as discussed in <a class="reference internal" href="#multichar">the previous section</a>.</p>
<p>The scalar code performing lookup is shown below. The <tt class="docutils literal">input</tt> is UTF-32-encoded
string, <tt class="docutils literal">n</tt> is its length. The <tt class="docutils literal">output</tt> should be <em>big enough</em> (<tt class="docutils literal">n*3</tt> is
the safest &amp; simplest to obtain size).</p>
<pre class="code cpp literal-block">
<span class="kt">size_t</span><span class="w"> </span><span class="nf">utf32_uppercase_plain</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="o">*</span><span class="w"> </span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="o">*</span><span class="w"> </span><span class="n">output</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w">
    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w">
        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">src</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mh">0x1'ffff</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">dst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UTF32_UPPERCASE_PLAIN</span><span class="p">[</span><span class="n">src</span><span class="p">];</span><span class="w">
            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="kt">int32_t</span><span class="p">(</span><span class="n">dst</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">ofs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dst</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x1ff</span><span class="p">;</span><span class="w">
                </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">dst</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="k">case</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span><span class="w">
                        </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UTF32_UPPERCASE_PLAIN_LONG_REPL</span><span class="p">[</span><span class="n">ofs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">0</span><span class="p">];</span><span class="w">
                        </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UTF32_UPPERCASE_PLAIN_LONG_REPL</span><span class="p">[</span><span class="n">ofs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span><span class="w">
                        </span><span class="k">break</span><span class="p">;</span><span class="w">
                    </span><span class="k">case</span><span class="w"> </span><span class="mi">3</span><span class="p">:</span><span class="w">
                        </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UTF32_UPPERCASE_PLAIN_LONG_REPL</span><span class="p">[</span><span class="n">ofs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">0</span><span class="p">];</span><span class="w">
                        </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UTF32_UPPERCASE_PLAIN_LONG_REPL</span><span class="p">[</span><span class="n">ofs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span><span class="w">
                        </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UTF32_UPPERCASE_PLAIN_LONG_REPL</span><span class="p">[</span><span class="n">ofs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">];</span><span class="w">
                        </span><span class="k">break</span><span class="p">;</span><span class="w">
                    </span><span class="k">default</span><span class="o">:</span><span class="w">
                        </span><span class="n">assert</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dst</span><span class="p">;</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">src</span><span class="p">;</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">

    </span><span class="k">return</span><span class="w"> </span><span class="n">j</span><span class="p">;</span><span class="w">
</span><span class="p">}</span>
</pre>
<p>The code is rather straightforward, the only unusual thing is marking branches
with <tt class="docutils literal">likely</tt>/<tt class="docutils literal">unlikely</tt> (wrappers for <a class="reference external" href="https://gcc.gnu.org/onlinedocs/gcc/Other-Builtins.html#index-_005f_005fbuiltin_005fexpect">__builtin_expect</a>). This moved the
handling of multi-character replacements out of the main loop.</p>
<p>In the case of lowercase operation, there is only one multi-character replacement,
it can be handled directly. But it might not be a good solution, and better use
table-based one. In the introduction we showed that the characters having different
cases are added to the Unicode standard.</p>
<pre class="code cpp literal-block">
<span class="kt">size_t</span><span class="w"> </span><span class="nf">utf32_lowercase_plain</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="o">*</span><span class="w"> </span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="o">*</span><span class="w"> </span><span class="n">output</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w">
    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w">
        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">src</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mh">0x1'ffff</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">dst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UTF32_LOWERCASE_PLAIN</span><span class="p">[</span><span class="n">src</span><span class="p">];</span><span class="w">
            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="kt">int32_t</span><span class="p">(</span><span class="n">dst</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="c1">// there's exactly one replacement pair for lowercase
</span><span class="w">                </span><span class="c1">// 'İ' =&gt; 'i̇' (2)
</span><span class="w">                </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0069</span><span class="p">;</span><span class="w">
                </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0307</span><span class="p">;</span><span class="w">
            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dst</span><span class="p">;</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">src</span><span class="p">;</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">

    </span><span class="k">return</span><span class="w"> </span><span class="n">j</span><span class="p">;</span><span class="w">
</span><span class="p">}</span>
</pre>
</div>
<div class="section" id="solution-2-compressed-lookup-table-variant-1">
<span id="compressed-sneller"></span><h2>Solution 2 &mdash; compressed lookup table (variant #1)</h2>
<p>This section describes the solution we used at <a class="reference external" href="https://github.com/SnellerInc/sneller">Sneller</a>. We purposely omitted
the mutli-character replacements as too complex for our needs at the moment
of creating the product.</p>
<p>The values in range <tt class="docutils literal">0</tt> .. <tt class="docutils literal">0x1_ffff</tt> can be saved on 17 bits. We split
the 17-bit character code into two parts: higher 9-bit (<em>row</em>), and lower 8-bit
(<em>column</em>). For each of 512 possible higher order bit combinations, we collect
all 256 lower- or uppercase character codes; we are collecting codes for range
<tt class="docutils literal">0x000_00</tt> .. <tt class="docutils literal">0x000_ff</tt>, then <tt class="docutils literal">0x001_00</tt> .. <tt class="docutils literal">0x001_ff</tt>, up to the range
<tt class="docutils literal">0x1ff_00</tt> .. <tt class="docutils literal">0x1ff_ff</tt>.</p>
<p>Then, for each group of 256 character codes (<em>rows</em>), we find the first and the
last <em>column</em> where character codes got changed. We save only this range of
characters, alongside the first and last index.  Note that not all characters
within a range are subject of case change &mdash; this is an additional storage
cost we pay for simplicity.</p>
<p>Thus, the first level lookup contains 512 records with:</p>
<ul class="simple">
<li>offset to the second-level lookup table,</li>
<li>8 bits for first index,</li>
<li>8 bits for last index,</li>
</ul>
<p>These three fields fit in a single 4-byte word. For unused entries we set
an invalid range, having <span class="math"><i>last</i> &lt <i>first</i></span>; this saves us one extra
check for invalid entries. For detailed info about the first level lookup,
see <a class="reference internal" href="#appendix-d">appendix D</a>.</p>
<p>The second level lookup contains arrays of 4-byte elements. At Sneller we
stored UTF-8 encoded strings, as internally we used that encoding. In the
experiments for this article, we store UTF-32 characters.</p>
<div class="asciidiag"><pre class="asciidiag">
 character &apos;ą&apos;
┌─────────────┐
│    <span style="color: brown">001</span><span style="color: blue">05</span>    │ <span style="color: blue">╶───────────────────────────┐</span>
└─────────────┘                             <span style="color: blue">│</span>
      <span style="color: brown">|</span>                                     <span style="color: blue">│</span>
      <span style="color: brown">│</span>     <span style="font-style: italic">1st level lookup</span>                <span style="color: blue">│</span>           <span style="font-style: italic">2nd level lookup</span>
      <span style="color: brown">│</span>  ┌─────┬─────┬────────┐             <span style="color: blue">│</span>           ┌──────────────┐
      <span style="color: brown">│</span>  │ min │ max │ offset │             <span style="color: blue">│</span>           ┆              ┆
      <span style="color: brown">│</span>  ├─────┼─────┼────────┤             <span style="color: blue">│</span>           ┆              ┆
      <span style="color: brown">│</span>  │  61 │  ff │     0  │             <span style="color: blue">│</span> <span style="color: blue">+5</span>        ┆              ┆
      <span style="color: brown">│</span>  ├─────┼─────┼────────┤             <span style="color: blue">▼</span>           ├──────────────┤
      <span style="color: brown">└─▶</span>│  <span style="color: darkgreen; font-weight: bold">01</span> │  <span style="color: darkgreen; font-weight: bold">ff</span> │   159  │ ╶──╴159╶───▶◯╶──╴163╶──▶│  00104 = &apos;Ą&apos; │ #<span style="font-style: italic">163</span>
         ├─────┴─────┴────────┤             <span style="color: brown">▲</span>           ├──────────────┤
         ┆  <span style="color: brown">│</span>                 ┆             <span style="color: brown">│</span> <span style="color: brown">-1</span>        ┆              ┆
         ┆  <span style="color: brown">└───────────────╴</span> ┆ <span style="color: brown">╶───────────┘</span>           ┆              ┆
         ┆    <span style="color: darkgreen; font-weight: bold">01</span> &lt;= <span style="color: blue">05</span> &lt;= <span style="color: darkgreen; font-weight: bold">ff</span>  ┆                         ┆              ┆
         ┆                    ┆                         ┆              ┆
         └────────────────────┘                         ┆              ┆
                                                        └──────────────┘</pre></div><table border="1" class="col2right col3right col4right docutils">
<caption>Auxiliary table sizes</caption>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">table</th>
<th class="head">entry size [bytes]</th>
<th class="head"># entries</th>
<th class="head">total [bytes]</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>first level table for uppercase</td>
<td>4</td>
<td>2875</td>
<td>11500</td>
</tr>
<tr><td>second level table for uppercase</td>
<td>4</td>
<td>490</td>
<td>1960</td>
</tr>
<tr><td>first level table for lowercase</td>
<td>4</td>
<td>2749</td>
<td>10996</td>
</tr>
<tr><td>second level table for lowercase</td>
<td>4</td>
<td>490</td>
<td>1960</td>
</tr>
<tr><td>auxiliary table for multi-character replacements (uppercase only)</td>
<td>4</td>
<td>220</td>
<td>880</td>
</tr>
<tr><td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>total 27296 (~27kB)</td>
</tr>
</tbody>
</table>
<p>Below is shown the implementation.</p>
<pre class="code cpp literal-block">
<span class="kt">size_t</span><span class="w"> </span><span class="nf">utf32_uppercase_compressed_v2</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="o">*</span><span class="w"> </span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="o">*</span><span class="w"> </span><span class="n">output</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w">
    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w">
        </span><span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">src</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span><span class="w"> </span><span class="c1">// use higher 9 bits
</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">key</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">UTF32_UPPERCASE_V2_MAX_HI_BITS</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">src</span><span class="p">;</span><span class="w">
            </span><span class="k">continue</span><span class="p">;</span><span class="w">
        </span><span class="p">}</span><span class="w">

        </span><span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">entry</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">UTF32_UPPERCASE_V2_OFFSET</span><span class="p">[</span><span class="n">key</span><span class="p">];</span><span class="w">
        </span><span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">min</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">entry</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xff</span><span class="p">;</span><span class="w">
        </span><span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">max</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">entry</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xff</span><span class="p">;</span><span class="w">
        </span><span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entry</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">16</span><span class="p">;</span><span class="w">

        </span><span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">lo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">src</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xff</span><span class="p">;</span><span class="w">
        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lo</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">min</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">lo</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">max</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">dst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UTF32_UPPERCASE_V2_DATA</span><span class="p">[</span><span class="n">offset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">lo</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">min</span><span class="p">];</span><span class="w">
            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="kt">int32_t</span><span class="p">(</span><span class="n">dst</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dst</span><span class="p">;</span><span class="w">
            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">ofs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dst</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x1ff</span><span class="p">;</span><span class="w">
                </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">dst</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="k">case</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span><span class="w">
                        </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UTF32_UPPERCASE_PLAIN_LONG_REPL</span><span class="p">[</span><span class="n">ofs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">0</span><span class="p">];</span><span class="w">
                        </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UTF32_UPPERCASE_PLAIN_LONG_REPL</span><span class="p">[</span><span class="n">ofs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span><span class="w">
                        </span><span class="k">break</span><span class="p">;</span><span class="w">
                    </span><span class="k">case</span><span class="w"> </span><span class="mi">3</span><span class="p">:</span><span class="w">
                        </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UTF32_UPPERCASE_PLAIN_LONG_REPL</span><span class="p">[</span><span class="n">ofs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">0</span><span class="p">];</span><span class="w">
                        </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UTF32_UPPERCASE_PLAIN_LONG_REPL</span><span class="p">[</span><span class="n">ofs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span><span class="w">
                        </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UTF32_UPPERCASE_PLAIN_LONG_REPL</span><span class="p">[</span><span class="n">ofs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">];</span><span class="w">
                        </span><span class="k">break</span><span class="p">;</span><span class="w">
                    </span><span class="k">default</span><span class="o">:</span><span class="w">
                        </span><span class="n">assert</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span><span class="w">
                    </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">src</span><span class="p">;</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">

    </span><span class="k">return</span><span class="w"> </span><span class="n">j</span><span class="p">;</span><span class="w">
</span><span class="p">}</span>
</pre>
</div>
<div class="section" id="solution-3-compressed-lookup-tables-variant-2">
<h2>Solution 3 &mdash; compressed lookup tables (variant #2)</h2>
<p>A simplification to the above method is storing the whole row, without dealing with
the first &amp; last index and logic required to handle them: a condition and more complex
offset calculation.</p>
<p>The following table shows the analysis of lookup table size depending on high/low bits
split. We will get the smallest tables for 11 higher/6 lower bits, or 10 higher/7
lower bits. They are approx ~50kB, which is ~2 times more than in the compressed
table.</p>
<p>We may store the first level lookup on 16-bit values, that would save 2-3kB, but
it's negligible amount of memory.</p>
<table border="1" class="allcolsright highlight-row6 highlight-row7 docutils">
<colgroup>
<col width="9%" />
<col width="9%" />
<col width="9%" />
<col width="9%" />
<col width="9%" />
<col width="9%" />
<col width="9%" />
<col width="9%" />
<col width="9%" />
<col width="9%" />
<col width="9%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">#</th>
<th class="head">higher bits</th>
<th class="head">lower bits</th>
<th class="head">row size [bytes]</th>
<th class="head">uppercase 1st level entries</th>
<th class="head">uppercase 2nd level entries</th>
<th class="head">uppercase total size [bytes]</th>
<th class="head">lowercase 1st level entries</th>
<th class="head">lowercase 2nd level entries</th>
<th class="head">lowercase total size [bytes]</th>
<th class="head">total size [bytes]</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>1</td>
<td>16</td>
<td>1</td>
<td>8</td>
<td>62,625</td>
<td>1,067</td>
<td>259,036</td>
<td>62,608</td>
<td>1,011</td>
<td>258,520</td>
<td>517,556</td>
</tr>
<tr><td>2</td>
<td>15</td>
<td>2</td>
<td>16</td>
<td>31,312</td>
<td>569</td>
<td>134,352</td>
<td>31,304</td>
<td>530</td>
<td>133,696</td>
<td>268,048</td>
</tr>
<tr><td>3</td>
<td>14</td>
<td>3</td>
<td>32</td>
<td>15,656</td>
<td>305</td>
<td>72,384</td>
<td>15,652</td>
<td>279</td>
<td>71,536</td>
<td>143,920</td>
</tr>
<tr><td>4</td>
<td>13</td>
<td>4</td>
<td>64</td>
<td>7,828</td>
<td>168</td>
<td>42,064</td>
<td>7,826</td>
<td>154</td>
<td>41,160</td>
<td>83,224</td>
</tr>
<tr><td>5</td>
<td>12</td>
<td>5</td>
<td>128</td>
<td>3,914</td>
<td>98</td>
<td>28,200</td>
<td>3,913</td>
<td>86</td>
<td>26,660</td>
<td>54,860</td>
</tr>
<tr><td>6</td>
<td>11</td>
<td>6</td>
<td>256</td>
<td>1,957</td>
<td>60</td>
<td>23,188</td>
<td>1,956</td>
<td>55</td>
<td>21,904</td>
<td>45,092</td>
</tr>
<tr><td>7</td>
<td>10</td>
<td>7</td>
<td>512</td>
<td>978</td>
<td>42</td>
<td>25,416</td>
<td>978</td>
<td>35</td>
<td>21,832</td>
<td>47,248</td>
</tr>
<tr><td>8</td>
<td>9</td>
<td>8</td>
<td>1024</td>
<td>489</td>
<td>27</td>
<td>29,604</td>
<td>489</td>
<td>23</td>
<td>25,508</td>
<td>55,112</td>
</tr>
<tr><td>9</td>
<td>8</td>
<td>9</td>
<td>2048</td>
<td>244</td>
<td>19</td>
<td>39,888</td>
<td>244</td>
<td>17</td>
<td>35,792</td>
<td>75,680</td>
</tr>
<tr><td>10</td>
<td>7</td>
<td>10</td>
<td>4096</td>
<td>122</td>
<td>16</td>
<td>66,024</td>
<td>122</td>
<td>14</td>
<td>57,832</td>
<td>123,856</td>
</tr>
<tr><td>11</td>
<td>6</td>
<td>11</td>
<td>8192</td>
<td>61</td>
<td>13</td>
<td>106,740</td>
<td>61</td>
<td>12</td>
<td>98,548</td>
<td>205,288</td>
</tr>
<tr><td>12</td>
<td>5</td>
<td>12</td>
<td>16384</td>
<td>30</td>
<td>9</td>
<td>147,576</td>
<td>30</td>
<td>9</td>
<td>147,576</td>
<td>295,152</td>
</tr>
<tr><td>13</td>
<td>4</td>
<td>13</td>
<td>32768</td>
<td>15</td>
<td>7</td>
<td>229,436</td>
<td>15</td>
<td>7</td>
<td>229,436</td>
<td>458,872</td>
</tr>
<tr><td>14</td>
<td>3</td>
<td>14</td>
<td>65536</td>
<td>7</td>
<td>6</td>
<td>393,244</td>
<td>7</td>
<td>6</td>
<td>393,244</td>
<td>786,488</td>
</tr>
<tr><td>15</td>
<td>2</td>
<td>15</td>
<td>131072</td>
<td>3</td>
<td>4</td>
<td>524,300</td>
<td>3</td>
<td>4</td>
<td>524,300</td>
<td>1,048,600</td>
</tr>
<tr><td>16</td>
<td>1</td>
<td>16</td>
<td>262144</td>
<td>1</td>
<td>2</td>
<td>524,292</td>
<td>1</td>
<td>2</td>
<td>524,292</td>
<td>1,048,584</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="solution-4-compressed-lookup-tables-with-diffs-variant-3">
<span id="compressed-v3"></span><h2>Solution 4 &mdash; compressed lookup tables with diffs (variant #3)</h2>
<p>Another variant of compressed table, but stores character differences (xor)
rather than raw code points. As we have already seen, the number of <strong>distinct
difference values</strong> is significantly lower than character codes. And it appeared
that many rows repeat, they allows even better compression.</p>
<p>The table below also shows that we never get more than 255 distinct
rows, thus the 1st level lookup table can be an array of bytes.</p>
<p>And for the best character code split we are getting comparable table sizes
to the first, more sophisticated <a class="reference internal" href="#compressed-sneller">variant #1</a>.</p>
<table border="1" class="allcolsright highlight-row4 highlight-row5 docutils">
<colgroup>
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">#</th>
<th class="head">higher bits</th>
<th class="head">lower bits</th>
<th class="head">uppercase 1st level entries</th>
<th class="head">uppercase 2nd level entries</th>
<th class="head">uppercase total size [bytes]</th>
<th class="head">lowercase 1st level entries</th>
<th class="head">lowercase 2nd level entries</th>
<th class="head">lowercase total size [bytes]</th>
<th class="head">total size [bytes]</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>1</td>
<td>16</td>
<td>1</td>
<td>65,536</td>
<td>151</td>
<td>66,744</td>
<td>65,536</td>
<td>134</td>
<td>66,608</td>
<td>133,352</td>
</tr>
<tr><td>2</td>
<td>15</td>
<td>2</td>
<td>32,768</td>
<td>141</td>
<td>35,024</td>
<td>32,768</td>
<td>120</td>
<td>34,688</td>
<td>69,712</td>
</tr>
<tr><td>3</td>
<td>14</td>
<td>3</td>
<td>16,384</td>
<td>127</td>
<td>20,448</td>
<td>16,384</td>
<td>105</td>
<td>19,744</td>
<td>40,192</td>
</tr>
<tr><td>4</td>
<td>13</td>
<td>4</td>
<td>8,192</td>
<td>102</td>
<td>14,720</td>
<td>8,192</td>
<td>87</td>
<td>13,760</td>
<td>28,480</td>
</tr>
<tr><td>5</td>
<td>12</td>
<td>5</td>
<td>4,096</td>
<td>82</td>
<td>14,592</td>
<td>4,096</td>
<td>69</td>
<td>12,928</td>
<td>27,520</td>
</tr>
<tr><td>6</td>
<td>11</td>
<td>6</td>
<td>2,048</td>
<td>58</td>
<td>16,896</td>
<td>2,048</td>
<td>53</td>
<td>15,616</td>
<td>32,512</td>
</tr>
<tr><td>7</td>
<td>10</td>
<td>7</td>
<td>1,024</td>
<td>43</td>
<td>23,040</td>
<td>1,024</td>
<td>36</td>
<td>19,456</td>
<td>42,496</td>
</tr>
<tr><td>8</td>
<td>9</td>
<td>8</td>
<td>512</td>
<td>28</td>
<td>29,184</td>
<td>512</td>
<td>24</td>
<td>25,088</td>
<td>54,272</td>
</tr>
<tr><td>9</td>
<td>8</td>
<td>9</td>
<td>256</td>
<td>20</td>
<td>41,216</td>
<td>256</td>
<td>18</td>
<td>37,120</td>
<td>78,336</td>
</tr>
<tr><td>10</td>
<td>7</td>
<td>10</td>
<td>128</td>
<td>17</td>
<td>69,760</td>
<td>128</td>
<td>15</td>
<td>61,568</td>
<td>131,328</td>
</tr>
<tr><td>11</td>
<td>6</td>
<td>11</td>
<td>64</td>
<td>14</td>
<td>114,752</td>
<td>64</td>
<td>13</td>
<td>106,560</td>
<td>221,312</td>
</tr>
<tr><td>12</td>
<td>5</td>
<td>12</td>
<td>32</td>
<td>10</td>
<td>163,872</td>
<td>32</td>
<td>10</td>
<td>163,872</td>
<td>327,744</td>
</tr>
<tr><td>13</td>
<td>4</td>
<td>13</td>
<td>16</td>
<td>8</td>
<td>262,160</td>
<td>16</td>
<td>8</td>
<td>262,160</td>
<td>524,320</td>
</tr>
<tr><td>14</td>
<td>3</td>
<td>14</td>
<td>8</td>
<td>7</td>
<td>458,760</td>
<td>8</td>
<td>7</td>
<td>458,760</td>
<td>917,520</td>
</tr>
<tr><td>15</td>
<td>2</td>
<td>15</td>
<td>4</td>
<td>4</td>
<td>524,292</td>
<td>4</td>
<td>4</td>
<td>524,292</td>
<td>1,048,584</td>
</tr>
<tr><td>16</td>
<td>1</td>
<td>16</td>
<td>2</td>
<td>2</td>
<td>524,290</td>
<td>2</td>
<td>2</td>
<td>524,290</td>
<td>1,048,580</td>
</tr>
</tbody>
</table>
<p>Below is shown the actual implementation of AVX2 procedure, using
10 higher and 7 lower bits of character code. There's also shown
the fast path for ASCII conversion, which is basically the same
in all vectorized procedures.</p>
<pre class="code cpp literal-block">
<span class="kt">size_t</span><span class="w"> </span><span class="nf">avx2_utf32_uppercase_compressed_v3</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="o">*</span><span class="w"> </span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="o">*</span><span class="w"> </span><span class="n">output</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w">
    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w">

    </span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">fallback_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_set1_epi32</span><span class="p">(</span><span class="n">UTF32_UPPERCASE_V3_MAX_HI_BITS</span><span class="p">);</span><span class="w">
    </span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">mask_00ff</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_set1_epi32</span><span class="p">(</span><span class="mh">0x00ff</span><span class="p">);</span><span class="w">
    </span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">mask_000f</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_set1_epi32</span><span class="p">(</span><span class="mh">0x000f</span><span class="p">);</span><span class="w">

    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">8</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">8</span><span class="p">);</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_loadu_si256</span><span class="p">((</span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">input</span><span class="p">[</span><span class="n">i</span><span class="p">]));</span><span class="w">

        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_mm256_testz_si256</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="w"> </span><span class="n">_mm256_set1_epi32</span><span class="p">(</span><span class="mh">0xffffff80</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">ge_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_cmpgt_epi32</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="w"> </span><span class="n">_mm256_set1_epi32</span><span class="p">(</span><span class="sc">'a'</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span><span class="w"> </span><span class="c1">// char &gt;= 'a'
</span><span class="w">            </span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">le_z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_cmpgt_epi32</span><span class="p">(</span><span class="n">_mm256_set1_epi32</span><span class="p">(</span><span class="sc">'z'</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">src</span><span class="p">);</span><span class="w"> </span><span class="c1">// char &lt;= 'z'
</span><span class="w">
            </span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">v0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_and_si256</span><span class="p">(</span><span class="n">ge_a</span><span class="p">,</span><span class="w"> </span><span class="n">le_z</span><span class="p">);</span><span class="w">
            </span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">v1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_and_si256</span><span class="p">(</span><span class="n">v0</span><span class="p">,</span><span class="w"> </span><span class="n">_mm256_set1_epi32</span><span class="p">(</span><span class="mh">0x20</span><span class="p">));</span><span class="w">
            </span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_xor_si256</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="w"> </span><span class="n">v1</span><span class="p">);</span><span class="w">

            </span><span class="n">_mm256_storeu_si256</span><span class="p">((</span><span class="n">__m256i</span><span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span><span class="w"> </span><span class="n">v2</span><span class="p">);</span><span class="w">
            </span><span class="n">j</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span><span class="w">
            </span><span class="k">continue</span><span class="p">;</span><span class="w">
        </span><span class="p">}</span><span class="w">

        </span><span class="c1">// key = min((src &gt;&gt; 4), UTF32_LOWERCASE_V3_MAX_HI_BITS)
</span><span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">key_0</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_srli_epi32</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span><span class="w">
        </span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">key</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_min_epi32</span><span class="p">(</span><span class="n">key_0</span><span class="p">,</span><span class="w"> </span><span class="n">fallback_key</span><span class="p">);</span><span class="w">

        </span><span class="c1">// group_id = lookup[key] &amp; 0xff
</span><span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">group_id_0</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_i32gather_epi32</span><span class="p">((</span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="n">UTF32_UPPERCASE_V3_LOOKUP</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w">
        </span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">group_id</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_and_si256</span><span class="p">(</span><span class="n">group_id_0</span><span class="p">,</span><span class="w"> </span><span class="n">mask_00ff</span><span class="p">);</span><span class="w">

        </span><span class="c1">// ofs = src &amp; 0xf
</span><span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">ofs</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_and_si256</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="w"> </span><span class="n">mask_000f</span><span class="p">);</span><span class="w">

        </span><span class="c1">// const uint32_t diff = UTF32_UPPERCASE_V3_DATA[group_id * 16 + ofs];
</span><span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">indices</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_add_epi32</span><span class="p">(</span><span class="n">_mm256_slli_epi32</span><span class="p">(</span><span class="n">group_id</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="n">ofs</span><span class="p">);</span><span class="w">
        </span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">diff</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_i32gather_epi32</span><span class="p">((</span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="n">UTF32_UPPERCASE_V3_DATA</span><span class="p">,</span><span class="w"> </span><span class="n">indices</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span><span class="w">
        </span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">out</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_xor_si256</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span><span class="w"> </span><span class="n">src</span><span class="p">);</span><span class="w">

        </span><span class="n">_mm256_storeu_si256</span><span class="p">((</span><span class="n">__m256i</span><span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span><span class="w"> </span><span class="n">out</span><span class="p">);</span><span class="w">
        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_mm256_movemask_ps</span><span class="p">(</span><span class="n">_mm256_castsi256_ps</span><span class="p">(</span><span class="n">diff</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">utf32_uppercase_compressed_v3</span><span class="p">(</span><span class="n">input</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="p">);</span><span class="w">
            </span><span class="n">j</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">d</span><span class="p">;</span><span class="w">
        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="n">j</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">

    </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">utf32_uppercase_compressed_v3</span><span class="p">(</span><span class="n">input</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="p">);</span><span class="w">

    </span><span class="k">return</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="p">;</span><span class="w">
</span><span class="p">}</span>
</pre>
</div>
<div class="section" id="vectorization-of-variant-3">
<h2>Vectorization of variant #3</h2>
<p>All compressed variants have to use two memory gather instructions. But in the
variant #3 we limited the range of offsets to bytes. Thus we can use <a class="reference external" href="https://hjlebbink.github.io/x86doc/html/PSHUFB.html">VPSHUFB</a>
(AVX2) or <a class="reference external" href="https://www.felixcloutier.com//x86/vpermi2b">VPERMI2B</a> (AVX-512) to implement the first level lookup.</p>
<p id="compressed-v4"><strong>AVX2 variant #4</strong></p>
<blockquote>
<p>Use 5 higher bits (row #12 in the above table): this requires <strong>two</strong>
<a class="reference external" href="https://hjlebbink.github.io/x86doc/html/PSHUFB.html">VPSHUFB</a> invocations plus some merging. Auxiliary tables size is 320kB.</p>
<p>The lookup code is shown below.</p>
<pre class="code cpp literal-block">
<span class="c1">// key = min((src &gt;&gt; 12), UTF32_LOWERCASE_V4_MAX_HI_BITS)
</span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">key_0</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_srli_epi32</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">);</span><span class="w">
</span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">key</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_min_epi32</span><span class="p">(</span><span class="n">key_0</span><span class="p">,</span><span class="w"> </span><span class="n">_mm256_set1_epi32</span><span class="p">(</span><span class="n">UTF32_LOWERCASE_V4_MAX_HI_BITS</span><span class="p">));</span><span class="w">

</span><span class="c1">// lo = lookup for bits 15:12, where bit #16 is 0
</span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">lo</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_shuffle_epi8</span><span class="p">(</span><span class="n">lo_lookup</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">);</span><span class="w">

</span><span class="c1">// hi = lookup for bits 15:12, where bit #16 is 1
</span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">hi</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_shuffle_epi8</span><span class="p">(</span><span class="n">hi_lookup</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">);</span><span class="w">

</span><span class="c1">// mask: bit #16 to mask
</span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">mask</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_cmpgt_epi32</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">mask_000f</span><span class="p">);</span><span class="w">

</span><span class="c1">// group_id = lookup[key] &amp; 0xff
</span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">ofs_0</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span><span class="w"> </span><span class="n">hi</span><span class="p">,</span><span class="w"> </span><span class="n">lo</span><span class="p">);</span><span class="w">
</span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">ofs_1</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_and_si256</span><span class="p">(</span><span class="n">ofs_0</span><span class="p">,</span><span class="w"> </span><span class="n">mask_00ff</span><span class="p">);</span><span class="w">
</span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">ofs_2</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_slli_epi32</span><span class="p">(</span><span class="n">ofs_1</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">);</span><span class="w">
</span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">ofs_3</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_and_si256</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="w"> </span><span class="n">mask_0fff</span><span class="p">);</span><span class="w">

</span><span class="c1">// indices = (group_id &lt;&lt; 12) + (src_code &amp; 0xfff)
</span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">indices</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_add_epi32</span><span class="p">(</span><span class="n">ofs_3</span><span class="p">,</span><span class="w"> </span><span class="n">ofs_2</span><span class="p">);</span><span class="w">

</span><span class="c1">// const uint32_t diff = UTF32_UPPERCASE_V4_DATA[indices];
</span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">diff</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_i32gather_epi32</span><span class="p">((</span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="n">UTF32_UPPERCASE_V4_DATA</span><span class="p">,</span><span class="w"> </span><span class="n">indices</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span><span class="w">
</span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">out</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_xor_si256</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span><span class="w"> </span><span class="n">src</span><span class="p">);</span><span class="w">

</span><span class="n">_mm256_storeu_si256</span><span class="p">((</span><span class="n">__m256i</span><span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">output</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span><span class="w"> </span><span class="n">out</span><span class="p">);</span>
</pre>
</blockquote>
<p id="compressed-v5"><strong>AVX2 variant #5</strong></p>
<blockquote>
<p>Use 6 higher bits (row #11 in the above table): this requires <strong>four</strong>
<a class="reference external" href="https://hjlebbink.github.io/x86doc/html/PSHUFB.html">VPSHUFB</a> invocations plus merging. Auxiliary tables size is 216kB.</p>
<p>The lookup code is shown below. These four <a class="reference external" href="https://hjlebbink.github.io/x86doc/html/PSHUFB.html">VPSHUFB</a> are not that
expansive, but the whole merging and masking make the whole procedure complex.</p>
<pre class="code cpp literal-block">
<span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">key_0</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_srli_epi32</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">);</span><span class="w">
</span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">key</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_and_si256</span><span class="p">(</span><span class="n">key_0</span><span class="p">,</span><span class="w"> </span><span class="n">mask_000f</span><span class="p">);</span><span class="w">
</span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">selector</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_srli_epi32</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">);</span><span class="w">

</span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">res0_a</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_shuffle_epi8</span><span class="p">(</span><span class="n">lookup_0</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">);</span><span class="w">
</span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">selector_0</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_cmpeq_epi32</span><span class="p">(</span><span class="n">selector</span><span class="p">,</span><span class="w"> </span><span class="n">_mm256_set1_epi32</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span><span class="w">
</span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">res0</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_and_si256</span><span class="p">(</span><span class="n">res0_a</span><span class="p">,</span><span class="w"> </span><span class="n">selector_0</span><span class="p">);</span><span class="w">

</span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">res1_a</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_shuffle_epi8</span><span class="p">(</span><span class="n">lookup_1</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">);</span><span class="w">
</span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">selector_1</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_cmpeq_epi32</span><span class="p">(</span><span class="n">selector</span><span class="p">,</span><span class="w"> </span><span class="n">_mm256_set1_epi32</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span><span class="w">
</span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">res1</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_and_si256</span><span class="p">(</span><span class="n">res1_a</span><span class="p">,</span><span class="w"> </span><span class="n">selector_1</span><span class="p">);</span><span class="w">

</span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">res2_a</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_shuffle_epi8</span><span class="p">(</span><span class="n">lookup_2</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">);</span><span class="w">
</span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">selector_2</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_cmpeq_epi32</span><span class="p">(</span><span class="n">selector</span><span class="p">,</span><span class="w"> </span><span class="n">_mm256_set1_epi32</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span><span class="w">
</span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">res2</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_and_si256</span><span class="p">(</span><span class="n">res2_a</span><span class="p">,</span><span class="w"> </span><span class="n">selector_2</span><span class="p">);</span><span class="w">

</span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">res3_a</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_shuffle_epi8</span><span class="p">(</span><span class="n">lookup_3</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">);</span><span class="w">
</span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">selector_3</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_cmpeq_epi32</span><span class="p">(</span><span class="n">selector</span><span class="p">,</span><span class="w"> </span><span class="n">_mm256_set1_epi32</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span><span class="w">
</span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">res3</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_and_si256</span><span class="p">(</span><span class="n">res3_a</span><span class="p">,</span><span class="w"> </span><span class="n">selector_3</span><span class="p">);</span><span class="w">

</span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">group_0</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_or4_si256</span><span class="p">(</span><span class="n">res0</span><span class="p">,</span><span class="w"> </span><span class="n">res1</span><span class="p">,</span><span class="w"> </span><span class="n">res2</span><span class="p">,</span><span class="w"> </span><span class="n">res3</span><span class="p">);</span><span class="w">
</span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">group_1</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_and_si256</span><span class="p">(</span><span class="n">group_0</span><span class="p">,</span><span class="w"> </span><span class="n">mask_00ff</span><span class="p">);</span><span class="w">
</span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">group</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_slli_epi32</span><span class="p">(</span><span class="n">group_1</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">);</span><span class="w">

</span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">ofs</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_and_si256</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="w"> </span><span class="n">mask_07ff</span><span class="p">);</span><span class="w">
</span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">indices</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_add_epi32</span><span class="p">(</span><span class="n">ofs</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="p">);</span><span class="w">

</span><span class="c1">// const uint32_t diff = UTF32_UPPERCASE_V4_DATA[indices];
</span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">diff</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_i32gather_epi32</span><span class="p">((</span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="n">UTF32_UPPERCASE_V5_DATA</span><span class="p">,</span><span class="w"> </span><span class="n">indices</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span><span class="w">
</span><span class="k">const</span><span class="w"> </span><span class="n">__m256i</span><span class="w"> </span><span class="n">out</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">_mm256_xor_si256</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span><span class="w"> </span><span class="n">src</span><span class="p">);</span>
</pre>
</blockquote>
<p id="compressed-v6"><strong>AVX-512 variant #6</strong></p>
<blockquote>
<p>Use 7 higher bits (row #10 in the above table): this requires a single
invocation of <a class="reference external" href="https://www.felixcloutier.com//x86/vpermi2b">VPERMI2B</a>. Auxiliary tables size is 128kB.</p>
<pre class="code cpp literal-block">
<span class="c1">// key = min((src &gt;&gt; 4), UTF32_LOWERCASE_V6_MAX_HI_BITS)
</span><span class="k">const</span><span class="w"> </span><span class="n">__m512i</span><span class="w"> </span><span class="n">key</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_srli_epi32</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span><span class="w">
</span><span class="k">const</span><span class="w"> </span><span class="n">__m512i</span><span class="w"> </span><span class="n">group_0</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_permutex2var_epi8</span><span class="p">(</span><span class="n">lo_lookup</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">hi_lookup</span><span class="p">);</span><span class="w">
</span><span class="k">const</span><span class="w"> </span><span class="n">__m512i</span><span class="w"> </span><span class="n">group</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_and_si512</span><span class="p">(</span><span class="n">group_0</span><span class="p">,</span><span class="w"> </span><span class="n">mask_00ff</span><span class="p">);</span><span class="w">

</span><span class="k">const</span><span class="w"> </span><span class="n">__m512i</span><span class="w"> </span><span class="n">ofs_0</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_slli_epi32</span><span class="p">(</span><span class="n">group</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span><span class="w">
</span><span class="k">const</span><span class="w"> </span><span class="n">__m512i</span><span class="w"> </span><span class="n">ofs_1</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_and_si512</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="w"> </span><span class="n">mask_03ff</span><span class="p">);</span><span class="w">
</span><span class="k">const</span><span class="w"> </span><span class="n">__m512i</span><span class="w"> </span><span class="n">indices</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_add_epi32</span><span class="p">(</span><span class="n">ofs_1</span><span class="p">,</span><span class="w"> </span><span class="n">ofs_0</span><span class="p">);</span><span class="w">

</span><span class="c1">// const uint32_t diff = UTF32_UPPERCASE_V6_DATA[indices];
</span><span class="k">const</span><span class="w"> </span><span class="n">__m512i</span><span class="w"> </span><span class="n">diff</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_i32gather_epi32</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">uint32_t</span><span class="o">*</span><span class="p">)</span><span class="n">UTF32_UPPERCASE_V6_DATA</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span><span class="w">
</span><span class="k">const</span><span class="w"> </span><span class="n">__m512i</span><span class="w"> </span><span class="n">out</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="n">_mm512_xor_si512</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span><span class="w"> </span><span class="n">src</span><span class="p">);</span>
</pre>
</blockquote>
</div>
</div>
<div class="section" id="experiments">
<h1>Experiments</h1>
<p>The benchmark utility was compiled with <tt class="docutils literal"><span class="pre">-O3</span> <span class="pre">-march=native</span></tt>. We tested only
uppercase conversion, as lowercase code is almost the same.</p>
<table border="1" class="docutils">
<caption>Benchmarked procedures</caption>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Procedure</th>
<th class="head">Comments</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>C++ switch</td>
<td><a class="reference internal" href="#switch">Compiler-generated switch</a></td>
</tr>
<tr><td>scalar single lookup</td>
<td><a class="reference internal" href="#plain-lookup">use a single lookup table</a></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>as above, but vectorized</td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td><a class="reference internal" href="#compressed-v3">variant #3</a></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td><a class="reference internal" href="#compressed-v4">variant #4</a></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td><a class="reference internal" href="#compressed-v5">variant #5</a></td>
</tr>
<tr><td>AVX-512 compressed lookup (variant #6)</td>
<td><a class="reference internal" href="#compressed-v6">variant #6</a></td>
</tr>
</tbody>
</table>
<div class="section" id="ryzen-7">
<h2>Ryzen 7</h2>
<ul class="simple">
<li>Compiler: gcc (Debian 14.1.0-5) 14.1.0</li>
<li>CPU: AMD Ryzen 7 7730U with Radeon Graphics</li>
</ul>
<table border="1" class="col2right col3right col4center docutils">
<colgroup>
<col width="33%" />
<col width="12%" />
<col width="10%" />
<col width="4%" />
<col width="41%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">procedure</th>
<th class="head" colspan="2">time in cycles per char</th>
<th class="head" colspan="2">speed-up</th>
</tr>
<tr><th class="head">&nbsp;</th>
<th class="head">average</th>
<th class="head">best</th>
<th class="head">&nbsp;</th>
<th class="head">&nbsp;</th>
</tr>
</thead>
<tbody valign="top">
<tr><td colspan="5">dataset <em>arabic</em></td>
</tr>
<tr><td>C++ switch</td>
<td>6.212</td>
<td>6.138</td>
<td>0.1</td>
<td><tt class="docutils literal"><span class="pre">███▎</span></tt></td>
</tr>
<tr><td>scalar single lookup</td>
<td>0.903</td>
<td>0.897</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">██████████████████████▊</span></tt></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>0.522</td>
<td>0.511</td>
<td>1.8</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████████</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #2)</td>
<td>0.949</td>
<td>0.942</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">█████████████████████▋</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td>1.007</td>
<td>0.990</td>
<td>0.9</td>
<td><tt class="docutils literal"><span class="pre">████████████████████▋</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td>0.654</td>
<td>0.636</td>
<td>1.4</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████▏</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td>0.789</td>
<td>0.783</td>
<td>1.1</td>
<td><tt class="docutils literal"><span class="pre">██████████████████████████</span></tt></td>
</tr>
<tr><td colspan="5">dataset <em>chinese</em></td>
</tr>
<tr><td>C++ switch</td>
<td>5.755</td>
<td>5.668</td>
<td>0.2</td>
<td><tt class="docutils literal"><span class="pre">███▎</span></tt></td>
</tr>
<tr><td>scalar single lookup</td>
<td>0.901</td>
<td>0.892</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">█████████████████████</span></tt></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>0.502</td>
<td>0.470</td>
<td>1.9</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████████</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #2)</td>
<td>0.821</td>
<td>0.807</td>
<td>1.1</td>
<td><tt class="docutils literal"><span class="pre">███████████████████████▎</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td>0.870</td>
<td>0.859</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">█████████████████████▉</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td>0.598</td>
<td>0.575</td>
<td>1.6</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████▋</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td>0.696</td>
<td>0.686</td>
<td>1.3</td>
<td><tt class="docutils literal"><span class="pre">███████████████████████████▍</span></tt></td>
</tr>
<tr><td colspan="5">dataset <em>czech</em></td>
</tr>
<tr><td>C++ switch</td>
<td>9.509</td>
<td>9.367</td>
<td>0.1</td>
<td><tt class="docutils literal">█▊</tt></td>
</tr>
<tr><td>scalar single lookup</td>
<td>0.891</td>
<td>0.885</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">███████████████████▊</span></tt></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>0.468</td>
<td>0.437</td>
<td>2.0</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████████</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #2)</td>
<td>0.808</td>
<td>0.790</td>
<td>1.1</td>
<td><tt class="docutils literal"><span class="pre">██████████████████████▏</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td>0.860</td>
<td>0.840</td>
<td>1.1</td>
<td><tt class="docutils literal"><span class="pre">████████████████████▊</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td>0.581</td>
<td>0.558</td>
<td>1.6</td>
<td><tt class="docutils literal"><span class="pre">███████████████████████████████▎</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td>0.683</td>
<td>0.665</td>
<td>1.3</td>
<td><tt class="docutils literal"><span class="pre">██████████████████████████▎</span></tt></td>
</tr>
<tr><td colspan="5">dataset <em>english</em></td>
</tr>
<tr><td>C++ switch</td>
<td>9.114</td>
<td>9.016</td>
<td>0.1</td>
<td><tt class="docutils literal">▉</tt></td>
</tr>
<tr><td>scalar single lookup</td>
<td>0.889</td>
<td>0.883</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">█████████▎</span></tt></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>0.268</td>
<td>0.205</td>
<td>4.3</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████████</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #2)</td>
<td>0.326</td>
<td>0.323</td>
<td>2.7</td>
<td><tt class="docutils literal"><span class="pre">█████████████████████████▍</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td>0.328</td>
<td>0.325</td>
<td>2.7</td>
<td><tt class="docutils literal"><span class="pre">█████████████████████████▏</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td>0.263</td>
<td>0.261</td>
<td>3.4</td>
<td><tt class="docutils literal"><span class="pre">███████████████████████████████▍</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td>0.321</td>
<td>0.319</td>
<td>2.8</td>
<td><tt class="docutils literal"><span class="pre">█████████████████████████▋</span></tt></td>
</tr>
<tr><td colspan="5">dataset <em>esperanto</em></td>
</tr>
<tr><td>C++ switch</td>
<td>9.649</td>
<td>9.532</td>
<td>0.1</td>
<td><tt class="docutils literal">█</tt></td>
</tr>
<tr><td>scalar single lookup</td>
<td>0.890</td>
<td>0.883</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">███████████▊</span></tt></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>0.280</td>
<td>0.260</td>
<td>3.4</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████████</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #2)</td>
<td>0.449</td>
<td>0.440</td>
<td>2.0</td>
<td><tt class="docutils literal"><span class="pre">███████████████████████▋</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td>0.456</td>
<td>0.447</td>
<td>2.0</td>
<td><tt class="docutils literal"><span class="pre">███████████████████████▎</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td>0.350</td>
<td>0.343</td>
<td>2.6</td>
<td><tt class="docutils literal"><span class="pre">██████████████████████████████▎</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td>0.419</td>
<td>0.411</td>
<td>2.1</td>
<td><tt class="docutils literal"><span class="pre">█████████████████████████▎</span></tt></td>
</tr>
<tr><td colspan="5">dataset <em>french</em></td>
</tr>
<tr><td>C++ switch</td>
<td>9.592</td>
<td>9.478</td>
<td>0.1</td>
<td><tt class="docutils literal">██▌</tt></td>
</tr>
<tr><td>scalar single lookup</td>
<td>0.890</td>
<td>0.883</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">███████████████████████████▏</span></tt></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>0.625</td>
<td>0.600</td>
<td>1.5</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████████</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #2)</td>
<td>0.864</td>
<td>0.851</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████▏</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td>0.791</td>
<td>0.767</td>
<td>1.2</td>
<td><tt class="docutils literal"><span class="pre">███████████████████████████████▎</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td>0.673</td>
<td>0.650</td>
<td>1.4</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████▉</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td>0.746</td>
<td>0.726</td>
<td>1.2</td>
<td><tt class="docutils literal"><span class="pre">█████████████████████████████████</span></tt></td>
</tr>
<tr><td colspan="5">dataset <em>german</em></td>
</tr>
<tr><td>C++ switch</td>
<td>10.109</td>
<td>10.017</td>
<td>0.1</td>
<td><tt class="docutils literal">█▏</tt></td>
</tr>
<tr><td>scalar single lookup</td>
<td>0.899</td>
<td>0.895</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">████████████▉</span></tt></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>0.309</td>
<td>0.290</td>
<td>3.1</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████████</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #2)</td>
<td>0.499</td>
<td>0.488</td>
<td>1.8</td>
<td><tt class="docutils literal"><span class="pre">███████████████████████▊</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td>0.495</td>
<td>0.487</td>
<td>1.8</td>
<td><tt class="docutils literal"><span class="pre">███████████████████████▊</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td>0.384</td>
<td>0.372</td>
<td>2.4</td>
<td><tt class="docutils literal"><span class="pre">███████████████████████████████▏</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td>0.450</td>
<td>0.439</td>
<td>2.0</td>
<td><tt class="docutils literal"><span class="pre">██████████████████████████▍</span></tt></td>
</tr>
<tr><td colspan="5">dataset <em>greek</em></td>
</tr>
<tr><td>C++ switch</td>
<td>9.680</td>
<td>9.591</td>
<td>0.1</td>
<td><tt class="docutils literal">██▎</tt></td>
</tr>
<tr><td>scalar single lookup</td>
<td>0.892</td>
<td>0.884</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████▉</span></tt></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>0.565</td>
<td>0.550</td>
<td>1.6</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████████</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #2)</td>
<td>1.027</td>
<td>1.016</td>
<td>0.9</td>
<td><tt class="docutils literal"><span class="pre">█████████████████████▋</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td>1.091</td>
<td>1.078</td>
<td>0.8</td>
<td><tt class="docutils literal"><span class="pre">████████████████████▍</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td>0.708</td>
<td>0.689</td>
<td>1.3</td>
<td><tt class="docutils literal"><span class="pre">███████████████████████████████▉</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td>0.858</td>
<td>0.845</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">██████████████████████████</span></tt></td>
</tr>
<tr><td colspan="5">dataset <em>hebrew</em></td>
</tr>
<tr><td>C++ switch</td>
<td>5.685</td>
<td>5.644</td>
<td>0.2</td>
<td><tt class="docutils literal"><span class="pre">████▎</span></tt></td>
</tr>
<tr><td>scalar single lookup</td>
<td>0.891</td>
<td>0.884</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">███████████████████████████▏</span></tt></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>0.619</td>
<td>0.600</td>
<td>1.5</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████████</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #2)</td>
<td>1.171</td>
<td>1.160</td>
<td>0.8</td>
<td><tt class="docutils literal"><span class="pre">████████████████████▋</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td>1.265</td>
<td>1.252</td>
<td>0.7</td>
<td><tt class="docutils literal"><span class="pre">███████████████████▏</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td>0.780</td>
<td>0.770</td>
<td>1.1</td>
<td><tt class="docutils literal"><span class="pre">███████████████████████████████▏</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td>0.954</td>
<td>0.944</td>
<td>0.9</td>
<td><tt class="docutils literal"><span class="pre">█████████████████████████▍</span></tt></td>
</tr>
<tr><td colspan="5">dataset <em>hindi</em></td>
</tr>
<tr><td>C++ switch</td>
<td>6.262</td>
<td>6.211</td>
<td>0.1</td>
<td><tt class="docutils literal"><span class="pre">███▍</span></tt></td>
</tr>
<tr><td>scalar single lookup</td>
<td>0.889</td>
<td>0.884</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████▏</span></tt></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>0.550</td>
<td>0.534</td>
<td>1.7</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████████</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #2)</td>
<td>1.033</td>
<td>1.023</td>
<td>0.9</td>
<td><tt class="docutils literal"><span class="pre">████████████████████▉</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td>1.116</td>
<td>1.105</td>
<td>0.8</td>
<td><tt class="docutils literal"><span class="pre">███████████████████▎</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td>0.686</td>
<td>0.678</td>
<td>1.3</td>
<td><tt class="docutils literal"><span class="pre">███████████████████████████████▌</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td>0.865</td>
<td>0.856</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████▉</span></tt></td>
</tr>
<tr><td colspan="5">dataset <em>japanese</em></td>
</tr>
<tr><td>C++ switch</td>
<td>5.423</td>
<td>5.305</td>
<td>0.2</td>
<td><tt class="docutils literal"><span class="pre">███▋</span></tt></td>
</tr>
<tr><td>scalar single lookup</td>
<td>0.894</td>
<td>0.887</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">██████████████████████</span></tt></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>0.521</td>
<td>0.488</td>
<td>1.8</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████████</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #2)</td>
<td>0.877</td>
<td>0.868</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">██████████████████████▍</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td>0.950</td>
<td>0.937</td>
<td>0.9</td>
<td><tt class="docutils literal"><span class="pre">████████████████████▊</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td>0.635</td>
<td>0.618</td>
<td>1.4</td>
<td><tt class="docutils literal"><span class="pre">███████████████████████████████▌</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td>0.754</td>
<td>0.746</td>
<td>1.2</td>
<td><tt class="docutils literal"><span class="pre">██████████████████████████▏</span></tt></td>
</tr>
<tr><td colspan="5">dataset <em>korean</em></td>
</tr>
<tr><td>C++ switch</td>
<td>6.466</td>
<td>6.404</td>
<td>0.1</td>
<td><tt class="docutils literal">██▊</tt></td>
</tr>
<tr><td>scalar single lookup</td>
<td>0.887</td>
<td>0.883</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">████████████████████▋</span></tt></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>0.478</td>
<td>0.456</td>
<td>1.9</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████████</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #2)</td>
<td>0.821</td>
<td>0.807</td>
<td>1.1</td>
<td><tt class="docutils literal"><span class="pre">██████████████████████▌</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td>0.883</td>
<td>0.868</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">█████████████████████</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td>0.614</td>
<td>0.597</td>
<td>1.5</td>
<td><tt class="docutils literal"><span class="pre">██████████████████████████████▌</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td>0.711</td>
<td>0.700</td>
<td>1.3</td>
<td><tt class="docutils literal"><span class="pre">██████████████████████████</span></tt></td>
</tr>
<tr><td colspan="5">dataset <em>persan</em></td>
</tr>
<tr><td>C++ switch</td>
<td>6.121</td>
<td>6.063</td>
<td>0.1</td>
<td><tt class="docutils literal">███</tt></td>
</tr>
<tr><td>scalar single lookup</td>
<td>0.887</td>
<td>0.883</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">████████████████████▋</span></tt></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>0.468</td>
<td>0.458</td>
<td>1.9</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████████</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #2)</td>
<td>0.889</td>
<td>0.878</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">████████████████████▊</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td>0.946</td>
<td>0.941</td>
<td>0.9</td>
<td><tt class="docutils literal"><span class="pre">███████████████████▍</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td>0.607</td>
<td>0.597</td>
<td>1.5</td>
<td><tt class="docutils literal"><span class="pre">██████████████████████████████▋</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td>0.751</td>
<td>0.745</td>
<td>1.2</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████▌</span></tt></td>
</tr>
<tr><td colspan="5">dataset <em>portuguese</em></td>
</tr>
<tr><td>C++ switch</td>
<td>9.663</td>
<td>9.550</td>
<td>0.1</td>
<td><tt class="docutils literal">█▍</tt></td>
</tr>
<tr><td>scalar single lookup</td>
<td>0.889</td>
<td>0.883</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">███████████████▊</span></tt></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>0.372</td>
<td>0.349</td>
<td>2.5</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████████</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #2)</td>
<td>0.693</td>
<td>0.674</td>
<td>1.3</td>
<td><tt class="docutils literal"><span class="pre">████████████████████▋</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td>0.582</td>
<td>0.565</td>
<td>1.6</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████▋</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td>0.439</td>
<td>0.416</td>
<td>2.1</td>
<td><tt class="docutils literal"><span class="pre">█████████████████████████████████▌</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td>0.524</td>
<td>0.501</td>
<td>1.8</td>
<td><tt class="docutils literal"><span class="pre">███████████████████████████▊</span></tt></td>
</tr>
<tr><td colspan="5">dataset <em>russian</em></td>
</tr>
<tr><td>C++ switch</td>
<td>9.452</td>
<td>9.389</td>
<td>0.1</td>
<td><tt class="docutils literal">██▌</tt></td>
</tr>
<tr><td>scalar single lookup</td>
<td>0.888</td>
<td>0.884</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">██████████████████████████▋</span></tt></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>0.607</td>
<td>0.589</td>
<td>1.5</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████████</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #2)</td>
<td>1.158</td>
<td>1.143</td>
<td>0.8</td>
<td><tt class="docutils literal"><span class="pre">████████████████████▌</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td>1.246</td>
<td>1.233</td>
<td>0.7</td>
<td><tt class="docutils literal"><span class="pre">███████████████████</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td>0.766</td>
<td>0.755</td>
<td>1.2</td>
<td><tt class="docutils literal"><span class="pre">███████████████████████████████▏</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td>0.936</td>
<td>0.924</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">█████████████████████████▍</span></tt></td>
</tr>
<tr><td colspan="5">dataset <em>thai</em></td>
</tr>
<tr><td>C++ switch</td>
<td>5.738</td>
<td>5.682</td>
<td>0.2</td>
<td><tt class="docutils literal"><span class="pre">███▋</span></tt></td>
</tr>
<tr><td>scalar single lookup</td>
<td>0.886</td>
<td>0.883</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">███████████████████████▍</span></tt></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>0.535</td>
<td>0.518</td>
<td>1.7</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████████</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #2)</td>
<td>1.019</td>
<td>1.007</td>
<td>0.9</td>
<td><tt class="docutils literal"><span class="pre">████████████████████▌</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td>1.055</td>
<td>1.045</td>
<td>0.8</td>
<td><tt class="docutils literal"><span class="pre">███████████████████▊</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td>0.687</td>
<td>0.676</td>
<td>1.3</td>
<td><tt class="docutils literal"><span class="pre">██████████████████████████████▋</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td>0.831</td>
<td>0.820</td>
<td>1.1</td>
<td><tt class="docutils literal"><span class="pre">█████████████████████████▎</span></tt></td>
</tr>
<tr><td colspan="5">dataset <em>turkish</em></td>
</tr>
<tr><td>C++ switch</td>
<td>9.544</td>
<td>9.419</td>
<td>0.1</td>
<td><tt class="docutils literal">█▋</tt></td>
</tr>
<tr><td>scalar single lookup</td>
<td>0.892</td>
<td>0.885</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">██████████████████▎</span></tt></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>0.433</td>
<td>0.406</td>
<td>2.2</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████████</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #2)</td>
<td>0.866</td>
<td>0.825</td>
<td>1.1</td>
<td><tt class="docutils literal"><span class="pre">███████████████████▋</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td>0.794</td>
<td>0.768</td>
<td>1.2</td>
<td><tt class="docutils literal"><span class="pre">█████████████████████▏</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td>0.538</td>
<td>0.519</td>
<td>1.7</td>
<td><tt class="docutils literal"><span class="pre">███████████████████████████████▎</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td>0.641</td>
<td>0.618</td>
<td>1.4</td>
<td><tt class="docutils literal"><span class="pre">██████████████████████████▎</span></tt></td>
</tr>
<tr><td colspan="5">dataset <em>vietnamese</em></td>
</tr>
<tr><td>C++ switch</td>
<td>8.915</td>
<td>8.839</td>
<td>0.1</td>
<td><tt class="docutils literal">██▎</tt></td>
</tr>
<tr><td>scalar single lookup</td>
<td>0.898</td>
<td>0.893</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">███████████████████████▎</span></tt></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>0.542</td>
<td>0.520</td>
<td>1.7</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████████</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #2)</td>
<td>0.973</td>
<td>0.958</td>
<td>0.9</td>
<td><tt class="docutils literal"><span class="pre">█████████████████████▋</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td>1.062</td>
<td>1.047</td>
<td>0.9</td>
<td><tt class="docutils literal"><span class="pre">███████████████████▊</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td>0.654</td>
<td>0.640</td>
<td>1.4</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████▌</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td>0.841</td>
<td>0.817</td>
<td>1.1</td>
<td><tt class="docutils literal"><span class="pre">█████████████████████████▍</span></tt></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="ice-lake">
<h2>Ice Lake</h2>
<ul class="simple">
<li>Compiler: gcc (GCC) 13.3.1 20240611 (Red Hat 13.3.1-2)</li>
<li>CPU: Intel(R) Xeon(R) Gold 6338 CPU &#64; 2.00GHz</li>
</ul>
<table border="1" class="col2right col3right col4center docutils">
<colgroup>
<col width="35%" />
<col width="11%" />
<col width="10%" />
<col width="4%" />
<col width="40%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">procedure</th>
<th class="head" colspan="2">time in cycles per char</th>
<th class="head" colspan="2">speed-up</th>
</tr>
<tr><th class="head">&nbsp;</th>
<th class="head">average</th>
<th class="head">best</th>
<th class="head">&nbsp;</th>
<th class="head">&nbsp;</th>
</tr>
</thead>
<tbody valign="top">
<tr><td colspan="5">dataset <em>arabic</em></td>
</tr>
<tr><td>C++ switch</td>
<td>8.124</td>
<td>8.006</td>
<td>0.2</td>
<td><tt class="docutils literal"><span class="pre">████</span></tt></td>
</tr>
<tr><td>scalar single lookup</td>
<td>1.412</td>
<td>1.408</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">███████████████████████▏</span></tt></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>1.295</td>
<td>1.284</td>
<td>1.1</td>
<td><tt class="docutils literal"><span class="pre">█████████████████████████▍</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #2)</td>
<td>2.902</td>
<td>2.893</td>
<td>0.5</td>
<td><tt class="docutils literal"><span class="pre">███████████▎</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td>3.051</td>
<td>3.042</td>
<td>0.5</td>
<td><tt class="docutils literal"><span class="pre">██████████▋</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td>1.349</td>
<td>1.340</td>
<td>1.1</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████▎</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td>1.433</td>
<td>1.422</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">██████████████████████▉</span></tt></td>
</tr>
<tr><td>AVX-512 compressed lookup (variant #6)</td>
<td>0.822</td>
<td>0.815</td>
<td>1.7</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████████</span></tt></td>
</tr>
<tr><td colspan="5">dataset <em>chinese</em></td>
</tr>
<tr><td>C++ switch</td>
<td>7.618</td>
<td>7.426</td>
<td>0.2</td>
<td><tt class="docutils literal"><span class="pre">████</span></tt></td>
</tr>
<tr><td>scalar single lookup</td>
<td>1.414</td>
<td>1.406</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">█████████████████████▌</span></tt></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>1.102</td>
<td>1.074</td>
<td>1.3</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████▏</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #2)</td>
<td>2.462</td>
<td>2.449</td>
<td>0.6</td>
<td><tt class="docutils literal"><span class="pre">████████████▎</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td>2.591</td>
<td>2.580</td>
<td>0.5</td>
<td><tt class="docutils literal"><span class="pre">███████████▋</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td>1.164</td>
<td>1.150</td>
<td>1.2</td>
<td><tt class="docutils literal"><span class="pre">██████████████████████████▎</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td>1.233</td>
<td>1.215</td>
<td>1.2</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████▉</span></tt></td>
</tr>
<tr><td>AVX-512 compressed lookup (variant #6)</td>
<td>0.771</td>
<td>0.756</td>
<td>1.9</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████████</span></tt></td>
</tr>
<tr><td colspan="5">dataset <em>czech</em></td>
</tr>
<tr><td>C++ switch</td>
<td>12.857</td>
<td>12.738</td>
<td>0.1</td>
<td><tt class="docutils literal">██</tt></td>
</tr>
<tr><td>scalar single lookup</td>
<td>1.406</td>
<td>1.400</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">██████████████████▉</span></tt></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>1.344</td>
<td>1.301</td>
<td>1.1</td>
<td><tt class="docutils literal"><span class="pre">████████████████████▎</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #2)</td>
<td>2.161</td>
<td>2.147</td>
<td>0.7</td>
<td><tt class="docutils literal"><span class="pre">████████████▎</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td>2.317</td>
<td>2.290</td>
<td>0.6</td>
<td><tt class="docutils literal"><span class="pre">███████████▌</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td>1.559</td>
<td>1.493</td>
<td>0.9</td>
<td><tt class="docutils literal"><span class="pre">█████████████████▋</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td>1.712</td>
<td>1.457</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">██████████████████▏</span></tt></td>
</tr>
<tr><td>AVX-512 compressed lookup (variant #6)</td>
<td>0.677</td>
<td>0.661</td>
<td>2.1</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████████</span></tt></td>
</tr>
<tr><td colspan="5">dataset <em>english</em></td>
</tr>
<tr><td>C++ switch</td>
<td>19.209</td>
<td>18.990</td>
<td>0.1</td>
<td><tt class="docutils literal">█▊</tt></td>
</tr>
<tr><td>scalar single lookup</td>
<td>2.276</td>
<td>2.263</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">███████████████▍</span></tt></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>0.895</td>
<td>0.873</td>
<td>2.6</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████████</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #2)</td>
<td>0.971</td>
<td>0.935</td>
<td>2.4</td>
<td><tt class="docutils literal"><span class="pre">█████████████████████████████████████▎</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td>0.994</td>
<td>0.982</td>
<td>2.3</td>
<td><tt class="docutils literal"><span class="pre">███████████████████████████████████▌</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td>0.920</td>
<td>0.904</td>
<td>2.5</td>
<td><tt class="docutils literal"><span class="pre">██████████████████████████████████████▋</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td>0.934</td>
<td>0.918</td>
<td>2.5</td>
<td><tt class="docutils literal"><span class="pre">██████████████████████████████████████</span></tt></td>
</tr>
<tr><td>AVX-512 compressed lookup (variant #6)</td>
<td>1.946</td>
<td>1.934</td>
<td>1.2</td>
<td><tt class="docutils literal"><span class="pre">██████████████████</span></tt></td>
</tr>
<tr><td colspan="5">dataset <em>esperanto</em></td>
</tr>
<tr><td>C++ switch</td>
<td>12.732</td>
<td>12.528</td>
<td>0.1</td>
<td><tt class="docutils literal">█▌</tt></td>
</tr>
<tr><td>scalar single lookup</td>
<td>1.407</td>
<td>1.400</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">█████████████▋</span></tt></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>0.501</td>
<td>0.479</td>
<td>2.9</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████████</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #2)</td>
<td>0.807</td>
<td>0.799</td>
<td>1.8</td>
<td><tt class="docutils literal"><span class="pre">███████████████████████▉</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td>0.874</td>
<td>0.866</td>
<td>1.6</td>
<td><tt class="docutils literal"><span class="pre">██████████████████████</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td>0.579</td>
<td>0.570</td>
<td>2.5</td>
<td><tt class="docutils literal"><span class="pre">█████████████████████████████████▌</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td>0.608</td>
<td>0.590</td>
<td>2.4</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████▍</span></tt></td>
</tr>
<tr><td>AVX-512 compressed lookup (variant #6)</td>
<td>1.090</td>
<td>1.075</td>
<td>1.3</td>
<td><tt class="docutils literal"><span class="pre">█████████████████▊</span></tt></td>
</tr>
<tr><td colspan="5">dataset <em>french</em></td>
</tr>
<tr><td>C++ switch</td>
<td>12.895</td>
<td>12.731</td>
<td>0.1</td>
<td><tt class="docutils literal"><span class="pre">███▍</span></tt></td>
</tr>
<tr><td>scalar single lookup</td>
<td>1.422</td>
<td>1.414</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">██████████████████████████████▋</span></tt></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>1.877</td>
<td>1.825</td>
<td>0.8</td>
<td><tt class="docutils literal"><span class="pre">███████████████████████▊</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #2)</td>
<td>2.326</td>
<td>2.273</td>
<td>0.6</td>
<td><tt class="docutils literal"><span class="pre">███████████████████</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td>2.376</td>
<td>1.594</td>
<td>0.9</td>
<td><tt class="docutils literal"><span class="pre">███████████████████████████▎</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td>1.338</td>
<td>1.286</td>
<td>1.1</td>
<td><tt class="docutils literal"><span class="pre">█████████████████████████████████▊</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td>1.431</td>
<td>1.405</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">██████████████████████████████▉</span></tt></td>
</tr>
<tr><td>AVX-512 compressed lookup (variant #6)</td>
<td>1.109</td>
<td>1.086</td>
<td>1.3</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████████</span></tt></td>
</tr>
<tr><td colspan="5">dataset <em>german</em></td>
</tr>
<tr><td>C++ switch</td>
<td>13.709</td>
<td>13.554</td>
<td>0.1</td>
<td><tt class="docutils literal">█▍</tt></td>
</tr>
<tr><td>scalar single lookup</td>
<td>1.429</td>
<td>1.424</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">██████████████▏</span></tt></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>0.526</td>
<td>0.503</td>
<td>2.8</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████████</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #2)</td>
<td>0.887</td>
<td>0.877</td>
<td>1.6</td>
<td><tt class="docutils literal"><span class="pre">██████████████████████▉</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td>0.952</td>
<td>0.938</td>
<td>1.5</td>
<td><tt class="docutils literal"><span class="pre">█████████████████████▍</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td>0.631</td>
<td>0.618</td>
<td>2.3</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████▌</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td>0.711</td>
<td>0.647</td>
<td>2.2</td>
<td><tt class="docutils literal"><span class="pre">███████████████████████████████</span></tt></td>
</tr>
<tr><td>AVX-512 compressed lookup (variant #6)</td>
<td>1.056</td>
<td>1.047</td>
<td>1.4</td>
<td><tt class="docutils literal"><span class="pre">███████████████████▏</span></tt></td>
</tr>
<tr><td colspan="5">dataset <em>greek</em></td>
</tr>
<tr><td>C++ switch</td>
<td>12.674</td>
<td>12.444</td>
<td>0.1</td>
<td><tt class="docutils literal">█▉</tt></td>
</tr>
<tr><td>scalar single lookup</td>
<td>1.409</td>
<td>1.401</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">████████████████▉</span></tt></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>1.417</td>
<td>1.399</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">████████████████▉</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #2)</td>
<td>3.357</td>
<td>3.342</td>
<td>0.4</td>
<td><tt class="docutils literal"><span class="pre">███████</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td>3.521</td>
<td>3.508</td>
<td>0.4</td>
<td><tt class="docutils literal"><span class="pre">██████▊</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td>1.478</td>
<td>1.468</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">████████████████▏</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td>1.572</td>
<td>1.557</td>
<td>0.9</td>
<td><tt class="docutils literal"><span class="pre">███████████████▏</span></tt></td>
</tr>
<tr><td>AVX-512 compressed lookup (variant #6)</td>
<td>0.606</td>
<td>0.593</td>
<td>2.4</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████████</span></tt></td>
</tr>
<tr><td colspan="5">dataset <em>hebrew</em></td>
</tr>
<tr><td>C++ switch</td>
<td>7.511</td>
<td>7.372</td>
<td>0.2</td>
<td><tt class="docutils literal">██▋</tt></td>
</tr>
<tr><td>scalar single lookup</td>
<td>1.407</td>
<td>1.401</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">██████████████▏</span></tt></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>1.617</td>
<td>1.599</td>
<td>0.9</td>
<td><tt class="docutils literal"><span class="pre">████████████▍</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #2)</td>
<td>3.944</td>
<td>3.933</td>
<td>0.4</td>
<td><tt class="docutils literal"><span class="pre">█████</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td>4.137</td>
<td>4.128</td>
<td>0.3</td>
<td><tt class="docutils literal"><span class="pre">████▊</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td>1.685</td>
<td>1.678</td>
<td>0.8</td>
<td><tt class="docutils literal"><span class="pre">███████████▊</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td>1.795</td>
<td>1.788</td>
<td>0.8</td>
<td><tt class="docutils literal"><span class="pre">███████████</span></tt></td>
</tr>
<tr><td>AVX-512 compressed lookup (variant #6)</td>
<td>0.509</td>
<td>0.497</td>
<td>2.8</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████████</span></tt></td>
</tr>
<tr><td colspan="5">dataset <em>hindi</em></td>
</tr>
<tr><td>C++ switch</td>
<td>8.567</td>
<td>8.410</td>
<td>0.2</td>
<td><tt class="docutils literal">██▋</tt></td>
</tr>
<tr><td>scalar single lookup</td>
<td>1.408</td>
<td>1.401</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">████████████████▎</span></tt></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>1.421</td>
<td>1.405</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">████████████████▏</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #2)</td>
<td>3.432</td>
<td>3.423</td>
<td>0.4</td>
<td><tt class="docutils literal"><span class="pre">██████▋</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td>3.608</td>
<td>3.600</td>
<td>0.4</td>
<td><tt class="docutils literal"><span class="pre">██████▎</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td>1.492</td>
<td>1.482</td>
<td>0.9</td>
<td><tt class="docutils literal"><span class="pre">███████████████▍</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td>1.607</td>
<td>1.580</td>
<td>0.9</td>
<td><tt class="docutils literal"><span class="pre">██████████████▍</span></tt></td>
</tr>
<tr><td>AVX-512 compressed lookup (variant #6)</td>
<td>0.580</td>
<td>0.570</td>
<td>2.5</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████████</span></tt></td>
</tr>
<tr><td colspan="5">dataset <em>japanese</em></td>
</tr>
<tr><td>C++ switch</td>
<td>6.879</td>
<td>6.635</td>
<td>0.2</td>
<td><tt class="docutils literal"><span class="pre">████▎</span></tt></td>
</tr>
<tr><td>scalar single lookup</td>
<td>1.412</td>
<td>1.404</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">████████████████████</span></tt></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>1.209</td>
<td>1.183</td>
<td>1.2</td>
<td><tt class="docutils literal"><span class="pre">███████████████████████▊</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #2)</td>
<td>2.751</td>
<td>2.738</td>
<td>0.5</td>
<td><tt class="docutils literal"><span class="pre">██████████▎</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td>2.894</td>
<td>2.881</td>
<td>0.5</td>
<td><tt class="docutils literal"><span class="pre">█████████▊</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td>1.261</td>
<td>1.246</td>
<td>1.1</td>
<td><tt class="docutils literal"><span class="pre">██████████████████████▋</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td>1.333</td>
<td>1.322</td>
<td>1.1</td>
<td><tt class="docutils literal"><span class="pre">█████████████████████▎</span></tt></td>
</tr>
<tr><td>AVX-512 compressed lookup (variant #6)</td>
<td>0.722</td>
<td>0.705</td>
<td>2.0</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████████</span></tt></td>
</tr>
<tr><td colspan="5">dataset <em>korean</em></td>
</tr>
<tr><td>C++ switch</td>
<td>8.328</td>
<td>8.102</td>
<td>0.2</td>
<td><tt class="docutils literal"><span class="pre">███▊</span></tt></td>
</tr>
<tr><td>scalar single lookup</td>
<td>1.409</td>
<td>1.402</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">██████████████████████▏</span></tt></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>1.093</td>
<td>1.069</td>
<td>1.3</td>
<td><tt class="docutils literal"><span class="pre">█████████████████████████████</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #2)</td>
<td>2.451</td>
<td>2.443</td>
<td>0.6</td>
<td><tt class="docutils literal"><span class="pre">████████████▋</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td>2.580</td>
<td>2.573</td>
<td>0.5</td>
<td><tt class="docutils literal"><span class="pre">████████████</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td>1.150</td>
<td>1.138</td>
<td>1.2</td>
<td><tt class="docutils literal"><span class="pre">███████████████████████████▎</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td>1.213</td>
<td>1.204</td>
<td>1.2</td>
<td><tt class="docutils literal"><span class="pre">█████████████████████████▊</span></tt></td>
</tr>
<tr><td>AVX-512 compressed lookup (variant #6)</td>
<td>0.800</td>
<td>0.777</td>
<td>1.8</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████████</span></tt></td>
</tr>
<tr><td colspan="5">dataset <em>persan</em></td>
</tr>
<tr><td>C++ switch</td>
<td>12.663</td>
<td>12.325</td>
<td>0.2</td>
<td><tt class="docutils literal"><span class="pre">███▌</span></tt></td>
</tr>
<tr><td>scalar single lookup</td>
<td>2.260</td>
<td>2.240</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">███████████████████▍</span></tt></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>1.979</td>
<td>1.947</td>
<td>1.2</td>
<td><tt class="docutils literal"><span class="pre">██████████████████████▍</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #2)</td>
<td>4.619</td>
<td>4.588</td>
<td>0.5</td>
<td><tt class="docutils literal"><span class="pre">█████████▌</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td>4.856</td>
<td>4.828</td>
<td>0.5</td>
<td><tt class="docutils literal"><span class="pre">█████████</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td>2.097</td>
<td>2.074</td>
<td>1.1</td>
<td><tt class="docutils literal"><span class="pre">█████████████████████</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td>2.226</td>
<td>2.200</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">███████████████████▊</span></tt></td>
</tr>
<tr><td>AVX-512 compressed lookup (variant #6)</td>
<td>1.108</td>
<td>1.090</td>
<td>2.1</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████████</span></tt></td>
</tr>
<tr><td colspan="5">dataset <em>portuguese</em></td>
</tr>
<tr><td>C++ switch</td>
<td>12.958</td>
<td>12.837</td>
<td>0.1</td>
<td><tt class="docutils literal">██▎</tt></td>
</tr>
<tr><td>scalar single lookup</td>
<td>1.412</td>
<td>1.407</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">████████████████████▉</span></tt></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>0.861</td>
<td>0.836</td>
<td>1.7</td>
<td><tt class="docutils literal"><span class="pre">███████████████████████████████████▏</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #2)</td>
<td>1.146</td>
<td>1.132</td>
<td>1.2</td>
<td><tt class="docutils literal"><span class="pre">█████████████████████████▉</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td>1.223</td>
<td>1.208</td>
<td>1.2</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████▎</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td>0.801</td>
<td>0.735</td>
<td>1.9</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████████</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td>0.851</td>
<td>0.830</td>
<td>1.7</td>
<td><tt class="docutils literal"><span class="pre">███████████████████████████████████▍</span></tt></td>
</tr>
<tr><td>AVX-512 compressed lookup (variant #6)</td>
<td>0.988</td>
<td>0.969</td>
<td>1.5</td>
<td><tt class="docutils literal"><span class="pre">██████████████████████████████▎</span></tt></td>
</tr>
<tr><td colspan="5">dataset <em>russian</em></td>
</tr>
<tr><td>C++ switch</td>
<td>12.919</td>
<td>12.721</td>
<td>0.1</td>
<td><tt class="docutils literal">█▋</tt></td>
</tr>
<tr><td>scalar single lookup</td>
<td>1.413</td>
<td>1.407</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">███████████████▍</span></tt></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>1.623</td>
<td>1.597</td>
<td>0.9</td>
<td><tt class="docutils literal"><span class="pre">█████████████▌</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #2)</td>
<td>3.890</td>
<td>3.878</td>
<td>0.4</td>
<td><tt class="docutils literal"><span class="pre">█████▌</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td>4.095</td>
<td>4.079</td>
<td>0.3</td>
<td><tt class="docutils literal"><span class="pre">█████▎</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td>1.697</td>
<td>1.674</td>
<td>0.8</td>
<td><tt class="docutils literal"><span class="pre">████████████▉</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td>1.810</td>
<td>1.787</td>
<td>0.8</td>
<td><tt class="docutils literal"><span class="pre">████████████▏</span></tt></td>
</tr>
<tr><td>AVX-512 compressed lookup (variant #6)</td>
<td>0.551</td>
<td>0.542</td>
<td>2.6</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████████</span></tt></td>
</tr>
<tr><td colspan="5">dataset <em>thai</em></td>
</tr>
<tr><td>C++ switch</td>
<td>6.950</td>
<td>6.770</td>
<td>0.2</td>
<td><tt class="docutils literal"><span class="pre">███▊</span></tt></td>
</tr>
<tr><td>scalar single lookup</td>
<td>1.411</td>
<td>1.405</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">██████████████████▎</span></tt></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>1.344</td>
<td>1.327</td>
<td>1.1</td>
<td><tt class="docutils literal"><span class="pre">███████████████████▍</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #2)</td>
<td>3.184</td>
<td>3.159</td>
<td>0.4</td>
<td><tt class="docutils literal"><span class="pre">████████▏</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td>3.338</td>
<td>3.327</td>
<td>0.4</td>
<td><tt class="docutils literal"><span class="pre">███████▋</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td>1.422</td>
<td>1.406</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">██████████████████▎</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td>1.514</td>
<td>1.499</td>
<td>0.9</td>
<td><tt class="docutils literal"><span class="pre">█████████████████▏</span></tt></td>
</tr>
<tr><td>AVX-512 compressed lookup (variant #6)</td>
<td>0.652</td>
<td>0.643</td>
<td>2.2</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████████</span></tt></td>
</tr>
<tr><td colspan="5">dataset <em>turkish</em></td>
</tr>
<tr><td>C++ switch</td>
<td>12.836</td>
<td>12.653</td>
<td>0.1</td>
<td><tt class="docutils literal">██▌</tt></td>
</tr>
<tr><td>scalar single lookup</td>
<td>1.438</td>
<td>1.432</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">██████████████████████▏</span></tt></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>1.458</td>
<td>1.348</td>
<td>1.1</td>
<td><tt class="docutils literal"><span class="pre">███████████████████████▌</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #2)</td>
<td>2.148</td>
<td>2.106</td>
<td>0.7</td>
<td><tt class="docutils literal"><span class="pre">███████████████</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td>2.257</td>
<td>2.222</td>
<td>0.6</td>
<td><tt class="docutils literal"><span class="pre">██████████████▎</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td>1.738</td>
<td>1.677</td>
<td>0.9</td>
<td><tt class="docutils literal"><span class="pre">██████████████████▉</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td>1.991</td>
<td>1.948</td>
<td>0.7</td>
<td><tt class="docutils literal"><span class="pre">████████████████▎</span></tt></td>
</tr>
<tr><td>AVX-512 compressed lookup (variant #6)</td>
<td>0.810</td>
<td>0.795</td>
<td>1.8</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████████</span></tt></td>
</tr>
<tr><td colspan="5">dataset <em>vietnamese</em></td>
</tr>
<tr><td>C++ switch</td>
<td>11.983</td>
<td>11.764</td>
<td>0.1</td>
<td><tt class="docutils literal">██</tt></td>
</tr>
<tr><td>scalar single lookup</td>
<td>1.411</td>
<td>1.405</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">█████████████████▎</span></tt></td>
</tr>
<tr><td>AVX2 single lookup</td>
<td>1.386</td>
<td>1.332</td>
<td>1.1</td>
<td><tt class="docutils literal"><span class="pre">██████████████████▏</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #2)</td>
<td>3.156</td>
<td>3.147</td>
<td>0.4</td>
<td><tt class="docutils literal"><span class="pre">███████▋</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #3)</td>
<td>3.311</td>
<td>3.301</td>
<td>0.4</td>
<td><tt class="docutils literal"><span class="pre">███████▎</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #4)</td>
<td>1.445</td>
<td>1.413</td>
<td>1.0</td>
<td><tt class="docutils literal"><span class="pre">█████████████████▏</span></tt></td>
</tr>
<tr><td>AVX2 compressed lookup (variant #5)</td>
<td>1.562</td>
<td>1.521</td>
<td>0.9</td>
<td><tt class="docutils literal"><span class="pre">███████████████▉</span></tt></td>
</tr>
<tr><td>AVX-512 compressed lookup (variant #6)</td>
<td>0.616</td>
<td>0.607</td>
<td>2.3</td>
<td><tt class="docutils literal"><span class="pre">████████████████████████████████████████</span></tt></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="conclusions">
<h1>Conclusions</h1>
<ul class="simple">
<li>Changing case is not easy to vectorized. SIMD code requires also
memory gather instructions, which is not widespread.</li>
<li>On Ryzen 7 (AVX2 code) only <a class="reference internal" href="#compressed-v4">variant 4</a> is fast, but it brings
significantly bigger lookup tables (320kB, instead of ~30kB from
the best case).</li>
<li>On IceLake (AVX-512 code) the <a class="reference internal" href="#compressed-v6">variant 6</a> is really fast, but
also requires bigger tables (~130kB).</li>
<li>We are fully aware that benchmarks hide cost of memory misses, as
the same conversion is repeated many times. This is why the sizes
of lookups are always given, because this may be an important
factor in real-world applications.</li>
<li>What about UTF-8 inputs? At Sneller we internally used UTF-8,
and there was always conversion to UTF-32 code when we had to
deal with individual characters. However, it not impossible that
for UTF-8 we might have nice solution, especially in scalar code
(precomputed <a class="reference external" href="http://en.wikipedia.org/wiki/Trie">tries</a>, for instance).</li>
</ul>
</div>
<div class="section" id="source-code">
<h1>Source code</h1>
<p>Sample implementation is available at <a class="reference external" href="https://github.com/WojciechMula/toys/tree/master/utf32-change-case">GitHub</a>.</p>
</div>
<div class="section" id="appendixes">
<h1>Appendixes</h1>
<div class="section" id="a-codepoints-of-letters-having-different-cases">
<span id="appendix-a"></span><h2>A &mdash; Codepoints of letters having different cases</h2>
<table border="1" class="col2right col4right docutils">
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">codepoinst with <strong>uppercase</strong> variants</th>
<th class="head">count in set/range</th>
<th class="head">codepoinst with <strong>lowercase</strong> variants</th>
<th class="head">count in set/range</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>[<tt class="docutils literal">0x41</tt> ... <tt class="docutils literal">0x5a</tt>]</td>
<td>26</td>
<td>[<tt class="docutils literal">0x61</tt> ... <tt class="docutils literal">0x7a</tt>]</td>
<td>26</td>
</tr>
<tr><td>[<tt class="docutils literal">0xc0</tt> ... <tt class="docutils literal">0xd6</tt>]</td>
<td>23</td>
<td><tt class="docutils literal">0xb5</tt></td>
<td>1</td>
</tr>
<tr><td>[<tt class="docutils literal">0xd8</tt> ... <tt class="docutils literal">0xde</tt>]</td>
<td>7</td>
<td>[<tt class="docutils literal">0xf8</tt> ... <tt class="docutils literal">0xff</tt>]</td>
<td>8</td>
</tr>
<tr><td>{<tt class="docutils literal">0x100</tt>, <tt class="docutils literal">0x102</tt>, <tt class="docutils literal">0x104</tt>, <tt class="docutils literal">0x106</tt>, <tt class="docutils literal">0x108</tt>, <tt class="docutils literal">0x10a</tt>, <tt class="docutils literal">0x10c</tt>, <tt class="docutils literal">0x10e</tt>, <tt class="docutils literal">0x110</tt>, <tt class="docutils literal">0x112</tt>, <tt class="docutils literal">0x114</tt>, <tt class="docutils literal">0x116</tt>, <tt class="docutils literal">0x118</tt>, <tt class="docutils literal">0x11a</tt>, <tt class="docutils literal">0x11c</tt>, <tt class="docutils literal">0x11e</tt>, <tt class="docutils literal">0x120</tt>, <tt class="docutils literal">0x122</tt>, <tt class="docutils literal">0x124</tt>, <tt class="docutils literal">0x126</tt>, <tt class="docutils literal">0x128</tt>, <tt class="docutils literal">0x12a</tt>, <tt class="docutils literal">0x12c</tt>, <tt class="docutils literal">0x12e</tt>, <tt class="docutils literal">0x130</tt>, <tt class="docutils literal">0x132</tt>, <tt class="docutils literal">0x134</tt>, <tt class="docutils literal">0x136</tt>, <tt class="docutils literal">0x139</tt>, <tt class="docutils literal">0x13b</tt>, <tt class="docutils literal">0x13d</tt>, <tt class="docutils literal">0x13f</tt>, <tt class="docutils literal">0x141</tt>, <tt class="docutils literal">0x143</tt>, <tt class="docutils literal">0x145</tt>, <tt class="docutils literal">0x147</tt>, <tt class="docutils literal">0x14a</tt>, <tt class="docutils literal">0x14c</tt>, <tt class="docutils literal">0x14e</tt>, <tt class="docutils literal">0x150</tt>, <tt class="docutils literal">0x152</tt>, <tt class="docutils literal">0x154</tt>, <tt class="docutils literal">0x156</tt>, <tt class="docutils literal">0x158</tt>, <tt class="docutils literal">0x15a</tt>, <tt class="docutils literal">0x15c</tt>, <tt class="docutils literal">0x15e</tt>, <tt class="docutils literal">0x160</tt>, <tt class="docutils literal">0x162</tt>, <tt class="docutils literal">0x164</tt>, <tt class="docutils literal">0x166</tt>, <tt class="docutils literal">0x168</tt>, <tt class="docutils literal">0x16a</tt>, <tt class="docutils literal">0x16c</tt>, <tt class="docutils literal">0x16e</tt>, <tt class="docutils literal">0x170</tt>, <tt class="docutils literal">0x172</tt>, <tt class="docutils literal">0x174</tt>, <tt class="docutils literal">0x176</tt>}</td>
<td>59</td>
<td>{<tt class="docutils literal">0x101</tt>, <tt class="docutils literal">0x103</tt>, <tt class="docutils literal">0x105</tt>, <tt class="docutils literal">0x107</tt>, <tt class="docutils literal">0x109</tt>, <tt class="docutils literal">0x10b</tt>, <tt class="docutils literal">0x10d</tt>, <tt class="docutils literal">0x10f</tt>, <tt class="docutils literal">0x111</tt>, <tt class="docutils literal">0x113</tt>, <tt class="docutils literal">0x115</tt>, <tt class="docutils literal">0x117</tt>, <tt class="docutils literal">0x119</tt>, <tt class="docutils literal">0x11b</tt>, <tt class="docutils literal">0x11d</tt>, <tt class="docutils literal">0x11f</tt>, <tt class="docutils literal">0x121</tt>, <tt class="docutils literal">0x123</tt>, <tt class="docutils literal">0x125</tt>, <tt class="docutils literal">0x127</tt>, <tt class="docutils literal">0x129</tt>, <tt class="docutils literal">0x12b</tt>, <tt class="docutils literal">0x12d</tt>, <tt class="docutils literal">0x12f</tt>, <tt class="docutils literal">0x131</tt>, <tt class="docutils literal">0x133</tt>, <tt class="docutils literal">0x135</tt>, <tt class="docutils literal">0x137</tt>, <tt class="docutils literal">0x13a</tt>, <tt class="docutils literal">0x13c</tt>, <tt class="docutils literal">0x13e</tt>, <tt class="docutils literal">0x140</tt>, <tt class="docutils literal">0x142</tt>, <tt class="docutils literal">0x144</tt>, <tt class="docutils literal">0x146</tt>}</td>
<td>35</td>
</tr>
<tr><td>{<tt class="docutils literal">0x17b</tt>, <tt class="docutils literal">0x17d</tt>}</td>
<td>2</td>
<td>{<tt class="docutils literal">0x14b</tt>, <tt class="docutils literal">0x14d</tt>, <tt class="docutils literal">0x14f</tt>, <tt class="docutils literal">0x151</tt>, <tt class="docutils literal">0x153</tt>, <tt class="docutils literal">0x155</tt>, <tt class="docutils literal">0x157</tt>, <tt class="docutils literal">0x159</tt>, <tt class="docutils literal">0x15b</tt>, <tt class="docutils literal">0x15d</tt>, <tt class="docutils literal">0x15f</tt>, <tt class="docutils literal">0x161</tt>, <tt class="docutils literal">0x163</tt>, <tt class="docutils literal">0x165</tt>, <tt class="docutils literal">0x167</tt>, <tt class="docutils literal">0x169</tt>, <tt class="docutils literal">0x16b</tt>, <tt class="docutils literal">0x16d</tt>, <tt class="docutils literal">0x16f</tt>, <tt class="docutils literal">0x171</tt>, <tt class="docutils literal">0x173</tt>, <tt class="docutils literal">0x175</tt>, <tt class="docutils literal">0x177</tt>, <tt class="docutils literal">0x17a</tt>, <tt class="docutils literal">0x17c</tt>}</td>
<td>25</td>
</tr>
<tr><td><tt class="docutils literal">0x184</tt></td>
<td>1</td>
<td>{<tt class="docutils literal">0x183</tt>, <tt class="docutils literal">0x185</tt>, <tt class="docutils literal">0x188</tt>, <tt class="docutils literal">0x18c</tt>, <tt class="docutils literal">0x192</tt>, <tt class="docutils literal">0x195</tt>}</td>
<td>6</td>
</tr>
<tr><td>[<tt class="docutils literal">0x189</tt> ... <tt class="docutils literal">0x18b</tt>]</td>
<td>3</td>
<td>{<tt class="docutils literal">0x1a1</tt>, <tt class="docutils literal">0x1a3</tt>, <tt class="docutils literal">0x1a5</tt>, <tt class="docutils literal">0x1a8</tt>, <tt class="docutils literal">0x1ad</tt>, <tt class="docutils literal">0x1b0</tt>, <tt class="docutils literal">0x1b4</tt>, <tt class="docutils literal">0x1b6</tt>, <tt class="docutils literal">0x1b9</tt>, <tt class="docutils literal">0x1bd</tt>, <tt class="docutils literal">0x19e</tt>, <tt class="docutils literal">0x1bf</tt>}</td>
<td>12</td>
</tr>
<tr><td>[<tt class="docutils literal">0x18e</tt> ... <tt class="docutils literal">0x191</tt>]</td>
<td>4</td>
<td>[<tt class="docutils literal">0x1c8</tt> ... <tt class="docutils literal">0x1c9</tt>]</td>
<td>2</td>
</tr>
<tr><td>[<tt class="docutils literal">0x193</tt> ... <tt class="docutils literal">0x194</tt>]</td>
<td>2</td>
<td>[<tt class="docutils literal">0x1cb</tt> ... <tt class="docutils literal">0x1cc</tt>]</td>
<td>2</td>
</tr>
<tr><td>[<tt class="docutils literal">0x196</tt> ... <tt class="docutils literal">0x198</tt>]</td>
<td>3</td>
<td>{<tt class="docutils literal">0x1ce</tt>, <tt class="docutils literal">0x1d0</tt>, <tt class="docutils literal">0x1d2</tt>, <tt class="docutils literal">0x1d4</tt>, <tt class="docutils literal">0x1d6</tt>, <tt class="docutils literal">0x1d8</tt>, <tt class="docutils literal">0x1da</tt>}</td>
<td>7</td>
</tr>
<tr><td>[<tt class="docutils literal">0x19c</tt> ... <tt class="docutils literal">0x19d</tt>]</td>
<td>2</td>
<td>{<tt class="docutils literal">0x1e1</tt>, <tt class="docutils literal">0x1e3</tt>, <tt class="docutils literal">0x1e5</tt>, <tt class="docutils literal">0x1e7</tt>, <tt class="docutils literal">0x1e9</tt>, <tt class="docutils literal">0x1eb</tt>, <tt class="docutils literal">0x1ed</tt>, <tt class="docutils literal">0x1df</tt>}</td>
<td>8</td>
</tr>
<tr><td>[<tt class="docutils literal">0x19f</tt> ... <tt class="docutils literal">0x1a0</tt>]</td>
<td>2</td>
<td>[<tt class="docutils literal">0x1f2</tt> ... <tt class="docutils literal">0x1f3</tt>]</td>
<td>2</td>
</tr>
<tr><td>{<tt class="docutils literal">0x1a2</tt>, <tt class="docutils literal">0x1a4</tt>}</td>
<td>2</td>
<td>{<tt class="docutils literal">0x201</tt>, <tt class="docutils literal">0x203</tt>, <tt class="docutils literal">0x205</tt>, <tt class="docutils literal">0x207</tt>, <tt class="docutils literal">0x209</tt>, <tt class="docutils literal">0x20b</tt>, <tt class="docutils literal">0x20d</tt>, <tt class="docutils literal">0x20f</tt>, <tt class="docutils literal">0x211</tt>, <tt class="docutils literal">0x213</tt>, <tt class="docutils literal">0x215</tt>, <tt class="docutils literal">0x217</tt>, <tt class="docutils literal">0x219</tt>, <tt class="docutils literal">0x21b</tt>, <tt class="docutils literal">0x21d</tt>, <tt class="docutils literal">0x21f</tt>, <tt class="docutils literal">0x223</tt>, <tt class="docutils literal">0x225</tt>, <tt class="docutils literal">0x227</tt>, <tt class="docutils literal">0x229</tt>, <tt class="docutils literal">0x22b</tt>, <tt class="docutils literal">0x22d</tt>, <tt class="docutils literal">0x22f</tt>, <tt class="docutils literal">0x231</tt>, <tt class="docutils literal">0x233</tt>, <tt class="docutils literal">0x23c</tt>, <tt class="docutils literal">0x1f5</tt>, <tt class="docutils literal">0x1f9</tt>, <tt class="docutils literal">0x1fb</tt>, <tt class="docutils literal">0x1fd</tt>, <tt class="docutils literal">0x1ff</tt>}</td>
<td>31</td>
</tr>
<tr><td>{<tt class="docutils literal">0x1a9</tt>, <tt class="docutils literal">0x1ac</tt>}</td>
<td>2</td>
<td>{<tt class="docutils literal">0x242</tt>, <tt class="docutils literal">0x247</tt>, <tt class="docutils literal">0x249</tt>, <tt class="docutils literal">0x24b</tt>, <tt class="docutils literal">0x24d</tt>}</td>
<td>5</td>
</tr>
<tr><td>[<tt class="docutils literal">0x1b1</tt> ... <tt class="docutils literal">0x1b3</tt>]</td>
<td>3</td>
<td>[<tt class="docutils literal">0x256</tt> ... <tt class="docutils literal">0x257</tt>]</td>
<td>2</td>
</tr>
<tr><td><tt class="docutils literal">0x1b5</tt></td>
<td>1</td>
<td><tt class="docutils literal">0x259</tt></td>
<td>1</td>
</tr>
<tr><td><tt class="docutils literal">0x1bc</tt></td>
<td>1</td>
<td>[<tt class="docutils literal">0x260</tt> ... <tt class="docutils literal">0x261</tt>]</td>
<td>2</td>
</tr>
<tr><td>[<tt class="docutils literal">0x1c7</tt> ... <tt class="docutils literal">0x1c8</tt>]</td>
<td>2</td>
<td><tt class="docutils literal">0x263</tt></td>
<td>1</td>
</tr>
<tr><td>[<tt class="docutils literal">0x1ca</tt> ... <tt class="docutils literal">0x1cb</tt>]</td>
<td>2</td>
<td>[<tt class="docutils literal">0x268</tt> ... <tt class="docutils literal">0x26c</tt>]</td>
<td>5</td>
</tr>
<tr><td>{<tt class="docutils literal">0x1e0</tt>, <tt class="docutils literal">0x1e2</tt>, <tt class="docutils literal">0x1e4</tt>, <tt class="docutils literal">0x1e6</tt>, <tt class="docutils literal">0x1e8</tt>, <tt class="docutils literal">0x1ea</tt>, <tt class="docutils literal">0x1ec</tt>, <tt class="docutils literal">0x1cd</tt>, <tt class="docutils literal">0x1ee</tt>, <tt class="docutils literal">0x1cf</tt>, <tt class="docutils literal">0x1d1</tt>, <tt class="docutils literal">0x1d3</tt>, <tt class="docutils literal">0x1d5</tt>, <tt class="docutils literal">0x1d7</tt>, <tt class="docutils literal">0x1d9</tt>, <tt class="docutils literal">0x1db</tt>, <tt class="docutils literal">0x1de</tt>}</td>
<td>17</td>
<td><tt class="docutils literal">0x26f</tt></td>
<td>1</td>
</tr>
<tr><td><tt class="docutils literal">0x1f4</tt></td>
<td>1</td>
<td>{<tt class="docutils literal">0x280</tt>, <tt class="docutils literal">0x27d</tt>, <tt class="docutils literal">0x275</tt>}</td>
<td>3</td>
</tr>
<tr><td>{<tt class="docutils literal">0x200</tt>, <tt class="docutils literal">0x202</tt>, <tt class="docutils literal">0x204</tt>, <tt class="docutils literal">0x206</tt>, <tt class="docutils literal">0x208</tt>, <tt class="docutils literal">0x20a</tt>, <tt class="docutils literal">0x20c</tt>, <tt class="docutils literal">0x20e</tt>, <tt class="docutils literal">0x210</tt>, <tt class="docutils literal">0x212</tt>, <tt class="docutils literal">0x214</tt>, <tt class="docutils literal">0x216</tt>, <tt class="docutils literal">0x218</tt>, <tt class="docutils literal">0x21a</tt>, <tt class="docutils literal">0x21c</tt>, <tt class="docutils literal">0x21e</tt>, <tt class="docutils literal">0x220</tt>, <tt class="docutils literal">0x222</tt>, <tt class="docutils literal">0x224</tt>, <tt class="docutils literal">0x226</tt>, <tt class="docutils literal">0x228</tt>, <tt class="docutils literal">0x22a</tt>, <tt class="docutils literal">0x22c</tt>, <tt class="docutils literal">0x22e</tt>, <tt class="docutils literal">0x230</tt>, <tt class="docutils literal">0x232</tt>, <tt class="docutils literal">0x1fa</tt>, <tt class="docutils literal">0x1fc</tt>, <tt class="docutils literal">0x1fe</tt>}</td>
<td>29</td>
<td>[<tt class="docutils literal">0x287</tt> ... <tt class="docutils literal">0x28c</tt>]</td>
<td>6</td>
</tr>
<tr><td>[<tt class="docutils literal">0x23d</tt> ... <tt class="docutils literal">0x23e</tt>]</td>
<td>2</td>
<td><tt class="docutils literal">0x292</tt></td>
<td>1</td>
</tr>
<tr><td><tt class="docutils literal">0x241</tt></td>
<td>1</td>
<td>{<tt class="docutils literal">0x371</tt>, <tt class="docutils literal">0x373</tt>, <tt class="docutils literal">0x345</tt>, <tt class="docutils literal">0x377</tt>}</td>
<td>4</td>
</tr>
<tr><td>{<tt class="docutils literal">0x386</tt>, <tt class="docutils literal">0x248</tt>, <tt class="docutils literal">0x24a</tt>, <tt class="docutils literal">0x24c</tt>, <tt class="docutils literal">0x24e</tt>, <tt class="docutils literal">0x370</tt>, <tt class="docutils literal">0x372</tt>, <tt class="docutils literal">0x376</tt>, <tt class="docutils literal">0x37f</tt>}</td>
<td>9</td>
<td><tt class="docutils literal">0x390</tt></td>
<td>1</td>
</tr>
<tr><td><tt class="docutils literal">0x38c</tt></td>
<td>1</td>
<td>[<tt class="docutils literal">0x3d0</tt> ... <tt class="docutils literal">0x3d1</tt>]</td>
<td>2</td>
</tr>
<tr><td>[<tt class="docutils literal">0x391</tt> ... <tt class="docutils literal">0x3a1</tt>]</td>
<td>17</td>
<td>[<tt class="docutils literal">0x3d5</tt> ... <tt class="docutils literal">0x3d7</tt>]</td>
<td>3</td>
</tr>
<tr><td>[<tt class="docutils literal">0x3a3</tt> ... <tt class="docutils literal">0x3ab</tt>]</td>
<td>9</td>
<td>{<tt class="docutils literal">0x3e1</tt>, <tt class="docutils literal">0x3e3</tt>, <tt class="docutils literal">0x3e5</tt>, <tt class="docutils literal">0x3e7</tt>, <tt class="docutils literal">0x3e9</tt>, <tt class="docutils literal">0x3eb</tt>, <tt class="docutils literal">0x3ed</tt>, <tt class="docutils literal">0x3d9</tt>, <tt class="docutils literal">0x3db</tt>, <tt class="docutils literal">0x3dd</tt>, <tt class="docutils literal">0x3df</tt>}</td>
<td>11</td>
</tr>
<tr><td>{<tt class="docutils literal">0x3e0</tt>, <tt class="docutils literal">0x3e2</tt>, <tt class="docutils literal">0x3e4</tt>, <tt class="docutils literal">0x3e6</tt>, <tt class="docutils literal">0x3e8</tt>, <tt class="docutils literal">0x3ea</tt>, <tt class="docutils literal">0x3ec</tt>, <tt class="docutils literal">0x3ee</tt>, <tt class="docutils literal">0x3cf</tt>, <tt class="docutils literal">0x3f4</tt>, <tt class="docutils literal">0x3f7</tt>, <tt class="docutils literal">0x3d8</tt>, <tt class="docutils literal">0x3da</tt>, <tt class="docutils literal">0x3dc</tt>, <tt class="docutils literal">0x3de</tt>}</td>
<td>15</td>
<td>{<tt class="docutils literal">0x3f8</tt>, <tt class="docutils literal">0x3fb</tt>, <tt class="docutils literal">0x3f5</tt>}</td>
<td>3</td>
</tr>
<tr><td>[<tt class="docutils literal">0x3fd</tt> ... <tt class="docutils literal">0x42f</tt>]</td>
<td>51</td>
<td>{<tt class="docutils literal">0x481</tt>, <tt class="docutils literal">0x48b</tt>, <tt class="docutils literal">0x48d</tt>, <tt class="docutils literal">0x48f</tt>, <tt class="docutils literal">0x491</tt>, <tt class="docutils literal">0x493</tt>, <tt class="docutils literal">0x495</tt>, <tt class="docutils literal">0x497</tt>, <tt class="docutils literal">0x499</tt>, <tt class="docutils literal">0x49b</tt>, <tt class="docutils literal">0x49d</tt>, <tt class="docutils literal">0x49f</tt>, <tt class="docutils literal">0x4a1</tt>, <tt class="docutils literal">0x4a3</tt>, <tt class="docutils literal">0x4a5</tt>, <tt class="docutils literal">0x4a7</tt>, <tt class="docutils literal">0x4a9</tt>, <tt class="docutils literal">0x4ab</tt>, <tt class="docutils literal">0x4ad</tt>, <tt class="docutils literal">0x4af</tt>, <tt class="docutils literal">0x4b1</tt>, <tt class="docutils literal">0x4b3</tt>, <tt class="docutils literal">0x4b5</tt>, <tt class="docutils literal">0x4b7</tt>, <tt class="docutils literal">0x4b9</tt>, <tt class="docutils literal">0x4bb</tt>, <tt class="docutils literal">0x4bd</tt>, <tt class="docutils literal">0x4bf</tt>, <tt class="docutils literal">0x4c2</tt>, <tt class="docutils literal">0x4c4</tt>, <tt class="docutils literal">0x4c6</tt>, <tt class="docutils literal">0x4c8</tt>, <tt class="docutils literal">0x4ca</tt>, <tt class="docutils literal">0x4cc</tt>, <tt class="docutils literal">0x461</tt>, <tt class="docutils literal">0x463</tt>, <tt class="docutils literal">0x465</tt>, <tt class="docutils literal">0x467</tt>, <tt class="docutils literal">0x469</tt>, <tt class="docutils literal">0x46b</tt>, <tt class="docutils literal">0x46d</tt>, <tt class="docutils literal">0x46f</tt>, <tt class="docutils literal">0x471</tt>, <tt class="docutils literal">0x473</tt>, <tt class="docutils literal">0x475</tt>, <tt class="docutils literal">0x477</tt>, <tt class="docutils literal">0x479</tt>, <tt class="docutils literal">0x47b</tt>, <tt class="docutils literal">0x47d</tt>, <tt class="docutils literal">0x47f</tt>}</td>
<td>50</td>
</tr>
<tr><td>{<tt class="docutils literal">0x480</tt>, <tt class="docutils literal">0x48a</tt>, <tt class="docutils literal">0x48c</tt>, <tt class="docutils literal">0x48e</tt>, <tt class="docutils literal">0x490</tt>, <tt class="docutils literal">0x492</tt>, <tt class="docutils literal">0x494</tt>, <tt class="docutils literal">0x496</tt>, <tt class="docutils literal">0x498</tt>, <tt class="docutils literal">0x49a</tt>, <tt class="docutils literal">0x49c</tt>, <tt class="docutils literal">0x49e</tt>, <tt class="docutils literal">0x4a0</tt>, <tt class="docutils literal">0x4a2</tt>, <tt class="docutils literal">0x4a4</tt>, <tt class="docutils literal">0x4a6</tt>, <tt class="docutils literal">0x4a8</tt>, <tt class="docutils literal">0x4aa</tt>, <tt class="docutils literal">0x4ac</tt>, <tt class="docutils literal">0x4ae</tt>, <tt class="docutils literal">0x4b0</tt>, <tt class="docutils literal">0x4b2</tt>, <tt class="docutils literal">0x4b4</tt>, <tt class="docutils literal">0x4b6</tt>, <tt class="docutils literal">0x4b8</tt>, <tt class="docutils literal">0x4ba</tt>, <tt class="docutils literal">0x4bc</tt>, <tt class="docutils literal">0x4be</tt>, <tt class="docutils literal">0x460</tt>, <tt class="docutils literal">0x462</tt>, <tt class="docutils literal">0x464</tt>, <tt class="docutils literal">0x466</tt>, <tt class="docutils literal">0x468</tt>, <tt class="docutils literal">0x46a</tt>, <tt class="docutils literal">0x46c</tt>, <tt class="docutils literal">0x46e</tt>, <tt class="docutils literal">0x470</tt>, <tt class="docutils literal">0x472</tt>, <tt class="docutils literal">0x474</tt>, <tt class="docutils literal">0x476</tt>, <tt class="docutils literal">0x478</tt>, <tt class="docutils literal">0x47a</tt>, <tt class="docutils literal">0x47c</tt>, <tt class="docutils literal">0x47e</tt>}</td>
<td>44</td>
<td>{<tt class="docutils literal">0x501</tt>, <tt class="docutils literal">0x503</tt>, <tt class="docutils literal">0x505</tt>, <tt class="docutils literal">0x507</tt>, <tt class="docutils literal">0x509</tt>, <tt class="docutils literal">0x50b</tt>, <tt class="docutils literal">0x50d</tt>, <tt class="docutils literal">0x50f</tt>, <tt class="docutils literal">0x511</tt>, <tt class="docutils literal">0x513</tt>, <tt class="docutils literal">0x515</tt>, <tt class="docutils literal">0x517</tt>, <tt class="docutils literal">0x519</tt>, <tt class="docutils literal">0x51b</tt>, <tt class="docutils literal">0x51d</tt>, <tt class="docutils literal">0x51f</tt>, <tt class="docutils literal">0x521</tt>, <tt class="docutils literal">0x523</tt>, <tt class="docutils literal">0x525</tt>, <tt class="docutils literal">0x527</tt>, <tt class="docutils literal">0x529</tt>, <tt class="docutils literal">0x52b</tt>, <tt class="docutils literal">0x52d</tt>, <tt class="docutils literal">0x52f</tt>, <tt class="docutils literal">0x4d1</tt>, <tt class="docutils literal">0x4d3</tt>, <tt class="docutils literal">0x4d5</tt>, <tt class="docutils literal">0x4d7</tt>, <tt class="docutils literal">0x4d9</tt>, <tt class="docutils literal">0x4db</tt>, <tt class="docutils literal">0x4dd</tt>, <tt class="docutils literal">0x4df</tt>, <tt class="docutils literal">0x4e1</tt>, <tt class="docutils literal">0x4e3</tt>, <tt class="docutils literal">0x4e5</tt>, <tt class="docutils literal">0x4e7</tt>, <tt class="docutils literal">0x4e9</tt>, <tt class="docutils literal">0x4eb</tt>, <tt class="docutils literal">0x4ed</tt>, <tt class="docutils literal">0x4ef</tt>, <tt class="docutils literal">0x4f1</tt>, <tt class="docutils literal">0x4f3</tt>, <tt class="docutils literal">0x4f5</tt>, <tt class="docutils literal">0x4f7</tt>, <tt class="docutils literal">0x4f9</tt>, <tt class="docutils literal">0x4fb</tt>, <tt class="docutils literal">0x4fd</tt>, <tt class="docutils literal">0x4ff</tt>}</td>
<td>48</td>
</tr>
<tr><td>{<tt class="docutils literal">0x500</tt>, <tt class="docutils literal">0x502</tt>, <tt class="docutils literal">0x504</tt>, <tt class="docutils literal">0x506</tt>, <tt class="docutils literal">0x508</tt>, <tt class="docutils literal">0x50a</tt>, <tt class="docutils literal">0x50c</tt>, <tt class="docutils literal">0x50e</tt>, <tt class="docutils literal">0x510</tt>, <tt class="docutils literal">0x512</tt>, <tt class="docutils literal">0x514</tt>, <tt class="docutils literal">0x516</tt>, <tt class="docutils literal">0x518</tt>, <tt class="docutils literal">0x51a</tt>, <tt class="docutils literal">0x51c</tt>, <tt class="docutils literal">0x51e</tt>, <tt class="docutils literal">0x520</tt>, <tt class="docutils literal">0x522</tt>, <tt class="docutils literal">0x524</tt>, <tt class="docutils literal">0x526</tt>, <tt class="docutils literal">0x528</tt>, <tt class="docutils literal">0x52a</tt>, <tt class="docutils literal">0x52c</tt>, <tt class="docutils literal">0x52e</tt>, <tt class="docutils literal">0x4c3</tt>, <tt class="docutils literal">0x4c5</tt>, <tt class="docutils literal">0x4c7</tt>, <tt class="docutils literal">0x4c9</tt>, <tt class="docutils literal">0x4cb</tt>, <tt class="docutils literal">0x4cd</tt>, <tt class="docutils literal">0x4d0</tt>, <tt class="docutils literal">0x4d2</tt>, <tt class="docutils literal">0x4d4</tt>, <tt class="docutils literal">0x4d6</tt>, <tt class="docutils literal">0x4d8</tt>, <tt class="docutils literal">0x4da</tt>, <tt class="docutils literal">0x4dc</tt>, <tt class="docutils literal">0x4de</tt>, <tt class="docutils literal">0x4e0</tt>, <tt class="docutils literal">0x4e2</tt>, <tt class="docutils literal">0x4e4</tt>, <tt class="docutils literal">0x4e6</tt>, <tt class="docutils literal">0x4e8</tt>, <tt class="docutils literal">0x4ea</tt>, <tt class="docutils literal">0x4ec</tt>, <tt class="docutils literal">0x4ee</tt>, <tt class="docutils literal">0x4f0</tt>, <tt class="docutils literal">0x4f2</tt>, <tt class="docutils literal">0x4f4</tt>, <tt class="docutils literal">0x4f6</tt>, <tt class="docutils literal">0x4f8</tt>, <tt class="docutils literal">0x4fa</tt>, <tt class="docutils literal">0x4fc</tt>, <tt class="docutils literal">0x4fe</tt>}</td>
<td>54</td>
<td>[<tt class="docutils literal">0x10d0</tt> ... <tt class="docutils literal">0x10fa</tt>]</td>
<td>43</td>
</tr>
<tr><td>[<tt class="docutils literal">0x10a0</tt> ... <tt class="docutils literal">0x10c5</tt>]</td>
<td>38</td>
<td>[<tt class="docutils literal">0x10fd</tt> ... <tt class="docutils literal">0x10ff</tt>]</td>
<td>3</td>
</tr>
<tr><td>{<tt class="docutils literal">0x10cd</tt>, <tt class="docutils literal">0x10c7</tt>}</td>
<td>2</td>
<td>[<tt class="docutils literal">0x13f8</tt> ... <tt class="docutils literal">0x13fd</tt>]</td>
<td>6</td>
</tr>
<tr><td>[<tt class="docutils literal">0x1c90</tt> ... <tt class="docutils literal">0x1cba</tt>]</td>
<td>43</td>
<td>[<tt class="docutils literal">0x1c80</tt> ... <tt class="docutils literal">0x1c88</tt>]</td>
<td>9</td>
</tr>
<tr><td>[<tt class="docutils literal">0x1cbd</tt> ... <tt class="docutils literal">0x1cbf</tt>]</td>
<td>3</td>
<td>{<tt class="docutils literal">0x1e01</tt>, <tt class="docutils literal">0x1e03</tt>, <tt class="docutils literal">0x1e05</tt>, <tt class="docutils literal">0x1e07</tt>, <tt class="docutils literal">0x1e09</tt>, <tt class="docutils literal">0x1e0b</tt>, <tt class="docutils literal">0x1e0d</tt>, <tt class="docutils literal">0x1e0f</tt>, <tt class="docutils literal">0x1e11</tt>, <tt class="docutils literal">0x1e13</tt>, <tt class="docutils literal">0x1e15</tt>, <tt class="docutils literal">0x1e17</tt>, <tt class="docutils literal">0x1e19</tt>, <tt class="docutils literal">0x1e1b</tt>, <tt class="docutils literal">0x1e1d</tt>, <tt class="docutils literal">0x1e1f</tt>, <tt class="docutils literal">0x1e21</tt>, <tt class="docutils literal">0x1e23</tt>, <tt class="docutils literal">0x1e25</tt>, <tt class="docutils literal">0x1e27</tt>, <tt class="docutils literal">0x1e29</tt>, <tt class="docutils literal">0x1e2b</tt>, <tt class="docutils literal">0x1e2d</tt>, <tt class="docutils literal">0x1e2f</tt>, <tt class="docutils literal">0x1e31</tt>, <tt class="docutils literal">0x1e33</tt>, <tt class="docutils literal">0x1e35</tt>, <tt class="docutils literal">0x1e37</tt>, <tt class="docutils literal">0x1e39</tt>, <tt class="docutils literal">0x1e3b</tt>, <tt class="docutils literal">0x1e3d</tt>, <tt class="docutils literal">0x1e3f</tt>, <tt class="docutils literal">0x1e41</tt>, <tt class="docutils literal">0x1e43</tt>, <tt class="docutils literal">0x1e45</tt>, <tt class="docutils literal">0x1e47</tt>, <tt class="docutils literal">0x1e49</tt>, <tt class="docutils literal">0x1e4b</tt>, <tt class="docutils literal">0x1e4d</tt>, <tt class="docutils literal">0x1e4f</tt>, <tt class="docutils literal">0x1e51</tt>, <tt class="docutils literal">0x1e53</tt>, <tt class="docutils literal">0x1e55</tt>, <tt class="docutils literal">0x1e57</tt>, <tt class="docutils literal">0x1e59</tt>, <tt class="docutils literal">0x1e5b</tt>, <tt class="docutils literal">0x1e5d</tt>, <tt class="docutils literal">0x1e5f</tt>, <tt class="docutils literal">0x1e61</tt>, <tt class="docutils literal">0x1e63</tt>, <tt class="docutils literal">0x1e65</tt>, <tt class="docutils literal">0x1e67</tt>, <tt class="docutils literal">0x1e69</tt>, <tt class="docutils literal">0x1e6b</tt>, <tt class="docutils literal">0x1e6d</tt>, <tt class="docutils literal">0x1e6f</tt>, <tt class="docutils literal">0x1e71</tt>, <tt class="docutils literal">0x1e73</tt>, <tt class="docutils literal">0x1e75</tt>, <tt class="docutils literal">0x1e77</tt>, <tt class="docutils literal">0x1e79</tt>, <tt class="docutils literal">0x1e7b</tt>, <tt class="docutils literal">0x1e7d</tt>, <tt class="docutils literal">0x1e7f</tt>, <tt class="docutils literal">0x1e81</tt>, <tt class="docutils literal">0x1e83</tt>, <tt class="docutils literal">0x1e85</tt>, <tt class="docutils literal">0x1e87</tt>, <tt class="docutils literal">0x1e89</tt>, <tt class="docutils literal">0x1e8b</tt>, <tt class="docutils literal">0x1e8d</tt>, <tt class="docutils literal">0x1e8f</tt>, <tt class="docutils literal">0x1e91</tt>, <tt class="docutils literal">0x1e93</tt>, <tt class="docutils literal">0x1d79</tt>, <tt class="docutils literal">0x1d7d</tt>, <tt class="docutils literal">0x1d8e</tt>}</td>
<td>77</td>
</tr>
<tr><td>{<tt class="docutils literal">0x1e00</tt>, <tt class="docutils literal">0x1e02</tt>, <tt class="docutils literal">0x1e04</tt>, <tt class="docutils literal">0x1e06</tt>, <tt class="docutils literal">0x1e08</tt>, <tt class="docutils literal">0x1e0a</tt>, <tt class="docutils literal">0x1e0c</tt>, <tt class="docutils literal">0x1e0e</tt>, <tt class="docutils literal">0x1e10</tt>, <tt class="docutils literal">0x1e12</tt>, <tt class="docutils literal">0x1e14</tt>, <tt class="docutils literal">0x1e16</tt>, <tt class="docutils literal">0x1e18</tt>, <tt class="docutils literal">0x1e1a</tt>, <tt class="docutils literal">0x1e1c</tt>, <tt class="docutils literal">0x1e1e</tt>, <tt class="docutils literal">0x1e20</tt>, <tt class="docutils literal">0x1e22</tt>, <tt class="docutils literal">0x1e24</tt>, <tt class="docutils literal">0x1e26</tt>, <tt class="docutils literal">0x1e28</tt>, <tt class="docutils literal">0x1e2a</tt>, <tt class="docutils literal">0x1e2c</tt>, <tt class="docutils literal">0x1e2e</tt>, <tt class="docutils literal">0x1e30</tt>, <tt class="docutils literal">0x1e32</tt>, <tt class="docutils literal">0x1e34</tt>, <tt class="docutils literal">0x1e36</tt>, <tt class="docutils literal">0x1e38</tt>, <tt class="docutils literal">0x1e3a</tt>, <tt class="docutils literal">0x1e3c</tt>, <tt class="docutils literal">0x1e3e</tt>, <tt class="docutils literal">0x1e40</tt>, <tt class="docutils literal">0x1e42</tt>, <tt class="docutils literal">0x1e44</tt>, <tt class="docutils literal">0x1e46</tt>, <tt class="docutils literal">0x1e48</tt>, <tt class="docutils literal">0x1e4a</tt>, <tt class="docutils literal">0x1e4c</tt>, <tt class="docutils literal">0x1e4e</tt>, <tt class="docutils literal">0x1e50</tt>, <tt class="docutils literal">0x1e52</tt>, <tt class="docutils literal">0x1e54</tt>, <tt class="docutils literal">0x1e56</tt>, <tt class="docutils literal">0x1e58</tt>, <tt class="docutils literal">0x1e5a</tt>, <tt class="docutils literal">0x1e5c</tt>, <tt class="docutils literal">0x1e5e</tt>, <tt class="docutils literal">0x1e60</tt>, <tt class="docutils literal">0x1e62</tt>, <tt class="docutils literal">0x1e64</tt>, <tt class="docutils literal">0x1e66</tt>, <tt class="docutils literal">0x1e68</tt>, <tt class="docutils literal">0x1e6a</tt>, <tt class="docutils literal">0x1e6c</tt>, <tt class="docutils literal">0x1e6e</tt>, <tt class="docutils literal">0x1e70</tt>, <tt class="docutils literal">0x1e72</tt>, <tt class="docutils literal">0x1e74</tt>, <tt class="docutils literal">0x1e76</tt>, <tt class="docutils literal">0x1e78</tt>, <tt class="docutils literal">0x1e7a</tt>, <tt class="docutils literal">0x1e7c</tt>, <tt class="docutils literal">0x1e7e</tt>, <tt class="docutils literal">0x1e80</tt>, <tt class="docutils literal">0x1e82</tt>, <tt class="docutils literal">0x1e84</tt>, <tt class="docutils literal">0x1e86</tt>, <tt class="docutils literal">0x1e88</tt>, <tt class="docutils literal">0x1e8a</tt>, <tt class="docutils literal">0x1e8c</tt>, <tt class="docutils literal">0x1e8e</tt>, <tt class="docutils literal">0x1e90</tt>, <tt class="docutils literal">0x1e92</tt>, <tt class="docutils literal">0x1e94</tt>, <tt class="docutils literal">0x1e9e</tt>, <tt class="docutils literal">0x1ea0</tt>, <tt class="docutils literal">0x1ea2</tt>, <tt class="docutils literal">0x1ea4</tt>, <tt class="docutils literal">0x1ea6</tt>, <tt class="docutils literal">0x1ea8</tt>, <tt class="docutils literal">0x1eaa</tt>, <tt class="docutils literal">0x1eac</tt>, <tt class="docutils literal">0x1eae</tt>, <tt class="docutils literal">0x1eb0</tt>, <tt class="docutils literal">0x1eb2</tt>, <tt class="docutils literal">0x1eb4</tt>, <tt class="docutils literal">0x1eb6</tt>, <tt class="docutils literal">0x1eb8</tt>, <tt class="docutils literal">0x1eba</tt>, <tt class="docutils literal">0x1ebc</tt>, <tt class="docutils literal">0x1ebe</tt>, <tt class="docutils literal">0x1ec0</tt>, <tt class="docutils literal">0x1ec2</tt>, <tt class="docutils literal">0x1ec4</tt>, <tt class="docutils literal">0x1ec6</tt>, <tt class="docutils literal">0x1ec8</tt>, <tt class="docutils literal">0x1eca</tt>, <tt class="docutils literal">0x1ecc</tt>, <tt class="docutils literal">0x1ece</tt>, <tt class="docutils literal">0x1ed0</tt>, <tt class="docutils literal">0x1ed2</tt>, <tt class="docutils literal">0x1ed4</tt>, <tt class="docutils literal">0x1ed6</tt>, <tt class="docutils literal">0x1ed8</tt>, <tt class="docutils literal">0x1eda</tt>, <tt class="docutils literal">0x1edc</tt>, <tt class="docutils literal">0x1ede</tt>, <tt class="docutils literal">0x1ee0</tt>, <tt class="docutils literal">0x1ee2</tt>, <tt class="docutils literal">0x1ee4</tt>, <tt class="docutils literal">0x1ee6</tt>, <tt class="docutils literal">0x1ee8</tt>, <tt class="docutils literal">0x1eea</tt>, <tt class="docutils literal">0x1eec</tt>, <tt class="docutils literal">0x1eee</tt>, <tt class="docutils literal">0x1ef0</tt>, <tt class="docutils literal">0x1ef2</tt>, <tt class="docutils literal">0x1ef4</tt>, <tt class="docutils literal">0x1ef6</tt>, <tt class="docutils literal">0x1ef8</tt>, <tt class="docutils literal">0x1efa</tt>, <tt class="docutils literal">0x1efc</tt>, <tt class="docutils literal">0x1efe</tt>}</td>
<td>124</td>
<td>{<tt class="docutils literal">0x1ea1</tt>, <tt class="docutils literal">0x1ea3</tt>, <tt class="docutils literal">0x1ea5</tt>, <tt class="docutils literal">0x1ea7</tt>, <tt class="docutils literal">0x1ea9</tt>, <tt class="docutils literal">0x1eab</tt>, <tt class="docutils literal">0x1ead</tt>, <tt class="docutils literal">0x1eaf</tt>, <tt class="docutils literal">0x1eb1</tt>, <tt class="docutils literal">0x1eb3</tt>, <tt class="docutils literal">0x1eb5</tt>, <tt class="docutils literal">0x1eb7</tt>, <tt class="docutils literal">0x1eb9</tt>, <tt class="docutils literal">0x1ebb</tt>, <tt class="docutils literal">0x1ebd</tt>, <tt class="docutils literal">0x1ebf</tt>, <tt class="docutils literal">0x1ec1</tt>, <tt class="docutils literal">0x1ec3</tt>, <tt class="docutils literal">0x1ec5</tt>, <tt class="docutils literal">0x1ec7</tt>, <tt class="docutils literal">0x1ec9</tt>, <tt class="docutils literal">0x1ecb</tt>, <tt class="docutils literal">0x1ecd</tt>, <tt class="docutils literal">0x1ecf</tt>, <tt class="docutils literal">0x1ed1</tt>, <tt class="docutils literal">0x1ed3</tt>, <tt class="docutils literal">0x1ed5</tt>, <tt class="docutils literal">0x1ed7</tt>, <tt class="docutils literal">0x1ed9</tt>, <tt class="docutils literal">0x1edb</tt>, <tt class="docutils literal">0x1edd</tt>, <tt class="docutils literal">0x1edf</tt>, <tt class="docutils literal">0x1ee1</tt>, <tt class="docutils literal">0x1ee3</tt>, <tt class="docutils literal">0x1ee5</tt>, <tt class="docutils literal">0x1ee7</tt>, <tt class="docutils literal">0x1ee9</tt>, <tt class="docutils literal">0x1eeb</tt>, <tt class="docutils literal">0x1eed</tt>, <tt class="docutils literal">0x1eef</tt>, <tt class="docutils literal">0x1ef1</tt>, <tt class="docutils literal">0x1ef3</tt>, <tt class="docutils literal">0x1ef5</tt>, <tt class="docutils literal">0x1ef7</tt>, <tt class="docutils literal">0x1ef9</tt>, <tt class="docutils literal">0x1efb</tt>, <tt class="docutils literal">0x1efd</tt>}</td>
<td>47</td>
</tr>
<tr><td>[<tt class="docutils literal">0x1f18</tt> ... <tt class="docutils literal">0x1f1d</tt>]</td>
<td>6</td>
<td>[<tt class="docutils literal">0x1f10</tt> ... <tt class="docutils literal">0x1f15</tt>]</td>
<td>6</td>
</tr>
<tr><td>[<tt class="docutils literal">0x1f28</tt> ... <tt class="docutils literal">0x1f2f</tt>]</td>
<td>8</td>
<td>[<tt class="docutils literal">0x1f20</tt> ... <tt class="docutils literal">0x1f27</tt>]</td>
<td>8</td>
</tr>
<tr><td>[<tt class="docutils literal">0x1f38</tt> ... <tt class="docutils literal">0x1f3f</tt>]</td>
<td>8</td>
<td>[<tt class="docutils literal">0x1f30</tt> ... <tt class="docutils literal">0x1f37</tt>]</td>
<td>8</td>
</tr>
<tr><td>[<tt class="docutils literal">0x1f48</tt> ... <tt class="docutils literal">0x1f4d</tt>]</td>
<td>6</td>
<td>[<tt class="docutils literal">0x1f40</tt> ... <tt class="docutils literal">0x1f45</tt>]</td>
<td>6</td>
</tr>
<tr><td>{<tt class="docutils literal">0x1f59</tt>, <tt class="docutils literal">0x1f5b</tt>, <tt class="docutils literal">0x1f5d</tt>, <tt class="docutils literal">0x1f5f</tt>}</td>
<td>4</td>
<td>[<tt class="docutils literal">0x1f50</tt> ... <tt class="docutils literal">0x1f57</tt>]</td>
<td>8</td>
</tr>
<tr><td>[<tt class="docutils literal">0x1f88</tt> ... <tt class="docutils literal">0x1f8f</tt>]</td>
<td>8</td>
<td>[<tt class="docutils literal">0x1f60</tt> ... <tt class="docutils literal">0x1f67</tt>]</td>
<td>8</td>
</tr>
<tr><td>[<tt class="docutils literal">0x1f98</tt> ... <tt class="docutils literal">0x1f9f</tt>]</td>
<td>8</td>
<td>[<tt class="docutils literal">0x1f70</tt> ... <tt class="docutils literal">0x1f7d</tt>]</td>
<td>14</td>
</tr>
<tr><td>[<tt class="docutils literal">0x1fa8</tt> ... <tt class="docutils literal">0x1faf</tt>]</td>
<td>8</td>
<td>[<tt class="docutils literal">0x1f80</tt> ... <tt class="docutils literal">0x1fb4</tt>]</td>
<td>53</td>
</tr>
<tr><td>[<tt class="docutils literal">0x1fb8</tt> ... <tt class="docutils literal">0x1fbc</tt>]</td>
<td>5</td>
<td>[<tt class="docutils literal">0x1fb6</tt> ... <tt class="docutils literal">0x1fb7</tt>]</td>
<td>2</td>
</tr>
<tr><td>[<tt class="docutils literal">0x1fc8</tt> ... <tt class="docutils literal">0x1fcc</tt>]</td>
<td>5</td>
<td>{<tt class="docutils literal">0x1fbc</tt>, <tt class="docutils literal">0x1fbe</tt>}</td>
<td>2</td>
</tr>
<tr><td>[<tt class="docutils literal">0x1fd8</tt> ... <tt class="docutils literal">0x1fdb</tt>]</td>
<td>4</td>
<td>[<tt class="docutils literal">0x1fc6</tt> ... <tt class="docutils literal">0x1fc7</tt>]</td>
<td>2</td>
</tr>
<tr><td>[<tt class="docutils literal">0x1fe8</tt> ... <tt class="docutils literal">0x1fec</tt>]</td>
<td>5</td>
<td><tt class="docutils literal">0x1fcc</tt></td>
<td>1</td>
</tr>
<tr><td>[<tt class="docutils literal">0x1ff8</tt> ... <tt class="docutils literal">0x1ffc</tt>]</td>
<td>5</td>
<td>[<tt class="docutils literal">0x1fd6</tt> ... <tt class="docutils literal">0x1fd7</tt>]</td>
<td>2</td>
</tr>
<tr><td><tt class="docutils literal">0x2126</tt></td>
<td>1</td>
<td>[<tt class="docutils literal">0x1fe0</tt> ... <tt class="docutils literal">0x1fe7</tt>]</td>
<td>8</td>
</tr>
<tr><td><tt class="docutils literal">0x2132</tt></td>
<td>1</td>
<td>[<tt class="docutils literal">0x1ff2</tt> ... <tt class="docutils literal">0x1ff4</tt>]</td>
<td>3</td>
</tr>
<tr><td><tt class="docutils literal">0x2183</tt></td>
<td>1</td>
<td>[<tt class="docutils literal">0x1ff6</tt> ... <tt class="docutils literal">0x1ff7</tt>]</td>
<td>2</td>
</tr>
<tr><td>[<tt class="docutils literal">0x2c00</tt> ... <tt class="docutils literal">0x2c2f</tt>]</td>
<td>48</td>
<td>{<tt class="docutils literal">0x1ffc</tt>, <tt class="docutils literal">0x214e</tt>}</td>
<td>2</td>
</tr>
<tr><td><tt class="docutils literal">0x2c60</tt></td>
<td>1</td>
<td><tt class="docutils literal">0x2184</tt></td>
<td>1</td>
</tr>
<tr><td>{<tt class="docutils literal">0x2c69</tt>, <tt class="docutils literal">0x2c6b</tt>, <tt class="docutils literal">0x2c67</tt>}</td>
<td>3</td>
<td>[<tt class="docutils literal">0x2c30</tt> ... <tt class="docutils literal">0x2c5f</tt>]</td>
<td>48</td>
</tr>
<tr><td>{<tt class="docutils literal">0x2c72</tt>, <tt class="docutils literal">0x2c75</tt>}</td>
<td>2</td>
<td><tt class="docutils literal">0x2c61</tt></td>
<td>1</td>
</tr>
<tr><td>{<tt class="docutils literal">0xa640</tt>, <tt class="docutils literal">0xa642</tt>, <tt class="docutils literal">0xa644</tt>, <tt class="docutils literal">0xa646</tt>, <tt class="docutils literal">0xa648</tt>, <tt class="docutils literal">0xa64a</tt>, <tt class="docutils literal">0xa64c</tt>, <tt class="docutils literal">0xa64e</tt>, <tt class="docutils literal">0xa650</tt>, <tt class="docutils literal">0xa652</tt>, <tt class="docutils literal">0xa654</tt>, <tt class="docutils literal">0xa656</tt>, <tt class="docutils literal">0xa658</tt>, <tt class="docutils literal">0xa65a</tt>, <tt class="docutils literal">0xa65c</tt>, <tt class="docutils literal">0xa65e</tt>, <tt class="docutils literal">0xa660</tt>, <tt class="docutils literal">0xa662</tt>, <tt class="docutils literal">0xa664</tt>, <tt class="docutils literal">0xa666</tt>, <tt class="docutils literal">0xa668</tt>, <tt class="docutils literal">0xa66a</tt>, <tt class="docutils literal">0xa66c</tt>, <tt class="docutils literal">0xa680</tt>, <tt class="docutils literal">0x2c82</tt>, <tt class="docutils literal">0xa682</tt>, <tt class="docutils literal">0x2c84</tt>, <tt class="docutils literal">0xa684</tt>, <tt class="docutils literal">0x2c86</tt>, <tt class="docutils literal">0xa686</tt>, <tt class="docutils literal">0x2c88</tt>, <tt class="docutils literal">0xa688</tt>, <tt class="docutils literal">0x2c8a</tt>, <tt class="docutils literal">0xa68a</tt>, <tt class="docutils literal">0x2c8c</tt>, <tt class="docutils literal">0xa68c</tt>, <tt class="docutils literal">0x2c8e</tt>, <tt class="docutils literal">0xa68e</tt>, <tt class="docutils literal">0x2c90</tt>, <tt class="docutils literal">0xa690</tt>, <tt class="docutils literal">0x2c92</tt>, <tt class="docutils literal">0xa692</tt>, <tt class="docutils literal">0x2c94</tt>, <tt class="docutils literal">0xa694</tt>, <tt class="docutils literal">0x2c96</tt>, <tt class="docutils literal">0xa696</tt>, <tt class="docutils literal">0x2c98</tt>, <tt class="docutils literal">0xa698</tt>, <tt class="docutils literal">0x2c9a</tt>, <tt class="docutils literal">0xa69a</tt>, <tt class="docutils literal">0x2c9c</tt>, <tt class="docutils literal">0x2c9e</tt>, <tt class="docutils literal">0x2ca0</tt>, <tt class="docutils literal">0x2ca2</tt>, <tt class="docutils literal">0x2ca4</tt>, <tt class="docutils literal">0x2ca6</tt>, <tt class="docutils literal">0x2ca8</tt>, <tt class="docutils literal">0x2caa</tt>, <tt class="docutils literal">0x2cac</tt>, <tt class="docutils literal">0x2cae</tt>, <tt class="docutils literal">0x2cb0</tt>, <tt class="docutils literal">0x2cb2</tt>, <tt class="docutils literal">0x2cb4</tt>, <tt class="docutils literal">0x2cb6</tt>, <tt class="docutils literal">0x2cb8</tt>, <tt class="docutils literal">0x2cba</tt>, <tt class="docutils literal">0x2cbc</tt>, <tt class="docutils literal">0x2cbe</tt>, <tt class="docutils literal">0x2cc0</tt>, <tt class="docutils literal">0x2cc2</tt>, <tt class="docutils literal">0x2cc4</tt>, <tt class="docutils literal">0x2cc6</tt>, <tt class="docutils literal">0x2cc8</tt>, <tt class="docutils literal">0x2cca</tt>, <tt class="docutils literal">0x2ccc</tt>, <tt class="docutils literal">0x2cce</tt>, <tt class="docutils literal">0x2cd0</tt>, <tt class="docutils literal">0x2cd2</tt>, <tt class="docutils literal">0x2cd4</tt>, <tt class="docutils literal">0x2cd6</tt>, <tt class="docutils literal">0x2cd8</tt>, <tt class="docutils literal">0x2cda</tt>, <tt class="docutils literal">0x2cdc</tt>, <tt class="docutils literal">0x2cde</tt>, <tt class="docutils literal">0x2ce0</tt>, <tt class="docutils literal">0x2ce2</tt>, <tt class="docutils literal">0x2ceb</tt>, <tt class="docutils literal">0x2ced</tt>, <tt class="docutils literal">0x2cf2</tt>, <tt class="docutils literal">0xa722</tt>, <tt class="docutils literal">0xa724</tt>, <tt class="docutils literal">0xa726</tt>, <tt class="docutils literal">0xa728</tt>, <tt class="docutils literal">0xa72a</tt>, <tt class="docutils literal">0xa72c</tt>, <tt class="docutils literal">0xa72e</tt>, <tt class="docutils literal">0xa732</tt>, <tt class="docutils literal">0xa734</tt>, <tt class="docutils literal">0xa736</tt>, <tt class="docutils literal">0xa738</tt>, <tt class="docutils literal">0xa73a</tt>, <tt class="docutils literal">0xa73c</tt>, <tt class="docutils literal">0xa73e</tt>, <tt class="docutils literal">0xa740</tt>, <tt class="docutils literal">0xa742</tt>, <tt class="docutils literal">0xa744</tt>, <tt class="docutils literal">0xa746</tt>, <tt class="docutils literal">0xa748</tt>, <tt class="docutils literal">0xa74a</tt>, <tt class="docutils literal">0xa74c</tt>, <tt class="docutils literal">0xa74e</tt>, <tt class="docutils literal">0xa750</tt>, <tt class="docutils literal">0xa752</tt>, <tt class="docutils literal">0xa754</tt>, <tt class="docutils literal">0xa756</tt>, <tt class="docutils literal">0xa758</tt>, <tt class="docutils literal">0xa75a</tt>, <tt class="docutils literal">0xa75c</tt>, <tt class="docutils literal">0xa75e</tt>, <tt class="docutils literal">0xa760</tt>, <tt class="docutils literal">0xa762</tt>, <tt class="docutils literal">0xa764</tt>, <tt class="docutils literal">0xa766</tt>, <tt class="docutils literal">0xa768</tt>, <tt class="docutils literal">0xa76a</tt>, <tt class="docutils literal">0xa76c</tt>, <tt class="docutils literal">0xa76e</tt>, <tt class="docutils literal">0xa779</tt>, <tt class="docutils literal">0xa77b</tt>}</td>
<td>129</td>
<td>{<tt class="docutils literal">0x2c81</tt>, <tt class="docutils literal">0x2c83</tt>, <tt class="docutils literal">0x2c85</tt>, <tt class="docutils literal">0x2c87</tt>, <tt class="docutils literal">0x2c89</tt>, <tt class="docutils literal">0x2c8b</tt>, <tt class="docutils literal">0x2c8d</tt>, <tt class="docutils literal">0x2c8f</tt>, <tt class="docutils literal">0x2c91</tt>, <tt class="docutils literal">0x2c93</tt>, <tt class="docutils literal">0x2c95</tt>, <tt class="docutils literal">0x2c97</tt>, <tt class="docutils literal">0x2c99</tt>, <tt class="docutils literal">0x2c9b</tt>, <tt class="docutils literal">0x2c9d</tt>, <tt class="docutils literal">0x2c9f</tt>, <tt class="docutils literal">0x2ca1</tt>, <tt class="docutils literal">0x2ca3</tt>, <tt class="docutils literal">0x2ca5</tt>, <tt class="docutils literal">0x2ca7</tt>, <tt class="docutils literal">0x2ca9</tt>, <tt class="docutils literal">0x2cab</tt>, <tt class="docutils literal">0x2cad</tt>, <tt class="docutils literal">0x2caf</tt>, <tt class="docutils literal">0x2cb1</tt>, <tt class="docutils literal">0x2cb3</tt>, <tt class="docutils literal">0x2cb5</tt>, <tt class="docutils literal">0x2cb7</tt>, <tt class="docutils literal">0x2cb9</tt>, <tt class="docutils literal">0x2cbb</tt>, <tt class="docutils literal">0x2cbd</tt>, <tt class="docutils literal">0x2cbf</tt>, <tt class="docutils literal">0x2cc1</tt>, <tt class="docutils literal">0x2cc3</tt>, <tt class="docutils literal">0x2cc5</tt>, <tt class="docutils literal">0x2cc7</tt>, <tt class="docutils literal">0x2cc9</tt>, <tt class="docutils literal">0x2ccb</tt>, <tt class="docutils literal">0x2ccd</tt>, <tt class="docutils literal">0x2ccf</tt>, <tt class="docutils literal">0x2cd1</tt>, <tt class="docutils literal">0x2cd3</tt>, <tt class="docutils literal">0x2cd5</tt>, <tt class="docutils literal">0x2cd7</tt>, <tt class="docutils literal">0x2cd9</tt>, <tt class="docutils literal">0x2cdb</tt>, <tt class="docutils literal">0x2cdd</tt>, <tt class="docutils literal">0x2cdf</tt>, <tt class="docutils literal">0x2ce1</tt>, <tt class="docutils literal">0x2ce3</tt>, <tt class="docutils literal">0x2c68</tt>, <tt class="docutils literal">0x2c6a</tt>, <tt class="docutils literal">0x2c6c</tt>, <tt class="docutils literal">0x2cec</tt>, <tt class="docutils literal">0x2cee</tt>, <tt class="docutils literal">0x2c73</tt>, <tt class="docutils literal">0x2cf3</tt>, <tt class="docutils literal">0x2c76</tt>}</td>
<td>58</td>
</tr>
<tr><td>{<tt class="docutils literal">0xa780</tt>, <tt class="docutils literal">0xa7a0</tt>, <tt class="docutils literal">0xa782</tt>, <tt class="docutils literal">0xa7a2</tt>, <tt class="docutils literal">0xa784</tt>, <tt class="docutils literal">0xa7a4</tt>, <tt class="docutils literal">0xa786</tt>, <tt class="docutils literal">0xa7a6</tt>, <tt class="docutils literal">0xa7a8</tt>, <tt class="docutils literal">0xa78b</tt>, <tt class="docutils literal">0xa78d</tt>, <tt class="docutils literal">0xa790</tt>, <tt class="docutils literal">0xa792</tt>, <tt class="docutils literal">0xa796</tt>, <tt class="docutils literal">0xa798</tt>, <tt class="docutils literal">0xa79a</tt>, <tt class="docutils literal">0xa79c</tt>, <tt class="docutils literal">0xa79e</tt>}</td>
<td>18</td>
<td>{<tt class="docutils literal">0xa641</tt>, <tt class="docutils literal">0xa643</tt>, <tt class="docutils literal">0xa645</tt>, <tt class="docutils literal">0xa647</tt>, <tt class="docutils literal">0xa649</tt>, <tt class="docutils literal">0xa64b</tt>, <tt class="docutils literal">0xa64d</tt>, <tt class="docutils literal">0xa64f</tt>, <tt class="docutils literal">0xa651</tt>, <tt class="docutils literal">0xa653</tt>, <tt class="docutils literal">0xa655</tt>, <tt class="docutils literal">0xa657</tt>, <tt class="docutils literal">0xa659</tt>, <tt class="docutils literal">0xa65b</tt>, <tt class="docutils literal">0xa65d</tt>, <tt class="docutils literal">0xa65f</tt>, <tt class="docutils literal">0xa661</tt>, <tt class="docutils literal">0xa663</tt>, <tt class="docutils literal">0xa665</tt>, <tt class="docutils literal">0xa667</tt>, <tt class="docutils literal">0xa669</tt>, <tt class="docutils literal">0xa66b</tt>, <tt class="docutils literal">0xa66d</tt>, <tt class="docutils literal">0xa681</tt>, <tt class="docutils literal">0xa683</tt>, <tt class="docutils literal">0xa685</tt>, <tt class="docutils literal">0xa687</tt>, <tt class="docutils literal">0xa689</tt>, <tt class="docutils literal">0xa68b</tt>, <tt class="docutils literal">0xa68d</tt>, <tt class="docutils literal">0xa68f</tt>, <tt class="docutils literal">0xa691</tt>, <tt class="docutils literal">0xa693</tt>, <tt class="docutils literal">0xa695</tt>, <tt class="docutils literal">0xa697</tt>, <tt class="docutils literal">0xa699</tt>, <tt class="docutils literal">0xa69b</tt>, <tt class="docutils literal">0xa723</tt>, <tt class="docutils literal">0xa725</tt>, <tt class="docutils literal">0x2d27</tt>, <tt class="docutils literal">0xa727</tt>, <tt class="docutils literal">0xa729</tt>, <tt class="docutils literal">0xa72b</tt>, <tt class="docutils literal">0x2d2d</tt>, <tt class="docutils literal">0xa72d</tt>, <tt class="docutils literal">0xa72f</tt>, <tt class="docutils literal">0xa733</tt>, <tt class="docutils literal">0xa735</tt>, <tt class="docutils literal">0xa737</tt>, <tt class="docutils literal">0xa739</tt>, <tt class="docutils literal">0xa73b</tt>, <tt class="docutils literal">0xa73d</tt>, <tt class="docutils literal">0xa73f</tt>, <tt class="docutils literal">0xa741</tt>, <tt class="docutils literal">0xa743</tt>, <tt class="docutils literal">0xa745</tt>, <tt class="docutils literal">0xa747</tt>, <tt class="docutils literal">0xa749</tt>, <tt class="docutils literal">0xa74b</tt>, <tt class="docutils literal">0xa74d</tt>, <tt class="docutils literal">0xa74f</tt>, <tt class="docutils literal">0xa751</tt>, <tt class="docutils literal">0xa753</tt>, <tt class="docutils literal">0xa755</tt>, <tt class="docutils literal">0xa757</tt>, <tt class="docutils literal">0xa759</tt>, <tt class="docutils literal">0xa75b</tt>, <tt class="docutils literal">0xa75d</tt>, <tt class="docutils literal">0xa75f</tt>, <tt class="docutils literal">0xa761</tt>, <tt class="docutils literal">0xa763</tt>, <tt class="docutils literal">0xa765</tt>, <tt class="docutils literal">0xa767</tt>, <tt class="docutils literal">0xa769</tt>, <tt class="docutils literal">0xa76b</tt>, <tt class="docutils literal">0xa76d</tt>, <tt class="docutils literal">0xa76f</tt>, <tt class="docutils literal">0xa77a</tt>, <tt class="docutils literal">0xa77c</tt>, <tt class="docutils literal">0xa77f</tt>, <tt class="docutils literal">0xa781</tt>, <tt class="docutils literal">0xa783</tt>, <tt class="docutils literal">0xa785</tt>, <tt class="docutils literal">0xa787</tt>, <tt class="docutils literal">0xa78c</tt>, <tt class="docutils literal">0xa791</tt>}</td>
<td>86</td>
</tr>
<tr><td>[<tt class="docutils literal">0xa7b0</tt> ... <tt class="docutils literal">0xa7b4</tt>]</td>
<td>5</td>
<td>{<tt class="docutils literal">0xa797</tt>, <tt class="docutils literal">0xa799</tt>, <tt class="docutils literal">0xa79b</tt>, <tt class="docutils literal">0xa79d</tt>, <tt class="docutils literal">0xa79f</tt>, <tt class="docutils literal">0xa7a1</tt>, <tt class="docutils literal">0xa7a3</tt>, <tt class="docutils literal">0xa7a5</tt>, <tt class="docutils literal">0xa7a7</tt>, <tt class="docutils literal">0xa7a9</tt>, <tt class="docutils literal">0xa7b5</tt>, <tt class="docutils literal">0xa7b7</tt>, <tt class="docutils literal">0xa7b9</tt>, <tt class="docutils literal">0xa7bb</tt>, <tt class="docutils literal">0xa7bd</tt>, <tt class="docutils literal">0xa7bf</tt>, <tt class="docutils literal">0xa7c1</tt>, <tt class="docutils literal">0xa7c3</tt>, <tt class="docutils literal">0xa7c8</tt>, <tt class="docutils literal">0xa7ca</tt>, <tt class="docutils literal">0xa7d1</tt>, <tt class="docutils literal">0xab53</tt>, <tt class="docutils literal">0xa7d7</tt>, <tt class="docutils literal">0xa7d9</tt>, <tt class="docutils literal">0xa7f6</tt>}</td>
<td>25</td>
</tr>
<tr><td>{<tt class="docutils literal">0xa7c0</tt>, <tt class="docutils literal">0xa7c2</tt>, <tt class="docutils literal">0xa7b6</tt>, <tt class="docutils literal">0xa7b8</tt>, <tt class="docutils literal">0xa7ba</tt>, <tt class="docutils literal">0xa7bc</tt>, <tt class="docutils literal">0xa7be</tt>}</td>
<td>7</td>
<td>[<tt class="docutils literal">0xfb00</tt> ... <tt class="docutils literal">0xfb06</tt>]</td>
<td>7</td>
</tr>
<tr><td>{<tt class="docutils literal">0xa7c9</tt>, <tt class="docutils literal">0xa7d0</tt>, <tt class="docutils literal">0xa7f5</tt>, <tt class="docutils literal">0xa7d6</tt>, <tt class="docutils literal">0xa7d8</tt>}</td>
<td>5</td>
<td>[<tt class="docutils literal">0xfb13</tt> ... <tt class="docutils literal">0xfb17</tt>]</td>
<td>5</td>
</tr>
<tr><td>[<tt class="docutils literal">0x10400</tt> ... <tt class="docutils literal">0x10427</tt>]</td>
<td>40</td>
<td>[<tt class="docutils literal">0xff41</tt> ... <tt class="docutils literal">0xff5a</tt>]</td>
<td>26</td>
</tr>
<tr><td>[<tt class="docutils literal">0x104b0</tt> ... <tt class="docutils literal">0x104d3</tt>]</td>
<td>36</td>
<td>[<tt class="docutils literal">0x10428</tt> ... <tt class="docutils literal">0x1044f</tt>]</td>
<td>40</td>
</tr>
<tr><td>[<tt class="docutils literal">0x10570</tt> ... <tt class="docutils literal">0x1057a</tt>]</td>
<td>11</td>
<td>[<tt class="docutils literal">0x104d8</tt> ... <tt class="docutils literal">0x104fb</tt>]</td>
<td>36</td>
</tr>
<tr><td>[<tt class="docutils literal">0x1057c</tt> ... <tt class="docutils literal">0x1058a</tt>]</td>
<td>15</td>
<td>[<tt class="docutils literal">0x10597</tt> ... <tt class="docutils literal">0x105a1</tt>]</td>
<td>11</td>
</tr>
<tr><td>[<tt class="docutils literal">0x1058c</tt> ... <tt class="docutils literal">0x10592</tt>]</td>
<td>7</td>
<td>[<tt class="docutils literal">0x105a3</tt> ... <tt class="docutils literal">0x105b1</tt>]</td>
<td>15</td>
</tr>
<tr><td>[<tt class="docutils literal">0x10594</tt> ... <tt class="docutils literal">0x10595</tt>]</td>
<td>2</td>
<td>[<tt class="docutils literal">0x105b3</tt> ... <tt class="docutils literal">0x105b9</tt>]</td>
<td>7</td>
</tr>
<tr><td>[<tt class="docutils literal">0x10c80</tt> ... <tt class="docutils literal">0x10cb2</tt>]</td>
<td>51</td>
<td>[<tt class="docutils literal">0x105bb</tt> ... <tt class="docutils literal">0x105bc</tt>]</td>
<td>2</td>
</tr>
<tr><td>[<tt class="docutils literal">0x118a0</tt> ... <tt class="docutils literal">0x118bf</tt>]</td>
<td>32</td>
<td>[<tt class="docutils literal">0x10cc0</tt> ... <tt class="docutils literal">0x10cf2</tt>]</td>
<td>51</td>
</tr>
<tr><td>[<tt class="docutils literal">0x16e40</tt> ... <tt class="docutils literal">0x16e5f</tt>]</td>
<td>32</td>
<td>[<tt class="docutils literal">0x118c0</tt> ... <tt class="docutils literal">0x118df</tt>]</td>
<td>32</td>
</tr>
<tr><td>[<tt class="docutils literal">0x1e900</tt> ... <tt class="docutils literal">0x1e921</tt>]</td>
<td>34</td>
<td>[<tt class="docutils literal">0x16e60</tt> ... <tt class="docutils literal">0x16e7f</tt>]</td>
<td>32</td>
</tr>
<tr><td>&nbsp;</td>
<td>&nbsp;</td>
<td>[<tt class="docutils literal">0x1e922</tt> ... <tt class="docutils literal">0x1e943</tt>]</td>
<td>34</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="b-lowercase-letters-placement">
<span id="appendix-b"></span><h2>B &mdash; Lowercase letters placement</h2>
<p>The picture shows which characters in range <tt class="docutils literal"><span class="pre">0..0x1ffff</span></tt> have lowercase
variants: they are marked with blue, green or red. In gray are shown characters
without lowercase variants.</p>
<p>There are 512 rows (addressed by bits [16:8]) of 256 characters (addressed by bits
[7:0] of character code).</p>
<img alt="2025-02-02-utf32-change-case/lower.png" class="align-center" src="2025-02-02-utf32-change-case/lower.png" style="width: 75%;" />
</div>
<div class="section" id="c-uppercase-letters-placement">
<span id="appendix-c"></span><h2>C &mdash; Uppercase letters placement</h2>
<p>The picture shows which characters in range <tt class="docutils literal"><span class="pre">0..0x1ffff</span></tt> have uppercase
variants: they are marked with blue, green or red. In gray are shown characters
without lowercase variants.</p>
<p>There are 512 rows (addressed by bits [16:8]) of 256 characters (addressed by bits
[7:0] of character code).</p>
<img alt="2025-02-02-utf32-change-case/lower.png" class="align-center" src="2025-02-02-utf32-change-case/lower.png" style="width: 75%;" />
</div>
<div class="section" id="d-compressed-tables-variant-1">
<span id="appendix-d"></span><h2>D &mdash; Compressed tables &mdash; variant 1</h2>
<p>The exact sizes of the 1st level lookup tables in <a class="reference internal" href="#compressed-sneller">variant #1</a>.</p>
<table border="1" class="col1right col2center col3center col4center col5right docutils">
<caption>First-level lookup metadata for uppercase</caption>
<thead valign="bottom">
<tr><th class="head">#</th>
<th class="head">9 highest bits</th>
<th class="head">minimum character code</th>
<th class="head">maximum character code</th>
<th class="head">chars in that range</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>0</td>
<td><tt class="docutils literal">0x000</tt></td>
<td><tt class="docutils literal">0x0061</tt></td>
<td><tt class="docutils literal">0x00ff</tt></td>
<td>159</td>
</tr>
<tr><td>1</td>
<td><tt class="docutils literal">0x001</tt></td>
<td><tt class="docutils literal">0x0101</tt></td>
<td><tt class="docutils literal">0x01ff</tt></td>
<td>255</td>
</tr>
<tr><td>2</td>
<td><tt class="docutils literal">0x002</tt></td>
<td><tt class="docutils literal">0x0201</tt></td>
<td><tt class="docutils literal">0x029e</tt></td>
<td>158</td>
</tr>
<tr><td>3</td>
<td><tt class="docutils literal">0x003</tt></td>
<td><tt class="docutils literal">0x0345</tt></td>
<td><tt class="docutils literal">0x03fb</tt></td>
<td>183</td>
</tr>
<tr><td>4</td>
<td><tt class="docutils literal">0x004</tt></td>
<td><tt class="docutils literal">0x0430</tt></td>
<td><tt class="docutils literal">0x04ff</tt></td>
<td>208</td>
</tr>
<tr><td>5</td>
<td><tt class="docutils literal">0x005</tt></td>
<td><tt class="docutils literal">0x0501</tt></td>
<td><tt class="docutils literal">0x0587</tt></td>
<td>135</td>
</tr>
<tr><td>6</td>
<td><tt class="docutils literal">0x010</tt></td>
<td><tt class="docutils literal">0x10d0</tt></td>
<td><tt class="docutils literal">0x10ff</tt></td>
<td>48</td>
</tr>
<tr><td>7</td>
<td><tt class="docutils literal">0x013</tt></td>
<td><tt class="docutils literal">0x13f8</tt></td>
<td><tt class="docutils literal">0x13fd</tt></td>
<td>6</td>
</tr>
<tr><td>8</td>
<td><tt class="docutils literal">0x01c</tt></td>
<td><tt class="docutils literal">0x1c80</tt></td>
<td><tt class="docutils literal">0x1c88</tt></td>
<td>9</td>
</tr>
<tr><td>9</td>
<td><tt class="docutils literal">0x01d</tt></td>
<td><tt class="docutils literal">0x1d79</tt></td>
<td><tt class="docutils literal">0x1d8e</tt></td>
<td>22</td>
</tr>
<tr><td>10</td>
<td><tt class="docutils literal">0x01e</tt></td>
<td><tt class="docutils literal">0x1e01</tt></td>
<td><tt class="docutils literal">0x1eff</tt></td>
<td>255</td>
</tr>
<tr><td>11</td>
<td><tt class="docutils literal">0x01f</tt></td>
<td><tt class="docutils literal">0x1f00</tt></td>
<td><tt class="docutils literal">0x1ffc</tt></td>
<td>253</td>
</tr>
<tr><td>12</td>
<td><tt class="docutils literal">0x021</tt></td>
<td><tt class="docutils literal">0x214e</tt></td>
<td><tt class="docutils literal">0x2184</tt></td>
<td>55</td>
</tr>
<tr><td>13</td>
<td><tt class="docutils literal">0x024</tt></td>
<td><tt class="docutils literal">0x24d0</tt></td>
<td><tt class="docutils literal">0x24e9</tt></td>
<td>26</td>
</tr>
<tr><td>14</td>
<td><tt class="docutils literal">0x02c</tt></td>
<td><tt class="docutils literal">0x2c30</tt></td>
<td><tt class="docutils literal">0x2cf3</tt></td>
<td>196</td>
</tr>
<tr><td>15</td>
<td><tt class="docutils literal">0x02d</tt></td>
<td><tt class="docutils literal">0x2d00</tt></td>
<td><tt class="docutils literal">0x2d2d</tt></td>
<td>46</td>
</tr>
<tr><td>16</td>
<td><tt class="docutils literal">0x0a6</tt></td>
<td><tt class="docutils literal">0xa641</tt></td>
<td><tt class="docutils literal">0xa69b</tt></td>
<td>91</td>
</tr>
<tr><td>17</td>
<td><tt class="docutils literal">0x0a7</tt></td>
<td><tt class="docutils literal">0xa723</tt></td>
<td><tt class="docutils literal">0xa7f6</tt></td>
<td>212</td>
</tr>
<tr><td>18</td>
<td><tt class="docutils literal">0x0ab</tt></td>
<td><tt class="docutils literal">0xab53</tt></td>
<td><tt class="docutils literal">0xabbf</tt></td>
<td>109</td>
</tr>
<tr><td>19</td>
<td><tt class="docutils literal">0x0fb</tt></td>
<td><tt class="docutils literal">0xfb00</tt></td>
<td><tt class="docutils literal">0xfb17</tt></td>
<td>24</td>
</tr>
<tr><td>20</td>
<td><tt class="docutils literal">0x0ff</tt></td>
<td><tt class="docutils literal">0xff41</tt></td>
<td><tt class="docutils literal">0xff5a</tt></td>
<td>26</td>
</tr>
<tr><td>21</td>
<td><tt class="docutils literal">0x104</tt></td>
<td><tt class="docutils literal">0x10428</tt></td>
<td><tt class="docutils literal">0x104fb</tt></td>
<td>212</td>
</tr>
<tr><td>22</td>
<td><tt class="docutils literal">0x105</tt></td>
<td><tt class="docutils literal">0x10597</tt></td>
<td><tt class="docutils literal">0x105bc</tt></td>
<td>38</td>
</tr>
<tr><td>23</td>
<td><tt class="docutils literal">0x10c</tt></td>
<td><tt class="docutils literal">0x10cc0</tt></td>
<td><tt class="docutils literal">0x10cf2</tt></td>
<td>51</td>
</tr>
<tr><td>24</td>
<td><tt class="docutils literal">0x118</tt></td>
<td><tt class="docutils literal">0x118c0</tt></td>
<td><tt class="docutils literal">0x118df</tt></td>
<td>32</td>
</tr>
<tr><td>25</td>
<td><tt class="docutils literal">0x16e</tt></td>
<td><tt class="docutils literal">0x16e60</tt></td>
<td><tt class="docutils literal">0x16e7f</tt></td>
<td>32</td>
</tr>
<tr><td>26</td>
<td><tt class="docutils literal">0x1e9</tt></td>
<td><tt class="docutils literal">0x1e922</tt></td>
<td><tt class="docutils literal">0x1e943</tt></td>
<td>34</td>
</tr>
<tr><td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>total 2875</td>
</tr>
</tbody>
</table>
<table border="1" class="col1right col2center col3center col4center col5right docutils">
<caption>First-level lookup metadata for lowercase</caption>
<thead valign="bottom">
<tr><th class="head">#</th>
<th class="head">9 highest bits</th>
<th class="head">minimum character code</th>
<th class="head">maximum character code</th>
<th class="head">chars in that range</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>0</td>
<td><tt class="docutils literal">0x000</tt></td>
<td><tt class="docutils literal">0x0041</tt></td>
<td><tt class="docutils literal">0x00de</tt></td>
<td>158</td>
</tr>
<tr><td>1</td>
<td><tt class="docutils literal">0x001</tt></td>
<td><tt class="docutils literal">0x0100</tt></td>
<td><tt class="docutils literal">0x01fe</tt></td>
<td>255</td>
</tr>
<tr><td>2</td>
<td><tt class="docutils literal">0x002</tt></td>
<td><tt class="docutils literal">0x0200</tt></td>
<td><tt class="docutils literal">0x024e</tt></td>
<td>79</td>
</tr>
<tr><td>3</td>
<td><tt class="docutils literal">0x003</tt></td>
<td><tt class="docutils literal">0x0370</tt></td>
<td><tt class="docutils literal">0x03ff</tt></td>
<td>144</td>
</tr>
<tr><td>4</td>
<td><tt class="docutils literal">0x004</tt></td>
<td><tt class="docutils literal">0x0400</tt></td>
<td><tt class="docutils literal">0x04fe</tt></td>
<td>255</td>
</tr>
<tr><td>5</td>
<td><tt class="docutils literal">0x005</tt></td>
<td><tt class="docutils literal">0x0500</tt></td>
<td><tt class="docutils literal">0x0556</tt></td>
<td>87</td>
</tr>
<tr><td>6</td>
<td><tt class="docutils literal">0x010</tt></td>
<td><tt class="docutils literal">0x10a0</tt></td>
<td><tt class="docutils literal">0x10cd</tt></td>
<td>46</td>
</tr>
<tr><td>7</td>
<td><tt class="docutils literal">0x013</tt></td>
<td><tt class="docutils literal">0x13a0</tt></td>
<td><tt class="docutils literal">0x13f5</tt></td>
<td>86</td>
</tr>
<tr><td>8</td>
<td><tt class="docutils literal">0x01c</tt></td>
<td><tt class="docutils literal">0x1c90</tt></td>
<td><tt class="docutils literal">0x1cbf</tt></td>
<td>48</td>
</tr>
<tr><td>9</td>
<td><tt class="docutils literal">0x01e</tt></td>
<td><tt class="docutils literal">0x1e00</tt></td>
<td><tt class="docutils literal">0x1efe</tt></td>
<td>255</td>
</tr>
<tr><td>10</td>
<td><tt class="docutils literal">0x01f</tt></td>
<td><tt class="docutils literal">0x1f08</tt></td>
<td><tt class="docutils literal">0x1ffc</tt></td>
<td>245</td>
</tr>
<tr><td>11</td>
<td><tt class="docutils literal">0x021</tt></td>
<td><tt class="docutils literal">0x2126</tt></td>
<td><tt class="docutils literal">0x2183</tt></td>
<td>94</td>
</tr>
<tr><td>12</td>
<td><tt class="docutils literal">0x024</tt></td>
<td><tt class="docutils literal">0x24b6</tt></td>
<td><tt class="docutils literal">0x24cf</tt></td>
<td>26</td>
</tr>
<tr><td>13</td>
<td><tt class="docutils literal">0x02c</tt></td>
<td><tt class="docutils literal">0x2c00</tt></td>
<td><tt class="docutils literal">0x2cf2</tt></td>
<td>243</td>
</tr>
<tr><td>14</td>
<td><tt class="docutils literal">0x0a6</tt></td>
<td><tt class="docutils literal">0xa640</tt></td>
<td><tt class="docutils literal">0xa69a</tt></td>
<td>91</td>
</tr>
<tr><td>15</td>
<td><tt class="docutils literal">0x0a7</tt></td>
<td><tt class="docutils literal">0xa722</tt></td>
<td><tt class="docutils literal">0xa7f5</tt></td>
<td>212</td>
</tr>
<tr><td>16</td>
<td><tt class="docutils literal">0x0ff</tt></td>
<td><tt class="docutils literal">0xff21</tt></td>
<td><tt class="docutils literal">0xff3a</tt></td>
<td>26</td>
</tr>
<tr><td>17</td>
<td><tt class="docutils literal">0x104</tt></td>
<td><tt class="docutils literal">0x10400</tt></td>
<td><tt class="docutils literal">0x104d3</tt></td>
<td>212</td>
</tr>
<tr><td>18</td>
<td><tt class="docutils literal">0x105</tt></td>
<td><tt class="docutils literal">0x10570</tt></td>
<td><tt class="docutils literal">0x10595</tt></td>
<td>38</td>
</tr>
<tr><td>19</td>
<td><tt class="docutils literal">0x10c</tt></td>
<td><tt class="docutils literal">0x10c80</tt></td>
<td><tt class="docutils literal">0x10cb2</tt></td>
<td>51</td>
</tr>
<tr><td>20</td>
<td><tt class="docutils literal">0x118</tt></td>
<td><tt class="docutils literal">0x118a0</tt></td>
<td><tt class="docutils literal">0x118bf</tt></td>
<td>32</td>
</tr>
<tr><td>21</td>
<td><tt class="docutils literal">0x16e</tt></td>
<td><tt class="docutils literal">0x16e40</tt></td>
<td><tt class="docutils literal">0x16e5f</tt></td>
<td>32</td>
</tr>
<tr><td>22</td>
<td><tt class="docutils literal">0x1e9</tt></td>
<td><tt class="docutils literal">0x1e900</tt></td>
<td><tt class="docutils literal">0x1e921</tt></td>
<td>34</td>
</tr>
<tr><td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td>total 2749</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</body>

<!-- Mirrored from 0x80.pl/notesen/2025-02-02-utf32-change-case.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 16 Feb 2025 16:43:18 GMT -->
</html>
