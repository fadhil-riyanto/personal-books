<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">

<!-- Mirrored from eli.thegreenplace.net/2016/the-chain-rule-of-calculus/ by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 16 Feb 2025 23:53:06 GMT -->
<head>
    <title>The Chain Rule of Calculus - Eli Bendersky's website</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="../../favicon.ico" rel="icon">

    <!-- Bootstrap -->
        <link rel="stylesheet" href="../../theme/css/bootstrap.min.css" type="text/css"/>
    <link href="../../theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="../../theme/css/pygments/vs.css" rel="stylesheet">
    <link rel="stylesheet" href="../../theme/css/style.css" type="text/css"/>

        <link href="../../feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Eli Bendersky's website ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="../../index.html" class="navbar-brand">
                <img src="../../images/logosmall.png" width="32" height="32"/>
Eli Bendersky's website            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="../../pages/about.html">
                        <i class="fa fa-question"></i>
                        <span class="icon-label">About</span>
                    </a>
                </li>
                <li>
                    <a href="../../pages/projects.html">
                        <i class="fa fa-github"></i>
                        <span class="icon-label">Projects</span>
                    </a>
                </li>
                <li>
                    <a href="../../archives/all.html">
                        <i class="fa fa-th-list"></i>
                        <span class="icon-label">Archives</span>
                    </a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<div class="container">
    <div class="row">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="index.html"
                       rel="bookmark"
                       title="Permalink to The Chain Rule of Calculus">
                        The Chain Rule of Calculus
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="published">
        <i class="fa fa-calendar"></i>
        <time> October 10, 2016 at 06:24</time>
    </span>
<span class="label label-default">Tags</span>
    <a href="../../tag/math.html">Math</a>
        ,
    <a href="../../tag/machine-learning.html">Machine Learning</a>
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>The chain rule of derivatives is, in my opinion, the most important formula in
differential calculus. In this post I want to explain how the chain rule works
for single-variable and multivariate functions, with some interesting examples
along the way.</p>
<div class="section" id="preliminaries-composition-of-functions-and-differentiability">
<h2>Preliminaries: composition of functions and differentiability</h2>
<p>We denote a function <em>f</em> that maps from the domain <em>X</em> to the codomain <em>Y</em> as
<img alt="f:X \rightarrow Y" class="valign-m4" src="../../images/math/e2f7fcdddf5b36735350a805eeb7cae36895ab1e.png" style="height: 16px;" />. With this <em>f</em> and given <img alt="g:Y \rightarrow Z" class="valign-m4" src="../../images/math/e664f090a7bb62573ae65c910ef7c81e5f086cf6.png" style="height: 16px;" />, we
can define <img alt="g \circ f:X \rightarrow Z" class="valign-m4" src="../../images/math/7f049e7749d289236edefaeb6399795a11afeb44.png" style="height: 16px;" /> as the composition of <em>g</em> and <em>f</em>.
It's defined for <img alt="\forall x \in X" class="valign-m1" src="../../images/math/76545a2a780098fe8c8d581192fa77deccae0848.png" style="height: 14px;" /> as:</p>
<img alt="\[(g \circ f)(x)=g(f(x))\]" class="align-center" src="../../images/math/8b9c8e67c9d2ec7fd3eefce043f380512f1230d3.png" style="height: 18px;" />
<p>In calculus we are usually concerned with the real number domain of some
dimensionality. In the single-variable case, we can think of <img alt="f" class="valign-m4" src="../../images/math/4a0a19218e082a343a1b17e5333409af9d98f0f5.png" style="height: 16px;" /> and
<img alt="g" class="valign-m4" src="../../images/math/54fd1711209fb1c0781092374132c66e79e2241b.png" style="height: 12px;" /> as two regular real-valued functions:
<img alt="f:\mathbb{R} \rightarrow \mathbb{R}" class="valign-m4" src="../../images/math/62ac71ec4fa066b12854a09cddef9ba062924d68.png" style="height: 16px;" /> and
<img alt="g:\mathbb{R} \rightarrow \mathbb{R}" class="valign-m4" src="../../images/math/974c68b8e4454d31c7a2eb389c94bbbfd11ac9da.png" style="height: 16px;" />.</p>
<p>As an example, say <img alt="f(x)=x+1" class="valign-m4" src="../../images/math/027c36c348c172740dd168c66fbfe75d8a8da0c3.png" style="height: 18px;" /> and <img alt="g(x)=x^2" class="valign-m4" src="../../images/math/9b74ba3074b06d93dacb65e40b0082897aa85b3d.png" style="height: 19px;" />. Then:</p>
<img alt="\[(g \circ f)(x)=g(f(x))=g(x+1)=(x+1)^2\]" class="align-center" src="../../images/math/f80635cd447f9f82452529c9289d16811394ea6c.png" style="height: 21px;" />
<p>We can compose the functions the other way around as well:</p>
<img alt="\[(f \circ g)(x)=f(g(x))=f(x^2)=x^2+1\]" class="align-center" src="../../images/math/13c07f9e990c72b1edaf651fccec5c4ad7c0f155.png" style="height: 21px;" />
<p>Obviously, we shouldn't expect composition to be commutative.
It is, however, associative. <img alt="h \circ (g \circ f)" class="valign-m4" src="../../images/math/ef6897e4aad0050d8f69248de3ecd8aaa3ad51de.png" style="height: 18px;" /> and
<img alt="(h \circ g) \circ f" class="valign-m4" src="../../images/math/03ac0c8bb4a409ff1ec1badfee9693280bb2f241.png" style="height: 18px;" /> are equivalent, and both end up being
<img alt="h(g(f(x)))" class="valign-m4" src="../../images/math/bc1a23574da8c77a4fc40d5cbbad2c5e1e95da86.png" style="height: 18px;" /> for <img alt="\forall x \in X" class="valign-m1" src="../../images/math/76545a2a780098fe8c8d581192fa77deccae0848.png" style="height: 14px;" />.</p>
<p>To better handle compositions in one's head it sometimes helps to denote the
independent variable of the outer function (<em>g</em> in our case) by a different
letter (such as <img alt="g(a)" class="valign-m4" src="../../images/math/e7373233d49e18a0882e0dce41d9d6aa26964d6b.png" style="height: 18px;" />). For simple cases it doesn't matter, but I'll
be using this technique occasionally throughout the article. The important thing
to remember here is that the name of the independent variable is completely
arbitrary, and we should always be able to replace it by another name throughout
the formula without any semantic change.</p>
<p>The other preliminary I want to mention is <em>differentiability</em>. The function <em>f</em>
is differentiable at some point <img alt="x_0" class="valign-m3" src="../../images/math/efbda784ad565c1c5201fdc948a570d0426bc6e6.png" style="height: 11px;" /> if the following limit exists:</p>
<img alt="\[\lim_{h \to 0}\frac{f(x_0+h)-f(x_0)}{h}\]" class="align-center" src="../../images/math/34b3ce83a20775cf99b8d204d2b845dfde5727cc.png" style="height: 39px;" />
<p>This limit is then the derivative of <em>f</em> at the point <img alt="x_0" class="valign-m3" src="../../images/math/efbda784ad565c1c5201fdc948a570d0426bc6e6.png" style="height: 11px;" />, or
<img alt="{f}&amp;#x27;(x_0)" class="valign-m4" src="../../images/math/e9b2a1134fcdc276843ee4b522039359117026ee.png" style="height: 18px;" />. Another way to express this is <img alt="\frac{d}{dx}f(x_0)" class="valign-m6" src="../../images/math/b0d6f765abf215972d5dbb982f77f1a83c233066.png" style="height: 22px;" />.
Note that <img alt="x_0" class="valign-m3" src="../../images/math/efbda784ad565c1c5201fdc948a570d0426bc6e6.png" style="height: 11px;" /> can be any arbitrary point on the real line. I sometimes
say something like &quot;<em>f</em> is differentiable at <img alt="g(x_0)" class="valign-m4" src="../../images/math/9d8c0deeca951fab05e474395fbb9fab226cf1f2.png" style="height: 18px;" />&quot;. Here too,
<img alt="g(x_0)" class="valign-m4" src="../../images/math/9d8c0deeca951fab05e474395fbb9fab226cf1f2.png" style="height: 18px;" /> is just a real value that happens to be the value of the function
<em>g</em> at <img alt="x_0" class="valign-m3" src="../../images/math/efbda784ad565c1c5201fdc948a570d0426bc6e6.png" style="height: 11px;" />.</p>
</div>
<div class="section" id="the-single-variable-chain-rule">
<h2>The single-variable chain rule</h2>
<p>The chain rule for single-variable functions states: if <em>g</em> is differentiable at
<img alt="x_0" class="valign-m3" src="../../images/math/efbda784ad565c1c5201fdc948a570d0426bc6e6.png" style="height: 11px;" /> and <em>f</em> is differentiable at <img alt="g(x_0)" class="valign-m4" src="../../images/math/9d8c0deeca951fab05e474395fbb9fab226cf1f2.png" style="height: 18px;" />, then <img alt="f \circ g" class="valign-m4" src="../../images/math/1247a6ac0bc07bfdbd790831aa70b0b000bad2e4.png" style="height: 16px;" />
is differentiable at <img alt="x_0" class="valign-m3" src="../../images/math/efbda784ad565c1c5201fdc948a570d0426bc6e6.png" style="height: 11px;" /> and its derivative is:</p>
<img alt="\[(f \circ g)&amp;#x27;(x_0)={f}&amp;#x27;(g(x_0)){g}&amp;#x27;(x_0)\]" class="align-center" src="../../images/math/77fb8b77b35d687c20379179b0178ebdd9b2cee1.png" style="height: 20px;" />
<p>The proof of the chain rule is a bit tricky - I left it for the appendix.
However, we can get a better feel for it using some intuition and a couple of
examples.</p>
<p>First, the intuituion. By definition:</p>
<img alt="\[{g}&amp;#x27;(x_0)=\lim_{h \to 0}\frac{g(x_0+h)-g(x_0)}{h}\]" class="align-center" src="../../images/math/cdc3e4a3bced3a7527a15cd76a688d5cc1c06aab.png" style="height: 39px;" />
<p>Multiplying both sides by <em>h</em> we get <a class="footnote-reference" href="#footnote-1" id="footnote-reference-1">[1]</a>:</p>
<img alt="\[{g}&amp;#x27;(x_0)h=\lim_{h \to 0}g(x_0+h)-g(x_0)\]" class="align-center" src="../../images/math/daf52cabed3806986d4c8c29dd60e4ce4fa9247d.png" style="height: 29px;" />
<p>Therefore we can say that when <img alt="x_0" class="valign-m3" src="../../images/math/efbda784ad565c1c5201fdc948a570d0426bc6e6.png" style="height: 11px;" /> changes by some very small amount,
<img alt="g(x_0)" class="valign-m4" src="../../images/math/9d8c0deeca951fab05e474395fbb9fab226cf1f2.png" style="height: 18px;" /> changes by <img alt="{g}&amp;#x27;(x_0)" class="valign-m4" src="../../images/math/fbb4d7279a750f6d80eebeff2e2c25765b304f16.png" style="height: 18px;" /> times that small amount.</p>
<p>Similarly <img alt="{f}&amp;#x27;(a_0)" class="valign-m4" src="../../images/math/d04139c8f65536c3042f975a6966ed49f5f15832.png" style="height: 18px;" /> is the amount of change in the value of <em>f</em> for some
very small change from <img alt="a_0" class="valign-m3" src="../../images/math/4a5997da73aadd118038761e69d01e24586bf958.png" style="height: 11px;" />. However, since in our case we compose
<img alt="f \circ g" class="valign-m4" src="../../images/math/1247a6ac0bc07bfdbd790831aa70b0b000bad2e4.png" style="height: 16px;" />, we can say that <img alt="a_0=g(x_0)" class="valign-m4" src="../../images/math/e198d0bc24284bd638c564e0b46edf975d5831d4.png" style="height: 18px;" />, evaluating
<img alt="f(g(x_0))" class="valign-m4" src="../../images/math/04a8bf9b7bd565f95f2cb3e0fe6de123b247e3be.png" style="height: 18px;" />. Suppose we shift <img alt="x_0" class="valign-m3" src="../../images/math/efbda784ad565c1c5201fdc948a570d0426bc6e6.png" style="height: 11px;" /> by a small amount <em>h</em>. This
causes <img alt="g(x_0)" class="valign-m4" src="../../images/math/9d8c0deeca951fab05e474395fbb9fab226cf1f2.png" style="height: 18px;" /> to shift by <img alt="{g}&amp;#x27;(x_0)h" class="valign-m4" src="../../images/math/0e1e11ca765684cf07722c40de2bd86b208ca7c1.png" style="height: 18px;" />. So the input <img alt="a_0" class="valign-m3" src="../../images/math/4a5997da73aadd118038761e69d01e24586bf958.png" style="height: 11px;" />
of <em>f</em> shifted by <img alt="{g}&amp;#x27;(x_0)h" class="valign-m4" src="../../images/math/0e1e11ca765684cf07722c40de2bd86b208ca7c1.png" style="height: 18px;" /> - this is still a small amount! Therefore,
the total change in the value of <em>f</em> should be <img alt="{f}&amp;#x27;(g(x_0)){g}&amp;#x27;(x_0)h" class="valign-m4" src="../../images/math/b761eb11c7502754575d0413e7ba040f4a106d0d.png" style="height: 18px;" /> <a class="footnote-reference" href="#footnote-2" id="footnote-reference-2">[2]</a>.</p>
<p>Now, a couple of simple examples. Let's take the function <img alt="f(x)=(x+1)^2" class="valign-m4" src="../../images/math/8db433d3f263ad489e31931ef4a3ddccbd7bece0.png" style="height: 19px;" />.
The idea is to think of this function as a composition of simpler functions.
In this case, one option is: <img alt="g(x)=x+1" class="valign-m4" src="../../images/math/8b2ec3a2221203b211c8a0ed975841cb508b193c.png" style="height: 18px;" /> and then <img alt="w(g(x))=g(x)^2" class="valign-m4" src="../../images/math/2ed44118a1efadf34f5bf169d2ca450246519d1d.png" style="height: 19px;" />,
so the original <em>f</em> is now the composition <img alt="w \circ g" class="valign-m4" src="../../images/math/4edc28332d30c68727a56fbd473126441850c4f0.png" style="height: 12px;" />.</p>
<p>The derivative of this composition is <img alt="{w}&amp;#x27;(g(x)){g}&amp;#x27;(x)" class="valign-m4" src="../../images/math/05261e48f79f6e8b129bb26dee7fa8a07bcbf876.png" style="height: 18px;" />, or
<img alt="2(x+1)" class="valign-m4" src="../../images/math/39b598cf32e125c7ae18b7623043d5f8133eba78.png" style="height: 18px;" /> since <img alt="{g}&amp;#x27;(x)=1" class="valign-m4" src="../../images/math/36cc7eeced1b708dcf6166dcaae955f733f93ded.png" style="height: 18px;" />. Note that <em>w</em> is differentiable at any
point, so this derivative always exists.</p>
<p>Another example will use a longer chain of composition. Let's differentiate
<img alt="f(x)=sin[(x+1)^2]" class="valign-m5" src="../../images/math/3e3a23e0dd5d4ee105bcca545bddb058917e2c9c.png" style="height: 20px;" />. This is a composition of three functions:</p>
<img alt="\[\begin{align*} g(x)&amp;amp;=x+1\\ w(x)&amp;amp;=x^2\\ v(x)&amp;amp;=sin(x) \end{align*}\]" class="align-center" src="../../images/math/6981c04536025d8e43d07bf9b067252c2028feab.png" style="height: 73px;" />
<p>Function composition is associative, so <em>f</em> can be expressed as either
<img alt="v \circ (w \circ g)" class="valign-m4" src="../../images/math/1c2a8a63ec4fb6e489b0896b544e277823228906.png" style="height: 18px;" /> or <img alt="(v \circ w) \circ g" class="valign-m4" src="../../images/math/be47fface92aa5db8bade3049da31d065ef8244b.png" style="height: 18px;" />. Since we already
know what the derivative of <img alt="w \circ g" class="valign-m4" src="../../images/math/4edc28332d30c68727a56fbd473126441850c4f0.png" style="height: 12px;" /> is, let's use the former:</p>
<img alt="\[\begin{align*} \frac{df(x)}{dx}=\frac{d v(w(g(x)))}{dx}&amp;amp;={v}&amp;#x27;(w(g(x))){w(g(x))}&amp;#x27;(x)\\                                         &amp;amp;=cos(w(g(x)))2(x+1)\\                                         &amp;amp;=2cos[(x+1)^2](x+1) \end{align*}\]" class="align-center" src="../../images/math/f63f9a07295583911873238c3ee6e84e8c3722ca.png" style="height: 93px;" />
</div>
<div class="section" id="the-chain-rule-as-a-computational-procedure">
<h2>The chain rule as a computational procedure</h2>
<p>As the last example demonstrates, the chain rule can be applied multiple times
in a single derivation. This makes the chain rule a powerful tool for computing
derivatives of very complex functions, which can be broken up into compositions
of simpler functions. I like to draw a parallel between this process and
programming; a function in a programming language can be seen as a computational
procedure - we have a set of input parameters and we produce outputs. On the
way, several transformations happen that can be expressed mathematically. These
transformations are composed, so their derivatives can be computed naturally
with the chain rule.</p>
<p>This may be somewhat abstract, so let's use another example. We'll compute the
derivative of the Sigmoid function - a very important function in machine
learning:</p>
<img alt="\[S(x)=\frac{1}{1+e^{-x}}\]" class="align-center" src="../../images/math/9a39d0495ce32da5840b76adaf508a0349394c49.png" style="height: 38px;" />
<p>To make the equivalence between functions and computational procedures clearer,
let's think how we'd compute <em>S</em> in Python:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">))</span>
</pre></div>
<p>This doesn't look much different, but that's just because Python is a high level
language with arbitrarily nested expressions. Its VM (or the CPU in general)
would execute this computation step by step. Let's break it up to be clearer,
assuming we can only apply a single operation at every step:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">f</span> <span class="o">=</span> <span class="o">-</span><span class="n">x</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">w</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">g</span>
    <span class="n">v</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">w</span>
    <span class="k">return</span> <span class="n">v</span>
</pre></div>
<p>I hope you're starting to see the resemblance to our chain rule examples at this
point. Sacrificing some rigor in the notation for the sake of expressiveness, we
can write:</p>
<img alt="\[S&amp;#x27;=v&amp;#x27;(w)w&amp;#x27;(g)g&amp;#x27;(f)f&amp;#x27;(x)\]" class="align-center" src="../../images/math/b3029d842b915e7bf0ea1aa91372ab071dd8b80e.png" style="height: 20px;" />
<p>This is the chain rule applied to <img alt="v \circ (w \circ (g \circ f))" class="valign-m4" src="../../images/math/caaf8ea9ee60bb84d61d422c6dee5d6cd173f0ab.png" style="height: 18px;" />. Solving
this is easy because every single derivative in the chain above is trivial:</p>
<img alt="\[\begin{align*} S&amp;#x27;&amp;amp;=v&amp;#x27;(w)w&amp;#x27;(g)g&amp;#x27;(f)(-1)\\   &amp;amp;=v&amp;#x27;(w)w&amp;#x27;(g)e^{-x}(-1)\\   &amp;amp;=v&amp;#x27;(w)(1)e^{-x}(-1)\\   &amp;amp;=\frac{-1}{(1+e^{-x})^2}e^{-x}(-1)\\   &amp;amp;=\frac{e^{-x}}{(1+e^{-x})^2} \end{align*}\]" class="align-center" src="../../images/math/b987461a2551ca622908f40f791519f3afe3b452.png" style="height: 171px;" />
<p>Now you may be thinking:</p>
<ol class="arabic simple">
<li>Every function computable by a program can be broken down to trivial steps
like our <tt class="docutils literal">sigmoid</tt> above.</li>
<li>Using the chain rule, we can easily find the derivative of such a sequence
of steps... therefore:</li>
<li>We can easily find the derivative of any function computable by a program!!</li>
</ol>
<p>An you'll be right. This is precisely the basis for the technique known as
<a class="reference external" href="https://en.wikipedia.org/wiki/Automatic_differentiation">automatic differentiation</a>, which is widely
used in scienctific computing. The most notable use of automatic differentiation
in recent times is the backpropagation algorithm - an essential backbone of
modern machine learning. I personally find automatic differentiation
fascinating, and will write a more dedicated article about it in the future.</p>
<p><strong>Update (2025-01-13)</strong>: Check out <a class="reference external" href="../../2025/reverse-mode-automatic-differentiation/index.html">this post on the subject</a>.</p>
</div>
<div class="section" id="multivariate-chain-rule-general-formulation">
<h2>Multivariate chain rule - general formulation</h2>
<p>So far this article has been looking at functions with a single input and
output: <img alt="f:\mathbb{R} \to \mathbb{R}" class="valign-m4" src="../../images/math/2e28467c90f978580e43c376716981ec5906a01d.png" style="height: 16px;" />. In the most general case of
multi-variate calculus, we're dealing with functions that map from <em>n</em>
dimensions to <em>m</em> dimensions: <img alt="f:\mathbb{R}^{n} \to \mathbb{R}^{m}" class="valign-m4" src="../../images/math/13f219789047343729036279bb11630db317d98d.png" style="height: 16px;" />.
Because every one of the <em>m</em> outputs of <em>f</em> can be considered a separate
function dependent on <em>n</em> variables, it's very natural to deal with such math
using vectors and matrices.</p>
<p>First let's define some notation. We'll consider the outputs of <em>f</em> to be
numbered from 1 to <em>m</em> as <img alt="f_1,f_2 \dots f_m" class="valign-m4" src="../../images/math/93b446c5209263534d09d617bbede21101d6536e.png" style="height: 16px;" />. For each such <img alt="f_i" class="valign-m4" src="../../images/math/68bd0dc647944d362ec8df628a22967b91d82c80.png" style="height: 16px;" />
we can compute its partial derivative by any of the <em>n</em> inputs as:</p>
<img alt="\[D_j f_i(a)=\frac{\partial f_i}{\partial a_j}(a)\]" class="align-center" src="../../images/math/30881b5a92e45259714ba01c7a12fbf8f6c56109.png" style="height: 42px;" />
<p>Where <em>j</em> goes from 1 to <em>n</em> and <em>a</em> is a vector with <em>n</em> components. If <em>f</em>
is differentiable at <em>a</em> <a class="footnote-reference" href="#footnote-3" id="footnote-reference-3">[3]</a> then the derivative of <em>f</em> at <em>a</em> is the <em>Jacobian
matrix</em>:</p>
<img alt="\[Df(a)=\begin{bmatrix} D_1 f_1(a) &amp;amp; \cdots &amp;amp; D_n f_1(a) \\ \vdots &amp;amp;  &amp;amp; \vdots \\ D_1 f_m(a) &amp;amp; \cdots &amp;amp; D_n f_m(a) \\ \end{bmatrix}\]" class="align-center" src="../../images/math/ab09367d48e9ef4d8bc2314a60313dec700193af.png" style="height: 76px;" />
<p>The multivariate chain rule states: given <img alt="g:\mathbb{R}^n \to \mathbb{R}^m" class="valign-m4" src="../../images/math/b4b7d25491897b053abf7e48688fada4a85368bd.png" style="height: 16px;" />
and <img alt="f:\mathbb{R}^m \to \mathbb{R}^p" class="valign-m4" src="../../images/math/ac8a6cea4e02e885538fc3ef969c5733e84712f9.png" style="height: 16px;" /> and a point <img alt="a \in \mathbb{R}^n" class="valign-m1" src="../../images/math/43a85f2c59f396fe5c4e2c403a0453c463fcfb0d.png" style="height: 13px;" />,
if <em>g</em> is differentiable at <em>a</em> and <em>f</em> is differentiable at <img alt="g(a)" class="valign-m4" src="../../images/math/e7373233d49e18a0882e0dce41d9d6aa26964d6b.png" style="height: 18px;" /> then
the composition <img alt="f \circ g" class="valign-m4" src="../../images/math/1247a6ac0bc07bfdbd790831aa70b0b000bad2e4.png" style="height: 16px;" /> is differentiable at <em>a</em> and its derivative
is:</p>
<img alt="\[D(f \circ g)(a)=Df(g(a)) \cdot Dg(a)\]" class="align-center" src="../../images/math/00bdefa904bd34df2dfb50cc385e6497c4e5096e.png" style="height: 18px;" />
<p>Which is the matrix multiplication of <img alt="Df(g(a))" class="valign-m4" src="../../images/math/e567730c48bb2f95c258b630b4d6e997043e09ab.png" style="height: 18px;" /> and <img alt="Dg(a)" class="valign-m4" src="../../images/math/2575fc98e794a733a7aa6237fe67246a41e6c8c5.png" style="height: 18px;" /> <a class="footnote-reference" href="#footnote-4" id="footnote-reference-4">[4]</a>.
Intuitively, the multivariate chain rule mirrors the single-variable one (and as
we'll soon see, the latter is just a special case of the former) with
derivatives replaced by derivative matrices. From linear algebra, we represent
linear transformations by matrices, and the composition of two linear transformations
is the product of their matrices. Therefore, since derivative matrices - like
derivatives in one dimension - are a linear approximation to the function, the
chain rule makes sense. This is a really nice connection between linear algebra
and calculus, though a full proof of the multivariate rule is very technical and
outside the scope of this article.</p>
</div>
<div class="section" id="multivariate-chain-rule-examples">
<h2>Multivariate chain rule - examples</h2>
<p>Since the chain rule deals with compositions of functions, it's natural to
present examples from the world of parametric curves and surfaces. For example,
suppose we define <img alt="f(x,y,z)" class="valign-m4" src="../../images/math/c5d72ae6186c76bde08c693d4bfdb85e3201125d.png" style="height: 18px;" /> as a scalar function
<img alt="\mathbb{R}^3 \to \mathbb{R}" class="valign-m1" src="../../images/math/1862a20e93e78e42aafd20106ceabe142def19f1.png" style="height: 16px;" /> giving the temperature
at some point in 3D. Now imagine that we're moving through this 3D space on
a curve defined by a function <img alt="g:\mathbb{R} \to \mathbb{R}^3" class="valign-m4" src="../../images/math/e97099dd54f45a2a71a33d305c517ec97565909d.png" style="height: 19px;" /> which takes
time <em>t</em> and gives the coordinates <img alt="x(t),y(t),z(t)" class="valign-m4" src="../../images/math/4e2bdd3060e49f3494f68f99cb6d2204b2a19e1c.png" style="height: 18px;" /> at that time. We want
to compute how the temperature changes as a function of time <em>t</em> - how do we do
that? Recall that the temprerature is not a direct function of time, but rather
is a function of location, while location <em>is</em> a function of time. Therefore,
we'll want to compose <img alt="f \circ g" class="valign-m4" src="../../images/math/1247a6ac0bc07bfdbd790831aa70b0b000bad2e4.png" style="height: 16px;" />. Here's a concrete example:</p>
<img alt="\[g(t)=\begin{pmatrix} t\\ t^2\\ t^3 \end{pmatrix}\]" class="align-center" src="../../images/math/cdaff94ebfb318ec24f472be470497e28a091c42.png" style="height: 65px;" />
<p>And:</p>
<img alt="\[f\begin{pmatrix} x \\ y \\ z \end{pmatrix}=x^2+xyz+5y\]" class="align-center" src="../../images/math/0a2fc40b06886d3b54628680192d71a3186d9fc7.png" style="height: 65px;" />
<p>If we reformulate <em>x</em>, <em>y</em> and <em>z</em> as functions of <em>t</em>:</p>
<object class="align-center" data="../../images/math/36f726e2fe10b99ab5d216310d2fe91d61f24c46.svg" style="height: 21px;" type="image/svg+xml">\[f(x(t),y(t),z(t))=x(t)^2+x(t)y(t)z(t)+5y(t)\]</object>
<p>Composing <img alt="f \circ g" class="valign-m4" src="../../images/math/1247a6ac0bc07bfdbd790831aa70b0b000bad2e4.png" style="height: 16px;" />, we get:</p>
<img alt="\[(f \circ g)(t)=f(g(t))=f(t,t^2,t^3)=t^2+t^6+5t^2=6t^2+t^6\]" class="align-center" src="../../images/math/63ad25f62a0e93b1f8175a627aac0a29a88a3cca.png" style="height: 21px;" />
<p>Since this is a simple function, we can find its derivative directly:</p>
<img alt="\[(f \circ g)&amp;#x27;(t)=12t+6t^5\]" class="align-center" src="../../images/math/d1025880b042d304efe08de37eeafde5a8d9231c.png" style="height: 21px;" />
<p>Now let's repeat this exercise using the multivariate chain rule. To compute
<img alt="D(f \circ g)(t)" class="valign-m4" src="../../images/math/c20cc5474ef67f0ec35bddccdc59b72742a864e1.png" style="height: 18px;" /> we need <img alt="Df(g(t))" class="valign-m4" src="../../images/math/ded52fd957c2b251c84052c335523b80a4e3c945.png" style="height: 18px;" /> and <img alt="Dg(t)" class="valign-m4" src="../../images/math/ec8c49e88582659c617e6563375355ede5fe1090.png" style="height: 18px;" />. Let's start
with <img alt="Dg(t)" class="valign-m4" src="../../images/math/ec8c49e88582659c617e6563375355ede5fe1090.png" style="height: 18px;" />. <img alt="g(t)" class="valign-m4" src="../../images/math/851fb8b00904a32dff1c79d40158c7ec9d3d5254.png" style="height: 18px;" /> maps <img alt="\mathbb{R} \to \mathbb{R}^3" class="valign-m1" src="../../images/math/0354b4368db3496b963c21b446ad726b65a0ab90.png" style="height: 16px;" />,
so its Jacobian is a 3-by-1 matrix, or column vector:</p>
<img alt="\[Dg(t)=\begin{bmatrix} 1 \\ 2t \\ 3t^2 \end{bmatrix}\]" class="align-center" src="../../images/math/492d3e9013352e0cd44e3c5721cd0535174fb318.png" style="height: 65px;" />
<p>To compute <img alt="Df(g(t))" class="valign-m4" src="../../images/math/ded52fd957c2b251c84052c335523b80a4e3c945.png" style="height: 18px;" /> let's first find <img alt="Df(x,y,z)" class="valign-m4" src="../../images/math/dab2e6dc478f82ef76bff84080623a27fe214dec.png" style="height: 18px;" />. Since
<img alt="f(x,y,z)" class="valign-m4" src="../../images/math/c5d72ae6186c76bde08c693d4bfdb85e3201125d.png" style="height: 18px;" /> maps <img alt="\mathbb{R}^3 \to \mathbb{R}" class="valign-m1" src="../../images/math/1862a20e93e78e42aafd20106ceabe142def19f1.png" style="height: 16px;" />, its Jacobian is a
1-by-3 matrix, or row vector:</p>
<img alt="\[Df(x,y,z)=\begin{bmatrix} 2x+yz &amp;amp; xz+5 &amp;amp; xy \end{bmatrix}\]" class="align-center" src="../../images/math/e8d650cac68d341d2c99c2641be3d238e516e51c.png" style="height: 22px;" />
<p>To apply the chain rule, we need <img alt="Df(g(t))" class="valign-m4" src="../../images/math/ded52fd957c2b251c84052c335523b80a4e3c945.png" style="height: 18px;" />:</p>
<img alt="\[Df(g(t))=\begin{bmatrix} 2t+t^5 &amp;amp; t^4+5 &amp;amp; t^3 \end{bmatrix}\]" class="align-center" src="../../images/math/b061977c12dcc918a96473939f6dc01eb7ea7847.png" style="height: 22px;" />
<p>Finally, multiplying <img alt="Df(g(t))" class="valign-m4" src="../../images/math/ded52fd957c2b251c84052c335523b80a4e3c945.png" style="height: 18px;" /> by <img alt="Dg(t)" class="valign-m4" src="../../images/math/ec8c49e88582659c617e6563375355ede5fe1090.png" style="height: 18px;" />, we get:</p>
<img alt="\[\begin{align*} D(f \circ g)(t)=Df(g(t)) \cdot Dg(t)&amp;amp;=\begin{bmatrix} 2t+t^5 &amp;amp; t^4+5 &amp;amp; t^3 \end{bmatrix} \cdot \begin{bmatrix} 1 \\ 2t \\ 3t^2 \end{bmatrix}\\ &amp;amp;=2t+t^5+2t^6+10t+3t^5\\ &amp;amp;=12t+6t^5 \end{align*}\]" class="align-center" src="../../images/math/9c5a5fc3e8024f6d1f2364ad5d0433bb530d4987.png" style="height: 118px;" />
<p>Another interesting way to interpret this result for the case where
<img alt="f:\mathbb{R}^3 \to \mathbb{R}" class="valign-m4" src="../../images/math/d307aff95a39ad62cc090e4d6e3bd73b1ffc2b14.png" style="height: 19px;" /> and <img alt="g:\mathbb{R} \to \mathbb{R}^3" class="valign-m4" src="../../images/math/e97099dd54f45a2a71a33d305c517ec97565909d.png" style="height: 19px;" />
is to <a class="reference external" href="../understanding-gradient-descent.html">recall that</a>
the directional derivative of <em>f</em> in the direction of some vector <img alt="\vec{v}" class="valign-0" src="../../images/math/39a3a59a8f524cf72620db07b9ba7cdce9fc9391.png" style="height: 13px;" />
is:</p>
<img alt="\[D_{\vec{v}}f=(\nabla f) \cdot \vec{v}\]" class="align-center" src="../../images/math/49933775272512c4c8686d9f9692c8ea01e1c97d.png" style="height: 18px;" />
<p>In our case <img alt="(\nabla f)" class="valign-m4" src="../../images/math/cf1f51ce22cf132c44f5cd65c1c6ada1cce0347f.png" style="height: 18px;" /> is the Jacobian of <em>f</em> (because of its
dimensionality). So if we take <img alt="\vec{v}" class="valign-0" src="../../images/math/39a3a59a8f524cf72620db07b9ba7cdce9fc9391.png" style="height: 13px;" /> to be the vector <img alt="Dg(t)" class="valign-m4" src="../../images/math/ec8c49e88582659c617e6563375355ede5fe1090.png" style="height: 18px;" />,
and evaluate the gradient at <img alt="g(t)" class="valign-m4" src="../../images/math/851fb8b00904a32dff1c79d40158c7ec9d3d5254.png" style="height: 18px;" /> we get <a class="footnote-reference" href="#footnote-5" id="footnote-reference-5">[5]</a>:</p>
<img alt="\[D_{\vec{Dg(t)}}f(t)=(\nabla f(g(t))) \cdot Dg(t)\]" class="align-center" src="../../images/math/dc8e045fe902682ada36e08fa0099f95632b7ced.png" style="height: 24px;" />
<p>This gives us some additional intuition for the temperature change question. The
change in temperature as a function of time is the directional derivative of <em>f</em>
in the direction of the change in location (<img alt="Dg(t)" class="valign-m4" src="../../images/math/ec8c49e88582659c617e6563375355ede5fe1090.png" style="height: 18px;" />).</p>
<p>For additional examples of applying the chain rule, see
<a class="reference external" href="../the-softmax-function-and-its-derivative/index.html">my post about softmax</a>.</p>
</div>
<div class="section" id="tricks-with-the-multivariate-chain-rule-derivative-of-products">
<h2>Tricks with the multivariate chain rule - derivative of products</h2>
<p>Earlier in the article we've seen how the chain rule helps find derivatives of
complicated functions by decomposing them into simpler functions. The
multivariate chain rule allows even more of that, as the following example
demonstrates. Suppose <img alt="h(x)=f(x)g(x)" class="valign-m4" src="../../images/math/6b584f7e739b604fe2d90a983216090d25643ad1.png" style="height: 18px;" />. Then, the well-known <a class="reference external" href="https://en.wikipedia.org/wiki/Product_rule">product rule</a> of derivatives states that:</p>
<img alt="\[h&amp;#x27;(x)=f&amp;#x27;(x)g(x)+f(x)g&amp;#x27;(x)\]" class="align-center" src="../../images/math/6c77a942dbee351e8229ce7771680b6a2f55c4aa.png" style="height: 20px;" />
<p>Proving this from first principles (the definition of the derivative as a limit)
isn't hard, but I want to show how it stems very easily from the multivariate
chain rule.</p>
<p>Let's begin by re-formulating <img alt="h(x)" class="valign-m4" src="../../images/math/2a1862ca703d9d9a76538d74b8f4b71df93bafab.png" style="height: 18px;" /> as a composition of two functions.
The first takes a vector <img alt="\vec{s}" class="valign-0" src="../../images/math/6a16290a6fe4bd5b30bf2cf959214e8fa4924959.png" style="height: 13px;" /> in <img alt="\mathbb{R}^2" class="valign-0" src="../../images/math/2b688757b3d0949451e1fa97e71ac5f5f284a5e4.png" style="height: 15px;" /> and maps it to
<img alt="\mathbb{R}" class="valign-0" src="../../images/math/0ed839b111fe0e3ca2b2f618b940893eaea88a57.png" style="height: 12px;" /> by computing the product of its two components:</p>
<img alt="\[p(\vec{s})=s_1 s_2\]" class="align-center" src="../../images/math/955d480267a38ec452bcdf2774dadc7652a757fa.png" style="height: 18px;" />
<p>The second is a vector-valued function that maps a number
<img alt="x \in \mathbb{R}" class="valign-m1" src="../../images/math/ec7e4961c34351c48080f6190b6ec363af9adf25.png" style="height: 13px;" /> to <img alt="\mathbb{R}^2" class="valign-0" src="../../images/math/2b688757b3d0949451e1fa97e71ac5f5f284a5e4.png" style="height: 15px;" /> :</p>
<img alt="\[s(x)=\begin{pmatrix} f(x)\\ g(x) \end{pmatrix}\]" class="align-center" src="../../images/math/f5c473fb1fb5ee47e59414a91dc484e182bc6210.png" style="height: 43px;" />
<p>We can compose <img alt="p \circ s" class="valign-m4" src="../../images/math/3f1c954d3481a1a167ae311bc3c3980aaf1ee3a1.png" style="height: 12px;" />, producing a function that takes
a scalar an returns a scalar: <img alt="(p \circ s) : \mathbb{R} \to \mathbb{R}" class="valign-m4" src="../../images/math/c827ac5b7598c117c157d0377b8c30a0f9a72b81.png" style="height: 18px;" />.
We get:</p>
<img alt="\[h(x)=(p \circ s)(x) = f(x)g(x)\]" class="align-center" src="../../images/math/3cbae5f44d32653bd6bbc66e6ee8bb5e1a4dfe40.png" style="height: 18px;" />
<p>Since we're composing two multivariate functions, we can apply the multivariate
chain rule here:</p>
<img alt="\[\begin{align*} D(p \circ s) &amp;amp;= Dp(s(x)) \cdot Ds(x)\\              &amp;amp;=\begin{bmatrix}                 \frac{\partial p}{\partial s_1}(x) &amp;amp; \frac{\partial p}{\partial s_2}(x)             \end{bmatrix}\cdot                 \begin{bmatrix}                 {s_1}&amp;#x27;(x)\\                 {s_2}&amp;#x27;(x)               \end{bmatrix}\\              &amp;amp;=\begin{bmatrix}                 s_2(x) &amp;amp; s_1(x)                 \end{bmatrix}                 \cdot                 \begin{bmatrix}                 {s_1}&amp;#x27;(x)\\                 {s_2}&amp;#x27;(x)               \end{bmatrix}\\               &amp;amp;={s_1}&amp;#x27;(x)s_2(x)+{s_2}&amp;#x27;(x)s_1(x) \end{align*}\]" class="align-center" src="../../images/math/ee8bd27a8257039f72c8751eb78626521f12a5fa.png" style="height: 147px;" />
<p>Since <img alt="s_1(x)=f(x)" class="valign-m4" src="../../images/math/dc67440057222e8222ae08269e4ba2a1e58acbb4.png" style="height: 18px;" /> and <img alt="s_2(x)=g(x)" class="valign-m4" src="../../images/math/89d252d983d49126f2f4a34fcf01fd6c882e4792.png" style="height: 18px;" />, this is exactly the product
rule.</p>
</div>
<div class="section" id="connecting-the-single-variable-and-multivariate-chain-rules">
<h2>Connecting the single-variable and multivariate chain rules</h2>
<p>Given function <img alt="f(x) : \mathbb{R} \to \mathbb{R}" class="valign-m4" src="../../images/math/bd80387ffb4e5cd8702c12837a57f1806ea1d02b.png" style="height: 18px;" />, its Jacobian matrix
has a single entry:</p>
<img alt="\[Df(a)=\begin{bmatrix}D_{x}f(a)\end{bmatrix}=       \begin{bmatrix}\frac{df}{dx}(a)\end{bmatrix}\]" class="align-center" src="../../images/math/cc95d53415b32e6610c1a45bededb4fb584f0c64.png" style="height: 24px;" />
<p>Therefore, given two functions mapping <img alt="\mathbb{R} \to \mathbb{R}" class="valign-m1" src="../../images/math/4aaeb3aafa05a9ad54c8d7da4e4aecad4dfac1cd.png" style="height: 13px;" />, the
derivative of their composition using the multivariate chain rule is:</p>
<img alt="\[D(f \circ g)(a)=Df(g(a))\cdot Dg(a)=f&amp;#x27;(g(a))g&amp;#x27;(a)\]" class="align-center" src="../../images/math/98e554584c9d2d967b9a6759a64126093ef704ce.png" style="height: 20px;" />
<p>Which is precisely the single-variable chain rule. This results from matrix
multiplication between two 1x1 matrices, which ends up being just the product
of their single entries.</p>
</div>
<div class="section" id="appendix-proving-the-single-variable-chain-rule">
<h2>Appendix: proving the single-variable chain rule</h2>
<p>It turns out that many online resources (including Khan Academy) provide a
flawed proof for the chain rule. It's flawed due to a careless division by a
quantity that may be zero. This flaw can be corrected by making the proof
somewhat more complicated; I won't take that road here - for details see
Spivak's <em>Calculus</em>. Instead, I'll present a simpler proof inspired by the one I
found at <a class="reference external" href="http://math.rice.edu/~cjd/">Casey Douglas's site</a>.</p>
<p>We want to prove that:</p>
<img alt="\[(f \circ g)&amp;#x27;(x)={f}&amp;#x27;(g(x)){g}&amp;#x27;(x)\]" class="align-center" src="../../images/math/29f4194c9af3777ae55a15dad972a145eb7797be.png" style="height: 20px;" />
<p>Note that previously we defined derivatives at some concrete point <img alt="x_0" class="valign-m3" src="../../images/math/efbda784ad565c1c5201fdc948a570d0426bc6e6.png" style="height: 11px;" />.
Here for the sake of brevity I'll just use <img alt="x" class="valign-0" src="../../images/math/11f6ad8ec52a2984abaafd7c3b516503785c2072.png" style="height: 8px;" /> as an arbitrary point,
assuming the derivative exists.</p>
<p>Let's start with the definition of <img alt="g&amp;#x27;(x)" class="valign-m4" src="../../images/math/5fba18e1364e151399f95daac5ed63f09feba9b7.png" style="height: 18px;" />:</p>
<img alt="\[{g}&amp;#x27;(x)=\lim_{h \to 0}\frac{g(x+h)-g(x)}{h}\]" class="align-center" src="../../images/math/c19f7ddc43c3046489d7e012c3f213403edf7e8a.png" style="height: 39px;" />
<p>We can reorder it as follows:</p>
<img alt="\[\lim_{h \to 0}\left [ \frac{g(x+h)-g(x)}{h} - g&amp;#x27;(x) \right ] = 0\]" class="align-center" src="../../images/math/74a651394036af8aeaba69650dba26ccb4f90ae7.png" style="height: 43px;" />
<p>Let's give the part in the brackets the name <img alt="\Delta g(x)" class="valign-m4" src="../../images/math/ba109afb4d6264ec2d39fe025fcc5a1dbc58637f.png" style="height: 18px;" />.</p>
<p>Similarly, if the function <em>f</em> is differentiable at the point <img alt="a=g(x)" class="valign-m4" src="../../images/math/01bcc664dda02e9d98a5f37104ff028cf8fd0d62.png" style="height: 18px;" />,
we have:</p>
<img alt="\[f&amp;#x27;(a)=\lim_{k \to 0}\frac{f(a+k)-f(a)}{k}\]" class="align-center" src="../../images/math/59daea2a46cd244229625131297a773820501571.png" style="height: 39px;" />
<p>We reorder:</p>
<img alt="\[\lim_{k \to 0}\left [ \frac{f(a+k)-f(a)}{k} - f&amp;#x27;(a) \right ] = 0\]" class="align-center" src="../../images/math/4600064fad365f360bd73063324a935a8b73266f.png" style="height: 43px;" />
<p>And call the part in the brackets <img alt="\Delta f(a)" class="valign-m4" src="../../images/math/a85d05996c54eec8a9bef9a60f8e7e4f3231aa51.png" style="height: 18px;" />. The choice of the
variable used to go to zero: <em>k</em> instead of <em>h</em> is arbitrary and is useful to
simplify the discussion that follows.</p>
<p>Let's reorder the definition of <img alt="\Delta g(x)" class="valign-m4" src="../../images/math/ba109afb4d6264ec2d39fe025fcc5a1dbc58637f.png" style="height: 18px;" /> a bit:</p>
<img alt="\[g(x+h)=g(x)+[g&amp;#x27;(x)+\Delta g(x)]h\]" class="align-center" src="../../images/math/59e0263f8a2ebfc0fac9a2b51f42c651b359fe31.png" style="height: 21px;" />
<p>We can apply <em>f</em> to both sides:</p>
<img alt="\[\begin{equation} f(g(x+h))=f(g(x)+[g&amp;#x27;(x)+\Delta g(x)]h) \tag{1} \end{equation}\]" class="align-center" src="../../images/math/3b82da9d6cad509490e687b9e86093791545ea81.png" style="height: 21px;" />
<p>By reordering the definition of <img alt="\Delta f(a)" class="valign-m4" src="../../images/math/a85d05996c54eec8a9bef9a60f8e7e4f3231aa51.png" style="height: 18px;" /> we get:</p>
<img alt="\[\begin{equation} f(a+k)=f(a)+[f&amp;#x27;(a)+\Delta f(a)]k \tag{2} \end{equation}\]" class="align-center" src="../../images/math/88c5b43f3ba89da3853be9342381aa8dd60e024f.png" style="height: 21px;" />
<p>Now taking the right-hand side of (1), we can look at it as <img alt="f(a+k)" class="valign-m4" src="../../images/math/831a544de22e2a6a8997413b576a67391ba31f53.png" style="height: 18px;" />
since <img alt="a=g(x)" class="valign-m4" src="../../images/math/01bcc664dda02e9d98a5f37104ff028cf8fd0d62.png" style="height: 18px;" /> and we can define <img alt="k=[g&amp;#x27;(x)+\Delta g(x)]h" class="valign-m5" src="../../images/math/ed49f313283b8f266ffd1e9b4194c36f456a950d.png" style="height: 19px;" />. We still
have <em>k</em> going to zero when <em>h</em> goes to zero. Assigning these <em>a</em> and <em>k</em> into
(2) we get:</p>
<img alt="\[f(a+k)=f(g(x))+[f&amp;#x27;(g(x))+\Delta f(g(x))][g&amp;#x27;(x)+\Delta g(x)]h\]" class="align-center" src="../../images/math/275b3323c68b711b2458e4c748a887a368e32a40.png" style="height: 21px;" />
<p>So, starting from (1) again, we have:</p>
<img alt="\[\begin{align*} f(g(x+h))&amp;amp;=f(a+k) \\          &amp;amp;=f(g(x))+[f&amp;#x27;(g(x))+\Delta f(g(x))][g&amp;#x27;(x)+\Delta g(x)]h \end{align*}\]" class="align-center" src="../../images/math/82e67cf24d9eb3dad58e7d30cd89ba1c19e367fb.png" style="height: 45px;" />
<p>Subtracting <img alt="f(g(x))" class="valign-m4" src="../../images/math/92cb7139e348ea05a69782b2cf7221bae86a2b03.png" style="height: 18px;" /> from both sides and dividing by <em>h</em> (which is legal,
since <em>h</em> is not zero, it's just very small) we get:</p>
<img alt="\[\frac{f(g(x+h))-f(g(x))}{h}=[f&amp;#x27;(g(x))+\Delta f(g(x))][g&amp;#x27;(x)+\Delta g(x)]\]" class="align-center" src="../../images/math/bfdfef3d46b471aa5d6803c3c5a6b5e26ffe3b37.png" style="height: 39px;" />
<p>Apply a limit to both sides:</p>
<img alt="\[\lim_{h \to 0} \frac{f(g(x+h))-f(g(x))}{h}= \lim_{h \to 0} [f&amp;#x27;(g(x))+\Delta f(g(x))][g&amp;#x27;(x)+\Delta g(x)]\]" class="align-center" src="../../images/math/0f5c316fcc2877f78b8a739898a31120471dd401.png" style="height: 39px;" />
<p>Now recall that both <img alt="\Delta f(g(x))" class="valign-m4" src="../../images/math/6752886c71e1a95dc360dd4e5ea10dd0b6f76e84.png" style="height: 18px;" /> and <img alt="\Delta g(x)" class="valign-m4" src="../../images/math/ba109afb4d6264ec2d39fe025fcc5a1dbc58637f.png" style="height: 18px;" /> go to 0 when
<em>h</em> goes to 0. Taking this into account, we get:</p>
<img alt="\[\lim_{h \to 0} \frac{f(g(x+h))-f(g(x))}{h}= f&amp;#x27;(g(x))g&amp;#x27;(x)\]" class="align-center" src="../../images/math/3954d8d23c8fb53d4cd1732d19939d650ef830ae.png" style="height: 39px;" />
<p><em>Q.E.D.</em></p>
<hr class="docutils" />
<table class="docutils footnote" frame="void" id="footnote-1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#footnote-reference-1">[1]</a></td><td>Here, as in the rest of the post, I'm being careless with the usage of
<img alt="\lim" class="valign-0" src="../../images/math/6f5c7776306147fe3be3e4b8547a23c62eafddf4.png" style="height: 13px;" />, sometimes leaving its existence to be implicit. In general,
wherever <em>h</em> appears in a formula we know there's a
<img alt="\lim_{h \to 0}" class="valign-m4" src="../../images/math/0f10af054e5ddc3b9603098fec294e0247190efa.png" style="height: 17px;" /> there, whether explicitly or not.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="footnote-2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#footnote-reference-2">[2]</a></td><td>An alternative way to think about it is: suppose the functions
<em>f</em> and <em>g</em> are linear: <img alt="f(x)=ax+b" class="valign-m4" src="../../images/math/a85393d5068f5c4bc36ff7efed535a8f1a686848.png" style="height: 18px;" /> and <img alt="g(x)=cx+d" class="valign-m4" src="../../images/math/6d712cb582caa0e48a2b029ea4ae29a3e5e40f27.png" style="height: 18px;" />. Then
the chain rule is trivially true. But now recall what the derivative is.
The derivative at some point <img alt="x_0" class="valign-m3" src="../../images/math/efbda784ad565c1c5201fdc948a570d0426bc6e6.png" style="height: 11px;" /> is the best linear approximation
for the function at that point. Therefore the chain rule is true for any
pair of differentiable functions - even when the functions are not
linear, we approximate their rate of change in an infinitisemal area
around <img alt="x_0" class="valign-m3" src="../../images/math/efbda784ad565c1c5201fdc948a570d0426bc6e6.png" style="height: 11px;" /> with a linear function.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="footnote-3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#footnote-reference-3">[3]</a></td><td>The condition for <em>f</em> being differentiable at <em>a</em> is stronger than simply
saying that all partial derivatives exist at <em>a</em>, but I won't spend more
time on this subtlety here.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="footnote-4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#footnote-reference-4">[4]</a></td><td>As an exercise, verify that the matrix dimensions of <img alt="Df" class="valign-m4" src="../../images/math/5c6bf530660cba6530e83a86f0ed49fe0821d179.png" style="height: 16px;" /> and
<object class="valign-m4" data="../../images/math/38b655437da0880bd70168fcbadb50ebdbf46ca5.svg" style="height: 16px;" type="image/svg+xml">Dg</object> make this multiplication valid.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="footnote-5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#footnote-reference-5">[5]</a></td><td>It shouldn't be surprising we get here, since the definition of the
directional derivative as the gradient <a class="reference external" href="../understanding-gradient-descent.html">was derived</a>
using the multivariate chain rule.</td></tr>
</tbody>
</table>
</div>

            </div>
            <!-- /.entry-content -->
<hr/>
<div class="dotted-links">
<p class="align-center">
For comments, please send me
<a href="mailto:eliben@gmail.com"><i class="fa fa-envelope-o"></i> an email</a>.
</p>
</div>        </article>
    </section>

    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">
            &copy; 2003-2025 Eli Bendersky
         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://code.jquery.com/jquery-2.2.4.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="../../theme/js/bootstrap.min.js"></script>

<!--
  Using goatcounter to count visitors. The count.js script is vendored in.
-->
<script data-goatcounter="https://stats.thegreenplace.net/count"
        async src="../../theme/js/count.js"></script>
</body>

<!-- Mirrored from eli.thegreenplace.net/2016/the-chain-rule-of-calculus/ by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 16 Feb 2025 23:53:06 GMT -->
</html>