<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">

<!-- Mirrored from eli.thegreenplace.net/2022/serving-static-files-and-web-apps-in-go/ by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 16 Feb 2025 23:50:12 GMT -->
<head>
    <title>Serving static files and web apps in Go - Eli Bendersky's website</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="../../favicon.ico" rel="icon">

    <!-- Bootstrap -->
        <link rel="stylesheet" href="../../theme/css/bootstrap.min.css" type="text/css"/>
    <link href="../../theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="../../theme/css/pygments/vs.css" rel="stylesheet">
    <link rel="stylesheet" href="../../theme/css/style.css" type="text/css"/>

        <link href="../../feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Eli Bendersky's website ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="../../index.html" class="navbar-brand">
                <img src="../../images/logosmall.png" width="32" height="32"/>
Eli Bendersky's website            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="../../pages/about.html">
                        <i class="fa fa-question"></i>
                        <span class="icon-label">About</span>
                    </a>
                </li>
                <li>
                    <a href="../../pages/projects.html">
                        <i class="fa fa-github"></i>
                        <span class="icon-label">Projects</span>
                    </a>
                </li>
                <li>
                    <a href="../../archives/all.html">
                        <i class="fa fa-th-list"></i>
                        <span class="icon-label">Archives</span>
                    </a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<div class="container">
    <div class="row">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="index.html"
                       rel="bookmark"
                       title="Permalink to Serving static files and web apps in Go">
                        Serving static files and web apps in Go
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="published">
        <i class="fa fa-calendar"></i>
        <time> October 01, 2022 at 09:41</time>
    </span>
<span class="label label-default">Tags</span>
    <a href="../../tag/go.html">Go</a>
        ,
    <a href="../../tag/network-programming.html">Network Programming</a>
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>Go is a great language to write HTTP servers in, often using just the <a class="reference external" href="../../2021/rest-servers-in-go-part-1-standard-library/index.html">included
batteries</a>.
This post shows a few examples of Go servers that serve
<em>static</em> content. The examples range from a very simple purely static file
server to a fairly complete web application bundled into a single Go program.</p>
<div class="section" id="basic-file-server">
<h2>#1: Basic file server</h2>
<p>For servers #1, #2 and #3, we'll assume that the following <tt class="docutils literal">files</tt> directory
tree is in the current working directory where the server is invoked:</p>
<div class="highlight"><pre><span></span>$ tree files
files
├── file1.txt
├── file2.txt
└── subdir
    └── file1.txt
</pre></div>
<p>(the full code for these servers, along with the sample directory, is available
<a class="reference external" href="https://github.com/eliben/code-for-blog/tree/main/2022/go-static-http-server">on GitHub</a>)</p>
<p>A basic static server that serves files from the local filesystem is
ridiculously simple to write in Go:</p>
<div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nx">main</span><span class="w"></span>

<span class="kn">import</span><span class="w"> </span><span class="s">&quot;net/http&quot;</span><span class="w"></span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nx">port</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;:9999&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nx">handler</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">FileServer</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">Dir</span><span class="p">(</span><span class="s">&quot;files&quot;</span><span class="p">))</span><span class="w"></span>
<span class="w">  </span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span><span class="w"> </span><span class="nx">handler</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
<p>This is it. Really! It serves the <tt class="docutils literal">files</tt> directory at the root route of the
server (<tt class="docutils literal">/</tt>). If we run this server and open the browser to
<tt class="docutils literal">localhost:9999</tt>, we'll see the following:</p>
<img alt="Listing of files directory from the basic file server" class="align-center" src="../../images/2022/localhost-basic-file-server.png" />
<p>When the server gets a request for a path that matches a directory, it serves a
simple listing of the directory's contents; we can also observe this with
<tt class="docutils literal">curl</tt>:</p>
<div class="highlight"><pre><span></span>$ curl localhost:9999/
&lt;pre&gt;
&lt;a href=&quot;file1.txt&quot;&gt;file1.txt&lt;/a&gt;
&lt;a href=&quot;file2.txt&quot;&gt;file2.txt&lt;/a&gt;
&lt;a href=&quot;subdir/&quot;&gt;subdir/&lt;/a&gt;
&lt;/pre&gt;
</pre></div>
<p>When it gets a request for a path matching a file, it serves that file
(while trying to provide the right HTTP MIME type based on the file's contents):</p>
<div class="highlight"><pre><span></span>$ curl localhost:9999/file2.txt
hello in file 2
</pre></div>
<p>Check out my <a class="reference external" href="https://github.com/eliben/static-server">static-server</a> project
for this functionality shrink-wrapped in a Go command you can install or run
with a single shell line.</p>
</div>
<div class="section" id="serving-files-on-a-different-route">
<h2>#2: Serving files on a different route</h2>
<p>The default <tt class="docutils literal">FileServer</tt> serves filesystem contents on the root
route <tt class="docutils literal">/</tt>. But what if that's not what we want; suppose we want to serve them
with some prefix, like <tt class="docutils literal">localhost:9999/static</tt>? We can set up a handler for
that path with:</p>
<div class="highlight"><pre><span></span><span class="nx">http</span><span class="p">.</span><span class="nx">Handle</span><span class="p">(</span><span class="s">&quot;/static/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">handler</span><span class="p">)</span><span class="w"></span>
<span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span><span class="w"></span>
</pre></div>
<p>Unfortunately, this will not work out of the box, because the <tt class="docutils literal">FileServer</tt>
will get requests for files like <tt class="docutils literal">static/file2.txt</tt>, but there's no local
directory called <tt class="docutils literal">static</tt>. To address this use case, the <tt class="docutils literal">http</tt> package
provides the <tt class="docutils literal">StripPrefix</tt> function. It's an interesting example of
<em>middleware</em>, since it wraps an HTTP handler and returns another handler that
adjusts its behavior. The complete server using this approach is:</p>
<div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nx">main</span><span class="w"></span>

<span class="kn">import</span><span class="w"> </span><span class="s">&quot;net/http&quot;</span><span class="w"></span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nx">port</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;:9999&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nx">handler</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StripPrefix</span><span class="p">(</span><span class="s">&quot;/static/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">FileServer</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">Dir</span><span class="p">(</span><span class="s">&quot;files&quot;</span><span class="p">)))</span><span class="w"></span>
<span class="w">  </span><span class="nx">http</span><span class="p">.</span><span class="nx">Handle</span><span class="p">(</span><span class="s">&quot;/static/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">handler</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
<p>What happens here is that we serve the contents of the <tt class="docutils literal">files</tt> directory in
the <tt class="docutils literal">static/</tt> route, but use <tt class="docutils literal">StripPrefix</tt> to remove the actual <tt class="docutils literal">static/</tt>
prefix from requests made to the file server. So all requests to
<tt class="docutils literal"><span class="pre">localhost:9999/static/&lt;somepath&gt;</span></tt> will actually be sent as <tt class="docutils literal">&lt;somepath&gt;</tt> to
the <tt class="docutils literal">FileServer</tt> serving from <tt class="docutils literal">files</tt>, and all is well. Here's a sample <tt class="docutils literal">curl</tt>
interaction with this server:</p>
<div class="highlight"><pre><span></span>$ curl localhost:9999/static/file2.txt
hello in file 2

$ curl localhost:9999/static/subdir/
&lt;pre&gt;
&lt;a href=&quot;file1.txt&quot;&gt;file1.txt&lt;/a&gt;
&lt;/pre&gt;
</pre></div>
</div>
<div class="section" id="static-and-dynamic-content">
<h2>#3: Static and dynamic content</h2>
<p>So far the servers we've seen only serve &quot;static&quot; filesystem content, and
<tt class="docutils literal">FileServer</tt> takes over the entire HTTP routing in the server.</p>
<p>But it's also fairly simple to combine serving static content with dynamic
content - where a Go function responds to HTTP requests programmatically. This
is our third sample server:</p>
<div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nx">main</span><span class="w"></span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">  </span><span class="s">&quot;fmt&quot;</span><span class="w"></span>
<span class="w">  </span><span class="s">&quot;net/http&quot;</span><span class="w"></span>
<span class="w">  </span><span class="s">&quot;time&quot;</span><span class="w"></span>
<span class="p">)</span><span class="w"></span>

<span class="kd">func</span><span class="w"> </span><span class="nx">timeHandler</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprint</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">Format</span><span class="p">(</span><span class="s">&quot;02 Jan 2006 15:04:05 MST&quot;</span><span class="p">))</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nx">port</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;:9999&quot;</span><span class="w"></span>

<span class="w">  </span><span class="nx">fileHandler</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StripPrefix</span><span class="p">(</span><span class="s">&quot;/static/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">FileServer</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">Dir</span><span class="p">(</span><span class="s">&quot;files&quot;</span><span class="p">)))</span><span class="w"></span>
<span class="w">  </span><span class="nx">http</span><span class="p">.</span><span class="nx">Handle</span><span class="p">(</span><span class="s">&quot;/static/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">fileHandler</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/time&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">timeHandler</span><span class="p">)</span><span class="w"></span>

<span class="w">  </span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
<p>In addition to serving the <tt class="docutils literal">files</tt> folder in the <tt class="docutils literal">/static/</tt> route, this
server also responds dynamically to <tt class="docutils literal">/time</tt>; this is served from our
<tt class="docutils literal">timeHandler</tt> function and provides the current server time.</p>
<div class="highlight"><pre><span></span>$ curl localhost:9999/time
27 Sep 2022 18:21:30 PDT

$ curl localhost:9999/static/subdir/
&lt;pre&gt;
&lt;a href=&quot;file1.txt&quot;&gt;file1.txt&lt;/a&gt;
&lt;/pre&gt;

$ curl localhost:9999/time
27 Sep 2022 18:21:39 PDT
</pre></div>
</div>
<div class="section" id="serving-a-complete-web-application">
<h2>#4: Serving a complete web application</h2>
<p>A dynamic web application typically consists of a server component and a client
component. The client component is a mix of HTML, CSS and JavaScript files
typically served from the server's filesystem and interpreted by the user's
browser. The server component is any number of functions responding to specific
HTTP routes for the JS in the client to communicate with.</p>
<p>The previous example gives us all the foundations we need to serve a complete
web application from Go; the full code for this sample <a class="reference external" href="https://github.com/eliben/code-for-blog/tree/main/2022/go-static-http-serve-app">is here</a>.</p>
<p>Our application has the following file structure:</p>
<div class="highlight"><pre><span></span>$ tree
.
├── go.mod
├── public
│   ├── css
│   │   └── style.css
│   ├── index.html
│   └── js
│       └── timescript.js
└── server.go
</pre></div>
<p>The server component is in <tt class="docutils literal">server.go</tt>; the client component is in the
<tt class="docutils literal">public</tt> directory (it's called &quot;public&quot; because it's visible to the users in
their browser via &quot;View page source&quot;, dev tools etc.)</p>
<p>Here's the complete server:</p>
<div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nx">main</span><span class="w"></span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">  </span><span class="s">&quot;fmt&quot;</span><span class="w"></span>
<span class="w">  </span><span class="s">&quot;log&quot;</span><span class="w"></span>
<span class="w">  </span><span class="s">&quot;net/http&quot;</span><span class="w"></span>
<span class="w">  </span><span class="s">&quot;time&quot;</span><span class="w"></span>
<span class="p">)</span><span class="w"></span>

<span class="kd">func</span><span class="w"> </span><span class="nx">timeHandler</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprint</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">Format</span><span class="p">(</span><span class="s">&quot;02 Jan 2006 15:04:05 MST&quot;</span><span class="p">))</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/time&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">timeHandler</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="nx">http</span><span class="p">.</span><span class="nx">Handle</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">FileServer</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">Dir</span><span class="p">(</span><span class="s">&quot;public/&quot;</span><span class="p">)))</span><span class="w"></span>

<span class="w">  </span><span class="nx">port</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;:9999&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">))</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
<p>It does two things:</p>
<ol class="arabic simple">
<li>Serves the client side of the application from the file system in the
root route <tt class="docutils literal">/</tt>.</li>
<li>Serves a dynamic server function providing the current time on the <tt class="docutils literal">/time</tt>
route.</li>
</ol>
<p>The HTML is:</p>
<div class="highlight"><pre><span></span>&lt;html&gt;
 &lt;head&gt;
   &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/css/style.css&quot;&gt;
 &lt;/head&gt;
 &lt;body&gt;
   &lt;h2&gt;System clock (updates every second)&lt;/h2&gt;
   &lt;div id=&quot;output&quot;&gt;&lt;/div&gt;
   &lt;script src=&quot;/js/timescript.js&quot;&gt;&lt;/script&gt;
 &lt;/body&gt;
&lt;/html&gt;
</pre></div>
<p>And the JS code is:</p>
<div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="nx">outputBox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#output&#39;</span><span class="p">);</span><span class="w"></span>

<span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;DOMContentLoaded&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nx">outputBox</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;initializing...&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="nx">tick</span><span class="p">();</span><span class="w"></span>
<span class="w">  </span><span class="nx">setInterval</span><span class="p">(</span><span class="nx">tick</span><span class="p">,</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span><span class="w"></span>
<span class="p">});</span><span class="w"></span>

<span class="kd">function</span><span class="w"> </span><span class="nx">tick</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/time&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;error response&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">text</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">})</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">text</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nx">outputBox</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">text</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">})</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nx">outputBox</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;network error&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">});</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
<p>As you can see, it uses the <tt class="docutils literal">fetch</tt> API to communicate with the server (in
the past this would be called an &quot;AJAX request&quot;). It sets an interval to send
a request to the server's <tt class="docutils literal">/time</tt> route every second, and updates the UI
with the new time.</p>
<p>If we run the server locally and open a browser to <tt class="docutils literal">localhost:9999</tt>, we'll
see:</p>
<img alt="Screenshot of browser looking at our app showing time" class="align-center" src="../../images/2022/clock-app-screenshot.png" />
<p>This is a single screenshot - if you run the server you'll actually see the
clock &quot;ticking&quot; by updating its time every second.</p>
</div>
<div class="section" id="embedding-static-content-into-the-server-s-binary">
<h2>#5: Embedding static content into the server's binary</h2>
<p>The previous sample shows how to run a complete web application from a Go
server. There's just one snag. When the server is run, it expects to find the
<tt class="docutils literal">public</tt> directory in the current working directory, so the two have to be
shipped around together (even when the server is built to be a binary). Wouldn't
it be nice if we could avoid this hassle and have everything we need stuffed
into the server's binary, so it would be the only thing for us to carry around?</p>
<p>With Go's <tt class="docutils literal">embed</tt> package, this turns out to be very simple! In this sample
(<a class="reference external" href="https://github.com/eliben/code-for-blog/tree/main/2022/go-static-http-serve-app-embed">full code</a>),
the directory structure remains the same, as do all the files in the <tt class="docutils literal">public</tt>
directory. The only change is in the server code, and it's a small one:</p>
<div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nx">main</span><span class="w"></span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">  </span><span class="s">&quot;embed&quot;</span><span class="w"></span>
<span class="w">  </span><span class="s">&quot;fmt&quot;</span><span class="w"></span>
<span class="w">  </span><span class="s">&quot;io/fs&quot;</span><span class="w"></span>
<span class="w">  </span><span class="s">&quot;log&quot;</span><span class="w"></span>
<span class="w">  </span><span class="s">&quot;net/http&quot;</span><span class="w"></span>
<span class="w">  </span><span class="s">&quot;time&quot;</span><span class="w"></span>
<span class="p">)</span><span class="w"></span>

<span class="c1">//go:embed public</span><span class="w"></span>
<span class="kd">var</span><span class="w"> </span><span class="nx">public</span><span class="w"> </span><span class="nx">embed</span><span class="p">.</span><span class="nx">FS</span><span class="w"></span>

<span class="kd">func</span><span class="w"> </span><span class="nx">timeHandler</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprint</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">Format</span><span class="p">(</span><span class="s">&quot;02 Jan 2006 15:04:05 MST&quot;</span><span class="p">))</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="c1">// We want to serve static content from the root of the &#39;public&#39; directory,</span><span class="w"></span>
<span class="w">  </span><span class="c1">// but go:embed will create a FS where all the paths start with &#39;public/...&#39;.</span><span class="w"></span>
<span class="w">  </span><span class="c1">// Using fs.Sub we &quot;cd&quot; into &#39;public&#39; and can serve files relative to it.</span><span class="w"></span>
<span class="w">  </span><span class="nx">publicFS</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">Sub</span><span class="p">(</span><span class="nx">public</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;public&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/time&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">timeHandler</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="nx">http</span><span class="p">.</span><span class="nx">Handle</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">FileServer</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">FS</span><span class="p">(</span><span class="nx">publicFS</span><span class="p">)))</span><span class="w"></span>

<span class="w">  </span><span class="nx">port</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;:9999&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">))</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
<p>Instead of serving the local filesystem on the <tt class="docutils literal">/</tt> route, we instead <em>embed</em>
the <tt class="docutils literal">public</tt> directory into our binary and use Go's virtual filesystem adapter
to serve it. This server behaves similarly to the previous one, but it does not
require the <tt class="docutils literal">public</tt> directory to be next to its binary any more - this
directory is instead <em>embedded into</em> the binary. It still needs to be on disk
when the binary is <em>built</em>, of course, but not when it's <em>run</em>. So we've built a
complete web application into a single Go binary.</p>
</div>
<div class="section" id="streaming-the-client-code-directly-from-the-server">
<h2>#6: Streaming the client code directly from the server</h2>
<p>For completeness, I want to demonstrate yet another technique to run the same
web application we've covered in the previous two samples. We can also stream
all the client code directly from a server's handler, without having anything in
separate files. The full sample code <a class="reference external" href="https://github.com/eliben/code-for-blog/blob/main/2022/go-static-http-server/server-with-js-fetch.go">is here</a>,
here's an excerpt:</p>
<div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nx">main</span><span class="w"></span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">  </span><span class="s">&quot;fmt&quot;</span><span class="w"></span>
<span class="w">  </span><span class="s">&quot;log&quot;</span><span class="w"></span>
<span class="w">  </span><span class="s">&quot;net/http&quot;</span><span class="w"></span>
<span class="w">  </span><span class="s">&quot;strings&quot;</span><span class="w"></span>
<span class="w">  </span><span class="s">&quot;time&quot;</span><span class="w"></span>
<span class="p">)</span><span class="w"></span>

<span class="kd">var</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">`</span>
<span class="s">&lt;html&gt;</span>
<span class="s"> &lt;head&gt;</span>
<span class="s"> // ...</span>
<span class="s"> // ... the rest of our HTML, CSS and JS code</span>
<span class="s"> // ...</span>
<span class="s"> &lt;/body&gt;</span>
<span class="s">&lt;/html&gt;</span>
<span class="s">`</span><span class="w"></span>

<span class="kd">func</span><span class="w"> </span><span class="nx">rootHandler</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="c1">// The root handler &quot;/&quot; matches every path that wasn&#39;t match by other</span><span class="w"></span>
<span class="w">  </span><span class="c1">// matchers, so we have to further filter it here. Only accept actual root</span><span class="w"></span>
<span class="w">  </span><span class="c1">// paths.</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="nx">path</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Trim</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">Path</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p">);</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nx">http</span><span class="p">.</span><span class="nx">NotFound</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprint</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">page</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kd">func</span><span class="w"> </span><span class="nx">timeHandler</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprint</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">Format</span><span class="p">(</span><span class="s">&quot;02 Jan 2006 15:04:05 MST&quot;</span><span class="p">))</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/time&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">timeHandler</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rootHandler</span><span class="p">)</span><span class="w"></span>

<span class="w">  </span><span class="nx">port</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;:9999&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">))</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
<p>Here we don't use a static server component at all, but rather dump the entire
HTML+CSS+JS back in a HTTP response to the <tt class="docutils literal">/</tt> route.</p>
<p>I'm showing this sample for completeness; I don't actually think it's a great
idea to structure web applications in Go, but who knows - this could be useful
in some scenarios. For anything non-trivial, I would recommend the embedding
approach outlined in #5.</p>
</div>
<div class="section" id="injecting-custom-headers-using-middleware">
<h2>#7: Injecting custom headers using middleware</h2>
<p>Sometimes we need to inject custom headers into our HTTP responses when serving
static files; for example, we may want to enable CORS for our front-end. This
is easy to accomplish in Go using middleware. Here's the very first - basic -
file server with CORS headers enabled on every response:</p>
<div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nx">main</span><span class="w"></span>

<span class="kn">import</span><span class="w"> </span><span class="s">&quot;net/http&quot;</span><span class="w"></span>

<span class="kd">func</span><span class="w"> </span><span class="nx">addCORS</span><span class="p">(</span><span class="nx">next</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">Handler</span><span class="p">)</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">Handler</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;Cross-Origin-Embedder-Policy&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;require-corp&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;Cross-Origin-Opener-Policy&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;same-origin&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="nx">next</span><span class="p">.</span><span class="nx">ServeHTTP</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">req</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">})</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nx">port</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;:9999&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nx">handler</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">addCORS</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">FileServer</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">Dir</span><span class="p">(</span><span class="s">&quot;files&quot;</span><span class="p">)))</span><span class="w"></span>
<span class="w">  </span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span><span class="w"> </span><span class="nx">handler</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
<p>Because in Go <tt class="docutils literal">http.Handler</tt>s are composable, middleware is easy to
write using <a class="reference external" href="../../2023/building-abstractions-using-higher-order-functions/index.html">higher-order functions</a>.
<tt class="docutils literal">addCORS</tt> wraps the given HTTP handler (in this case <tt class="docutils literal">http.FileServer</tt>)
such that some headers are added to every response.</p>
</div>

            </div>
            <!-- /.entry-content -->
<hr/>
<div class="dotted-links">
<p class="align-center">
For comments, please send me
<a href="mailto:eliben@gmail.com"><i class="fa fa-envelope-o"></i> an email</a>.
</p>
</div>        </article>
    </section>

    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">
            &copy; 2003-2025 Eli Bendersky
         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://code.jquery.com/jquery-2.2.4.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="../../theme/js/bootstrap.min.js"></script>

<!--
  Using goatcounter to count visitors. The count.js script is vendored in.
-->
<script data-goatcounter="https://stats.thegreenplace.net/count"
        async src="../../theme/js/count.js"></script>
</body>

<!-- Mirrored from eli.thegreenplace.net/2022/serving-static-files-and-web-apps-in-go/ by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 16 Feb 2025 23:50:12 GMT -->
</html>