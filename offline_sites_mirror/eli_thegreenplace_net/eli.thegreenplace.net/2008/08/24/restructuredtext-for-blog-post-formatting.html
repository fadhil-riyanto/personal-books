<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">

<!-- Mirrored from eli.thegreenplace.net/2008/08/24/restructuredtext-for-blog-post-formatting by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 17 Feb 2025 00:11:05 GMT -->
<head>
    <title>reStructuredText for blog post formatting - Eli Bendersky's website</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="../../../favicon.ico" rel="icon">

    <!-- Bootstrap -->
        <link rel="stylesheet" href="../../../theme/css/bootstrap.min.css" type="text/css"/>
    <link href="../../../theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="../../../theme/css/pygments/vs.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../theme/css/style.css" type="text/css"/>

        <link href="../../../feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Eli Bendersky's website ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="../../../index.html" class="navbar-brand">
                <img src="../../../images/logosmall.png" width="32" height="32"/>
Eli Bendersky's website            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="../../../pages/about.html">
                        <i class="fa fa-question"></i>
                        <span class="icon-label">About</span>
                    </a>
                </li>
                <li>
                    <a href="../../../pages/projects.html">
                        <i class="fa fa-github"></i>
                        <span class="icon-label">Projects</span>
                    </a>
                </li>
                <li>
                    <a href="../../../archives/all.html">
                        <i class="fa fa-th-list"></i>
                        <span class="icon-label">Archives</span>
                    </a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<div class="container">
    <div class="row">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="restructuredtext-for-blog-post-formatting.html"
                       rel="bookmark"
                       title="Permalink to reStructuredText for blog post formatting">
                        reStructuredText for blog post formatting
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="published">
        <i class="fa fa-calendar"></i>
        <time> August 24, 2008 at 19:58</time>
    </span>
<span class="label label-default">Tags</span>
    <a href="../../../tag/blogging.html">Blogging</a>
        ,
    <a href="../../../tag/software-tools.html">Software & Tools</a>
</footer><!-- /.post-info -->                    </div>
                </div>
                
        <p>This post documents my transition from Textile to reStructuredText, with Pygments for source code highlighting.</p>
<div class="section" id="leaving-textile">
<h3>Leaving Textile</h3>
<p>When I got tired banging in HTML code for my blog posts, I <a class="reference external" href="../../../2007/10/27/textile-a-simple-markup-language-for-the-web/index.html">found Textile</a> as a friendlier solution.</p>
<p>However, I'm finally fed-up with Textile, for several reasons:</p>
<ol class="arabic simple">
<li>No implementation does <em>exactly</em> what I want, and tweaking is essential. But textile implementations were not designed for tweaking, so making them fit your needs is a painful experience.</li>
<li>Since I'm lately into Python, I've been recently using pytextile, which turned out to be a particularly bad implementation <a class="footnote-reference" href="#id5" id="id1">[1]</a>.</li>
<li>The source code formatting (in &lt;pre&gt; blocks) of the textile processors kept clashing with Wordpress</li>
</ol>
<p>And, looking for a better solution, I ran into reStructuredText, which is part of the <a class="reference external" href="http://docutils.sourceforge.net/">docutils</a> package.</p>
</div>
<div class="section" id="restructuredtext-rest">
<h3>reStructuredText (reST)</h3>
<p>reStructuredText has a few immediate benefits over Textile:</p>
<ol class="arabic simple">
<li>It is being developed very actively. A few busy mailing lists is always a good sign of healthy development activity.</li>
<li>The main implementation is in Python</li>
<li>reStructuredText is considered to be a quasi-standard tool in the Python world, and is being used to format docstrings and even PEPs</li>
<li>Its architecture is designed to be hackable and extensible from the ground up, and the documentation is very extensive and detailed.</li>
<li>reStructuredText is suitable for more complex tasks than simple formatting. It can be used to format whole documents, with hyper-linked sections and a table of contents. The certainly &quot;eat their own dog food&quot; - the whole stack of documentation (and there's a lot of it) is formatted with reStructuredText</li>
</ol>
</div>
<div class="section" id="installing-rest">
<h3>Installing reST</h3>
<p>Installation was a snap. I've downloaded <tt class="docutils literal"><span class="pre">docutils</span></tt>, followed the installation instructions and was up and running in 2 minutes. <tt class="docutils literal"><span class="pre">docutils</span></tt> installs a few useful scripts into the <tt class="docutils literal"><span class="pre">scripts</span></tt> installation directory of Python, and these can be used to turn text into various formats - HTML, XML, Latex, etc.</p>
<p>In principle, reST is similar to Textile, and learning it was very easy. It took me less than an hour to whip up a sample document for myself that contains all the types of formatting I ever use for my blog posts. From a cursory glance, reST seems to be more powerful than Textile in several ways, providing more options. It is a tad less lightweight <a class="footnote-reference" href="#id6" id="id2">[2]</a>, but I think this is for a good purpose - Textile's lightness is the cause of the bad quality of parsers written for it.</p>
<p>The only problem I had with reST is its construct for formatting source code. It's quite easy to do (simply ident a block of text, and it will be placed in &lt;pre&gt; tags), but it wouldn't be easy to connect it with the <tt class="docutils literal"><span class="pre">wp-syntax</span></tt> Wordpress plugin I'm using to highlight code in my blog.</p>
<p>So I've decided to give Pygments a try.</p>
</div>
<div class="section" id="pygments">
<h3>Pygments</h3>
<p><a class="reference external" href="http://pygments.org/">Pygments</a> is a Python library for source code highlighting. It is widely used <a class="footnote-reference" href="#id7" id="id4">[3]</a> and respected, and best of all - can easily <a class="reference external" href="http://pygments.org/docs/rstdirective/">connect to reST</a>. After installing Pygments (just downloading from its website and following the instructions), I've modified the supplied <tt class="docutils literal"><span class="pre">external/rst-directive.py</span></tt> script for my needs, and created a generic &quot;runner script&quot; that is called with a text file as an argument, and creates from it an HTML file, formatted with reST with Pygments syntax highlighting (hooked to the <tt class="docutils literal"><span class="pre">sourcecode</span></tt> directive).</p>
<p>Here's the code of the runner script, together with my custom style class for Pygments:</p>
<div class="highlight"><pre><span style="color: #007f00"># A &#39;runner&#39; for HTML output</span>
<span style="color: #007f00"># Accepts the input file and output file names as command line</span>
<span style="color: #007f00"># arguments. Loads docutils and pygments and runs the formatter.</span>
<span style="color: #007f00">#</span>
<span style="color: #007f00"># Based on:</span>
<span style="color: #007f00">#  rst2html - from the docutils distribution</span>
<span style="color: #007f00">#  external/rst-directive.py - from the pygments distribution</span>
<span style="color: #007f00">#</span>
<span style="color: #007f00"># This code is in the public domain</span>
<span style="color: #007f00"># Eli Bendersky</span>
<span style="color: #007f00">#</span>

<span style="color: #00007f; font-weight: bold">try</span>:
    <span style="color: #00007f; font-weight: bold">import</span> <span style="color: #00007f">locale</span>
    locale.setlocale(locale.LC_ALL, <span style="color: #7f007f">&#39;&#39;</span>)
<span style="color: #00007f; font-weight: bold">except</span>:
    <span style="color: #00007f; font-weight: bold">pass</span>

<span style="color: #007f00">##</span>
<span style="color: #007f00">## Configuring Pygments</span>
<span style="color: #007f00">##</span>
<span style="color: #00007f; font-weight: bold">from</span> <span style="color: #00007f">pygments.formatters</span> <span style="color: #00007f; font-weight: bold">import</span> HtmlFormatter
<span style="color: #00007f; font-weight: bold">from</span> <span style="color: #00007f">pygments</span> <span style="color: #00007f; font-weight: bold">import</span> highlight
<span style="color: #00007f; font-weight: bold">from</span> <span style="color: #00007f">pygments.lexers</span> <span style="color: #00007f; font-weight: bold">import</span> get_lexer_by_name, TextLexer

<span style="color: #00007f; font-weight: bold">from</span> <span style="color: #00007f">pygments.style</span> <span style="color: #00007f; font-weight: bold">import</span> Style
<span style="color: #00007f; font-weight: bold">from</span> <span style="color: #00007f">pygments.token</span> <span style="color: #00007f; font-weight: bold">import</span> Keyword, Name, Comment, String, Error, \
     Number, Operator, Generic, Whitespace, Text

<span style="color: #00007f; font-weight: bold">class</span> <span style="color: #00007f">SciteStyle</span>(Style):
    default_style = <span style="color: #7f007f">&quot;&quot;</span>

    styles = {
        Whitespace:                 <span style="color: #7f007f">&#39;#bbbbbb&#39;</span>,
        Text:                       <span style="color: #7f007f">&#39;#000000&#39;</span>,

        Comment:                    <span style="color: #7f007f">&#39;#007f00&#39;</span>,

        Keyword:                    <span style="color: #7f007f">&#39;bold #00007f&#39;</span>,

        Operator.Word:              <span style="color: #7f007f">&#39;#0000aa&#39;</span>,

        Name.Builtin:               <span style="color: #7f007f">&#39;#00007f&#39;</span>,
        Name.Function:              <span style="color: #7f007f">&#39;#00007f&#39;</span>,
        Name.Class:                 <span style="color: #7f007f">&#39;#00007f&#39;</span>,
        Name.Namespace:             <span style="color: #7f007f">&#39;#00007f&#39;</span>,

        String:                     <span style="color: #7f007f">&#39;#7f007f&#39;</span>,

        Number:                     <span style="color: #7f007f">&#39;#007f7f&#39;</span>,

        Generic:                    <span style="color: #7f007f">&#39;#000000&#39;</span>,
        Generic.Heading:            <span style="color: #7f007f">&#39;bold #000080&#39;</span>,
        Generic.Subheading:         <span style="color: #7f007f">&#39;bold #800080&#39;</span>,
        Generic.Deleted:            <span style="color: #7f007f">&#39;#aa0000&#39;</span>,
        Generic.Inserted:           <span style="color: #7f007f">&#39;#00aa00&#39;</span>,
        Generic.Error:              <span style="color: #7f007f">&#39;#aa0000&#39;</span>,
        Generic.Emph:               <span style="color: #7f007f">&#39;italic&#39;</span>,
        Generic.Strong:             <span style="color: #7f007f">&#39;bold&#39;</span>,
        Generic.Prompt:             <span style="color: #7f007f">&#39;#555555&#39;</span>,
        Generic.Output:             <span style="color: #7f007f">&#39;#888888&#39;</span>,
        Generic.Traceback:          <span style="color: #7f007f">&#39;#aa0000&#39;</span>,

        Error:                      <span style="color: #7f007f">&#39;#F00 bg:#FAA&#39;</span>
    }

<span style="color: #007f00"># Set to True if you want inline CSS styles instead of classes</span>
inlinestyles = <span style="color: #00007f">True</span>

<span style="color: #007f00"># The default formatter</span>
DEFAULT = HtmlFormatter(noclasses=inlinestyles, linenos=<span style="color: #00007f">False</span>, style=SciteStyle)

<span style="color: #007f00"># Add name -&gt; formatter pairs for every variant you want to use</span>
VARIANTS = {
     <span style="color: #7f007f">&#39;linenos&#39;</span>: HtmlFormatter(noclasses=inlinestyles, linenos=<span style="color: #00007f">True</span>, style=SciteStyle)
}


<span style="color: #00007f; font-weight: bold">def</span> <span style="color: #00007f">pygments_directive</span>(name, arguments, options, content, lineno,
                       content_offset, block_text, state, state_machine):
    <span style="color: #7f007f">&quot;&quot;&quot; Will process the highlighted source-code directive.</span>
<span style="color: #7f007f">    &quot;&quot;&quot;</span>
    <span style="color: #00007f; font-weight: bold">try</span>:
        lexer = get_lexer_by_name(arguments[<span style="color: #007f7f">0</span>])
    <span style="color: #00007f; font-weight: bold">except</span> ValueError:
        <span style="color: #007f00"># no lexer found - use the text one instead of an exception</span>
        lexer = TextLexer()
    <span style="color: #007f00"># take an arbitrary option if more than one is given</span>
    formatter = options <span style="color: #0000aa">and</span> VARIANTS[options.keys()[<span style="color: #007f7f">0</span>]] <span style="color: #0000aa">or</span> DEFAULT
    parsed = highlight(<span style="color: #7f007f">u&#39;\n&#39;</span>.join(content), lexer, formatter)
    <span style="color: #00007f; font-weight: bold">return</span> [nodes.raw(<span style="color: #7f007f">&#39;&#39;</span>, parsed, format=<span style="color: #7f007f">&#39;html&#39;</span>)]


<span style="color: #007f00">##</span>
<span style="color: #007f00">## Loading docutils and registering the new directive</span>
<span style="color: #007f00">##</span>
<span style="color: #00007f; font-weight: bold">from</span> <span style="color: #00007f">docutils</span> <span style="color: #00007f; font-weight: bold">import</span> nodes, io
<span style="color: #00007f; font-weight: bold">from</span> <span style="color: #00007f">docutils.parsers.rst</span> <span style="color: #00007f; font-weight: bold">import</span> directives
<span style="color: #00007f; font-weight: bold">import</span> <span style="color: #00007f">docutils.core</span>

pygments_directive.arguments = (<span style="color: #007f7f">1</span>, <span style="color: #007f7f">0</span>, <span style="color: #007f7f">1</span>)
pygments_directive.content = <span style="color: #007f7f">1</span>
pygments_directive.options = <span style="color: #00007f">dict</span>([(key, directives.flag) <span style="color: #00007f; font-weight: bold">for</span> key <span style="color: #0000aa">in</span> VARIANTS])
directives.register_directive(<span style="color: #7f007f">&#39;sourcecode&#39;</span>, pygments_directive)


<span style="color: #007f00">##</span>
<span style="color: #007f00">## Execution</span>
<span style="color: #007f00">##</span>
<span style="color: #00007f; font-weight: bold">import</span> <span style="color: #00007f">os</span>, <span style="color: #00007f">sys</span>

infile = sys.argv[<span style="color: #007f7f">1</span>]
outfile = os.path.splitext(infile)[<span style="color: #007f7f">0</span>] + <span style="color: #7f007f">&quot;.html&quot;</span>

<span style="color: #00007f; font-weight: bold">print</span> <span style="color: #7f007f">&quot;Running HTML writer:\n-&gt; %s&quot;</span> % outfile

<span style="color: #007f00"># Running publish_parts to get at the document body, without</span>
<span style="color: #007f00"># header, style specifications and footer</span>
<span style="color: #007f00">#</span>
parts = docutils.core.publish_parts(
            source=<span style="color: #00007f">open</span>(infile, <span style="color: #7f007f">&#39;r&#39;</span>),
            source_class=io.FileInput,
            settings_overrides = {
                <span style="color: #7f007f">&#39;doctitle_xform&#39;</span>: <span style="color: #007f7f">0</span>,
                <span style="color: #7f007f">&#39;initial_header_level&#39;</span>: <span style="color: #007f7f">3</span>},
            writer_name=<span style="color: #7f007f">&#39;html&#39;</span>)

<span style="color: #00007f">open</span>(outfile, <span style="color: #7f007f">&#39;w&#39;</span>).write(parts[<span style="color: #7f007f">&#39;body&#39;</span>])
</pre></div>
</div>
<div class="section" id="conclusion">
<h3>Conclusion</h3>
<p>So, now I'm a happy user of reStructuredText with Pygments. I must say that the transition to reST has been a very pleasant one. The <tt class="docutils literal"><span class="pre">docutils</span></tt> library is very well designed and documented - such libraries are a pleasure to work with.</p>
<p>This post was written in the new setup with reST, of course.</p>
<div align="center" class="align-center"><img class="align-center" src="../../../images/hline.jpg" style="width: 320px; height: 5px;" /></div>
<table class="docutils footnote" frame="void" id="id5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><p class="first">I'm not usually into bashing open-source work done by people, but I do believe that some constructive criticism is appropriate.</p>
<ol class="last arabic simple">
<li>pytextile is very buggy</li>
<li>It doesn't seem to be maintained - the authors don't respond to issues opened in the bug tracker</li>
<li>The code is designed in a very customization-averse manner. Even fixing bugs is difficult, not to mention adding features.</li>
</ol>
</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td><em>lightweight</em> in the sense of formatting. Some basic formattings take a couple of extra keystrokes in reST. Overall, it's not too bad and very easy to get used to.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id7" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[3]</a></td><td>Used by, along others, Trac, ActiveState Code and several popular pastebins.</td></tr>
</tbody>
</table>
</div>

    
            </div>
            <!-- /.entry-content -->
<hr/>
<div class="dotted-links">
<p class="align-center">
For comments, please send me
<a href="mailto:eliben@gmail.com"><i class="fa fa-envelope-o"></i> an email</a>.
</p>
</div>        </article>
    </section>

    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">
            &copy; 2003-2025 Eli Bendersky
         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://code.jquery.com/jquery-2.2.4.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="../../../theme/js/bootstrap.min.js"></script>

<!--
  Using goatcounter to count visitors. The count.js script is vendored in.
-->
<script data-goatcounter="https://stats.thegreenplace.net/count"
        async src="../../../theme/js/count.js"></script>
</body>

<!-- Mirrored from eli.thegreenplace.net/2008/08/24/restructuredtext-for-blog-post-formatting by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 17 Feb 2025 00:11:05 GMT -->
</html>